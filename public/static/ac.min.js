/* eslint-disable */
/*
 FreeDo Co.Ltd.@2022
 @fileoverview AirCityCloud JS DevelopmentKit
 Creation Time: 2022/3/1 10:09:39 PM
*/
(function(C,F){"object"===typeof exports&&"undefined"!==typeof module?F(exports):"function"===typeof define&&define.amd?define(["exports"],F):(C="undefined"!==typeof globalThis?globalThis:C||self,F(C.acapi={}))})(this,function(C){function F(a){function b(c,e){return c.reduce(function(d,h){var g;Array.isArray(h)&&(g=b(h,e+1));return g>d?g:d},e)}return b(a,1)}function fa(a){let b=a.length,c=Array(b),e;for(let d=0;d<b;d++)e=a.charCodeAt(d),e=48<=e&&58>e?e-48:(e&223)-65+10,c[d]=e;return c.reduce((d,h)=>
16*d+h,0)}function E(a){if(void 0!=a){var b=[];if(/^(rgb|RGB)/.test(a)){a=a.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(",");for(let c of a)b.push(Number((Number(c)/255).toFixed(1)))}else if(/^#/.test(a)){if(/^#[0-9A-F]{3}$/i.test(a)){let c="#";a.replace(/[0-9A-F]/ig,function(e){c+=e+e});a=c}/^#[0-9A-F]{6}$/i.test(a)&&a.replace(/[0-9A-F]{2}/ig,function(c){c=fa(c);b.push(Number((c/255).toFixed(1)))})}else a instanceof Array&&(b=a);3==b.length&&b.push(1);return b}}function U(a){if(void 0!=a){var b,c=F(a);
2==c?b=[[a]]:3==c?b=[a]:4==c&&(b=a);if(b)for(let e of b)for(let d of e)for(let h of d)2==h.length&&h.push(0);return b}}function ja(a){if(void 0!=a)return 1==F(a)?[a]:a}function I(a){return a instanceof Array?a:[a]}function K(a){let b=[];if(a instanceof Array)for(let c in a)b[c]=a[c].toString();else b=[a.toString()];return b}function ra(a){return a==ha.abnormal_closure||a==ha.instance_is_disconnected||a==ha.wait_for_starting}var r={None:0,Camera_PlayAnimation:1,Camera_StopAnimation:2,Misc_EnterReportMode:3,
Misc_ExitReportMode:4,Misc_SetDateTime:5,Camera_GetCamera:6,Camera_SetState:7,Camera_Set:8,Camera_LookAtBBox:9,Coord_World2Screen:10,Coord_Screen2World:11,InfoTree_SetVisibility:12,InfoTree_Show:13,InfoTree_Hide:14,InfoTree_EnableXRay:15,InfoTree_DisableXRay:16,TileLayer_Add:17,HeatMap_Add:18,HeatMap_Update:19,HeatMap_AddPoints:20,HeatMap_RemovePoints:21,HeatMap_Delete:22,HeatMap_Show:23,HeatMap_Hide:24,HeatMap_Focus:25,HighlightArea_Add:26,HighlightArea_Delete:27,HighlightArea_Update:28,Polygon3D_Add:29,
Polygon3D_Delete:30,Misc_AddImageButton:31,Misc_DeleteImageButton:32,Misc_AddAnimatedImageButton:33,Settings_SetMainUIVisibility:34,Settings_SetMousePickMask:35,Tag_Add:36,Tag_Delete:37,Tag_Update:38,Tag_Clear:39,Tag_Focus:40,Beam_Add:41,Beam_Update:42,Beam_Delete:43,Beam_Clear:44,Beam_Focus:45,Beam_Show:350,Beam_Hide:351,Beam_ShowAll:352,Beam_HideAll:353,RadiationPoint_Add:46,RadiationPoint_Update:47,RadiationPoint_Delete:48,RadiationPoint_Clear:49,Polygon_Add:50,Polygon_Update:51,Polygon_Delete:52,
Polygon_Clear:53,Polygon_Highlight:54,Polygon_StopHighlight:325,Polygon_Glow:55,Polygon_Focus:56,Tag_FocusAll:57,Tag_Show:58,Tag_Hide:59,Tag_ShowAll:60,Tag_HideAll:61,RadiationPoint_Focus:62,RadiationPoint_FocusAll:63,RadiationPoint_Show:64,RadiationPoint_Hide:65,RadiationPoint_ShowAll:66,RadiationPoint_HideAll:67,Polygon_Show:68,Polygon_Hide:69,Polygon3D_Update:70,Polygon3D_Clear:71,Polygon3D_Focus:72,Polygon3D_Show:73,Polygon3D_Hide:74,Polygon3D_Highlight:75,Polygon3D_Glow:76,Polygon3D_StopGlow:77,
HighlightArea_Clear:78,HighlightArea_Focus:79,HighlightArea_Show:80,HighlightArea_Hide:81,Misc_GetVersion:82,TileLayer_Update:83,TileLayer_Delete:84,TileLayer_Focus:85,TileLayer_EnableXRay:86,TileLayer_DisableXRay:87,TileLayer_Show:88,TileLayer_Hide:89,Tag_Get:90,RadiationPoint_Get:91,Polygon_Get:92,Polygon3D_Get:93,HighlightArea_Get:94,TileLayer_Get:95,Beam_Get:96,HeatMap_Get:97,Settings_GetMapMode:98,Settings_SetMapMode:99,Settings_SetMapURL:100,Settings_SetWMTSLayerVisible:320,TileLayer_Actor_Show:101,
TileLayer_Actor_Hide:102,TileLayer_Actor_Focus:103,TileLayer_Actor_Highlight:104,TileLayer_Actor_StopHightlight:105,CustomObject_Add:106,CustomObject_Update:107,CustomObject_Delete:108,CustomObject_Get:109,CustomObject_Focus:110,CustomObject_Show:111,CustomObject_Hide:112,CustomObject_SetTintColor:326,HeatMap_Clear:113,CustomTag_Clear:39,CustomTag_Delete:37,CustomTag_Focus:40,CustomTag_FocusAll:57,CustomTag_Show:58,CustomTag_Hide:59,CustomTag_ShowAll:60,CustomTag_HideAll:61,CustomTag_Add:114,CustomTag_Update:115,
CustomTag_Get:116,Polyline_Add:117,Polyline_Update:118,Polyline_Delete:119,Polyline_Clear:120,Polyline_Focus:121,Polyline_Get:122,Polyline_Show:123,Polyline_Hide:124,Polyline_ShowAll:125,Polyline_HideAll:126,VideoProjection_Add:127,VideoProjection_Update:128,VideoProjection_Delete:129,VideoProjection_Show:130,VideoProjection_Hide:131,VideoProjection_Get:132,VideoProjection_Focus:133,Misc_PlayVideo:134,Misc_StopPlayVideo:135,Weather_SetParams:136,Weather_GetParams:137,Weather_SetDate:138,Weather_GetDate:139,
ODLine_Add:140,ODLine_Update:141,ODLine_Delete:142,ODLine_Clear:143,ODLine_Focus:144,ODLine_Get:145,ODLine_Show:146,ODLine_Hide:147,ODLine_ShowAll:148,ODLine_HideAll:149,Misc_SetWindowResolution:150,Misc_CallBPFunction:151,Settings_SetHighlightColor:152,InfoTree_ShowByGroupId:153,InfoTree_HideByGroupId:154,InfoTree_HighlightByGroupId:155,InfoTree_DeleteByGroupId:156,EditHelper_Start:157,EditHelper_Quit:158,EditHelper_Finish:159,EditHelper_SetParam:160,Settings_SetFovX:161,TileLayer_Actor_ShowAll:162,
TileLayer_Actor_HideAll:163,CameraTour_Add:164,CameraTour_Update:165,CameraTour_Play:166,CameraTour_Stop:167,CameraTour_Delete:168,Tag_PopupWindow_Show:169,Tag_PopupWindow_Hide:170,Tag_PopupWindow_ShowAll:171,Tag_PopupWindow_HideAll:172,Settings_SetOceanColor:173,Misc_ShowAllFoliages:174,Misc_HideAllFoliages:175,Tools_StartPolygonClip:176,Tools_StopClip:177,TileLayer_SetAllowClip:178,Panorama_Add:179,Panorama_Update:180,Panorama_Delete:181,Panorama_Clear:182,Panorama_Focus:183,Panorama_Get:184,Decal_Add:185,
Decal_Update:186,Decal_Delete:187,Decal_Clear:188,Decal_Focus:189,Decal_FocusAll:190,Decal_Get:191,Misc_PlayMovie:192,Misc_StopMovie:193,Tools_SetMeasurement:194,Tools_StartMeasurement:195,Tools_StopMeasurement:196,Viewshed_Add:197,Viewshed_Update:198,Viewshed_Focus:199,Viewshed_Delete:200,Viewshed_Clear:201,Viewshed_Get:202,TileLayer_SetStyle:203,Tools_LineIntersect:204,Coord_PCS2GCS:205,Coord_GCS2PCS:206,DynamicWater_Add:207,DynamicWater_Update:208,DynamicWater_Focus:209,DynamicWater_Delete:210,
DynamicWater_Clear:211,DynamicWater_Get:212,DynamicWater_Show:213,DynamicWater_Hide:214,Quit:215,TileLayer_Actor_Unhighlight:216,InfoTree_Get:217,Reset:218,CustomObject_Clear:219,CustomObject_Highlight:220,CustomObject_Unhighlight:221,CustomObject_StopHighlight:222,CustomObject_CallFunction:223,CustomObject_AddByTileLayer:224,Tools_StartPlaneClip:226,Tools_StopPlaneClip:228,Tools_StartVolumeClip:229,Tools_StopVolumeClip:231,Tools_StartSkylineAnalysis:232,Tools_StopSkylineAnalysis:233,Tools_ExportSkyline:234,
Tools_StartViewshedAnalysis:235,Tools_StopViewshedAnalysis:236,Camera_Move:237,TileLayer_SetCollision:238,TileLayer_Modifier_Add:239,TileLayer_Modifier_Update:240,TileLayer_Modifier_Delete:241,TileLayer_Modifier_Clear:242,Misc_StartProcess:243,Settings_SetCampassVisible:244,Tools_StartGeometryEdit:245,Tools_StopGeometryEdit:246,Settings_SetEnableInteract:247,Camera_PauseAnimation:248,Camera_ResumeAnimation:249,Settings_SetInteractiveMode:250,CameraTour_Pause:251,CameraTour_Resume:252,Settings_SetTerrainAlpha:253,
CustomMesh_Add:254,CustomMesh_Delete:255,CustomMesh_Clear:256,CustomMesh_Update:257,CustomMesh_Get:258,CustomMesh_Focus:259,CustomMesh_Show:260,CustomMesh_Hide:261,CustomMesh_ShowAll:262,CustomMesh_HideAll:263,Settings_EnableCameraMovingEvent:264,Marker_Add:265,Marker_Update:266,Marker_Get:267,Marker_Delete:268,Marker_Clear:269,Marker_Focus:270,Marker_FocusAll:271,Marker_Show:272,Marker_Hide:273,Marker_ShowAll:274,Marker_HideAll:275,Marker_ShowPopupWindow:276,Marker_HidePopupWindow:277,Marker_ShowAllPopupWindow:278,
Marker_HideAllPopupWindow:279,TileLayer_SetViewportVisible:280,TileLayer_GetObjectIDs:281,Polygon3D_StopHighlight:282,Tools_StartFloodFill:283,Tools_StopFloodFill:284,FloodFill_Add:285,FloodFill_Delete:286,FloodFill_Clear:287,FloodFill_Update:288,FloodFill_Get:289,FloodFill_Focus:290,FloodFill_Show:291,FloodFill_Hide:292,FloodFill_ShowAll:293,FloodFill_HideAll:294,Cesium3DTile_Add:295,Cesium3DTile_Delete:296,Cesium3DTile_Clear:297,Cesium3DTile_Update:298,Cesium3DTile_Get:299,Cesium3DTile_Focus:300,
Cesium3DTile_Show:301,Cesium3DTile_Hide:302,Cesium3DTile_ShowAll:303,Cesium3DTile_HideAll:304,TileLayer_GetActorInfoFromDB:305,ShapeFile_Add:306,ShapeFile_Delete:307,ShapeFile_Clear:308,ShapeFile_Update:309,ShapeFile_Get:310,ShapeFile_Focus:311,ShapeFile_Show:312,ShapeFile_Hide:313,ShapeFile_ShowAll:314,ShapeFile_HideAll:315,ShapeFile_OpenShapeFile:316,Weather_SimulateTime:317,TileLayer_Actor_GetInfo:318,Camera_GetAnimationList:319,TileLayer_CutPolygon_Add:321,TileLayer_CutPolygon_Update:322,TileLayer_CutPolygon_Delete:323,
TileLayer_CutPolygon_Clear:324,Marker3D_Add:327,Marker3D_Delete:328,Marker3D_Clear:329,Marker3D_Update:330,Marker3D_Get:331,Marker3D_Focus:332,Marker3D_Show:333,Marker3D_Hide:334,Marker3D_ShowAll:335,Marker3D_HideAll:336,Camera_GetAnimationImage:337,Tools_ReplaceTexture:338,Tools_RestoreTexture:339,Light_Add:340,Light_Delete:341,Light_Update:343,Light_Get:344,Light_Clear:342,Light_Focus:345,Light_Show:346,Light_Hide:347,Light_ShowAll:348,Light_HideAll:349,WaterMesh_Add:354,WaterMesh_Update:355,WaterMesh_Delete:356,
WaterMesh_Clear:357,WaterMesh_Get:358,WaterMesh_Focus:359,WaterMesh_Show:360,WaterMesh_Hide:361,WaterMesh_ShowAll:362,WaterMesh_HideAll:363,CustomObject_StartMove:364,CustomObject_StopMove:365,CustomObject_OverrideMaterial:366,CustomObject_RestoreMaterial:367,Settings_SetReport:368,Settings_GetReport:369,Settings_SetControl:370,Settings_GetControl:371,Settings_SetPostProcess:372,Settings_GetPostProcess:373,Settings_SetCamera:374,Settings_GetCamera:375,CustomObject_SetViewportVisible:376,WaterFlowField_Add:377,
WaterFlowField_Update:378,WaterFlowField_Delete:379,WaterFlowField_Clear:380,WaterFlowField_Get:381,WaterFlowField_Focus:382,WaterFlowField_Show:383,WaterFlowField_Hide:384,TileLayer_SetViewHeightRange:385,Tools_StartVisiblityAnalysis:386,Tools_StopVisiblityAnalysis:387,Tools_StartViewDomeAnalysis:388,Tools_StopViewDomeAnalysis:389,Tools_StartCutFillAnalysis:390,Tools_StopCutFillAnalysis:391,Tools_StartSunshineAnalysis:392,Tools_StopSunshineAnalysis:393,Tools_StartTerrainSlopeAnalysis:394,Tools_StopTerrainSlopeAnalysis:395,
Tools_StartContourLineAnalysis:396,Tools_StopContourLineAnalysis:397,Command_End:1E4},ka=!1;(()=>{if(!ka){ka=!0;for(let a in r)r[r[a]]=a}})();const ca={MouseClick:1,MouseMove:2,MouseHover:4},T={V1:1,V2:2,V3:4,V4:8,All:255};class sa{constructor(a,b){this.id=a;this.visible=b}}class ta{constructor(a,b,c,e){this.id=a.toString();this.coordinate=b;this.radius=c;this.heatValue=e}}class ua{constructor(a,b,c,e,d,h,g,q,k,f,l,t,v,p){this.id=a.toString();this.coordinate=b;this.imagePath=c;this.imageSize=e;this.url=
d;this.text=h;this.range=g||[1,1E5];this.showLine=!!q;this.textColor=k||[0,0,0,1];this.textBackgroundColor=f||[1,1,1,.85];this.textBorderColor=l||[0,0,0,0];this.textRange=t||1E5;this.hoverImagePath=v;this.autoHidePopupWindow=p||!0}}class va{constructor(a,b,c){this.url=a;this.width=b;this.height=c}}class wa{constructor(a,b,c,e,d,h,g,q){this.id=a.toString();this.coordinate=b;this.contentURL=c.url;this.contentSize=[c.width,c.height];this.popupURL=e.url;this.popupSize=[e.width,e.height];this.pivot=d;
this.range=h;this.autoHidePopupWindow=g||!0;this.popupPos=q}}class xa{constructor(a,b,c,e,d,h){this.id=a.toString();this.coordinates=U(b);this.color=E(c);this.heightRange=e;this.intensity=d;this.depthTest=h||!0}}class ya{constructor(a,b,c,e,d,h,g,q){this.id=a.toString();this.x=b;this.y=c;this.width=e;this.height=d;this.normalImage=h;this.hoverImage=g;this.tooltip=q}}class za{constructor(a,b,c,e,d,h,g,q,k){this.id=a.toString();this.x=b;this.y=c;this.width=e;this.height=d;this.imageSequecePath=h;this.imageSequeceLength=
g;this.loop=!!q;this.interactable=!!k}}class Aa{constructor(a,b,c,e,d,h,g){this.id=a.toString();this.duration=b;this.thickness=c;this.interval=e;this.velocity=d;this.color=E(h);this.coordinates=g}}class Ba{constructor(a,b,c,e,d,h){this.id=a.toString();this.coordinate=b;this.radius=c;this.rippleNumber=e;this.color=E(d);this.brightness=h}}class Ca{constructor(a,b,c,e,d,h,g,q){this.id=a.toString();this.style=b;this.coordinates=U(c);this.color=E(e);this.height=d;this.intensity=h;this.tillingX=g;this.tillingY=
q}}class Da{constructor(a,b,c,e,d,h,g,q,k,f){this.id=a.toString();this.color=E(b);this.coordinates=c;this.style=void 0==e?0:e;if(0>this.style||5<this.style)this.style=0;this.thickness=void 0==d?20:d;this.brightness=void 0==h?.5:h;this.flowRate=void 0==g?.5:g;this.tiling=q||0;this.depthTest=k||!0;this.shape=void 0==f?0:f}}class Ea{constructor(a,b,c,e,d,h,g,q,k,f,l,t,v,p,x,u,z){this.id=a.toString();this.color=E(b);this.coordinates=c;this.flowRate=void 0==e?.5:e;this.brightness=void 0==d?.5:d;this.bendDegree=
void 0==h?.5:h;this.tiling=g||0;this.lineThickness=void 0==q?20:q;this.flowPointSizeScale=void 0==k?20:k;this.labelSizeScale=void 0==f?100:f;this.lineShape=void 0==l?1:l;this.lineStyle=t||0;this.flowShape=v||0;this.startPointShape=p||0;this.endPointShape=x||0;this.startLabelShape=u||0;this.endLabelShape=z||0;this.endLabelStyle=this.startLabelStyle=this.endPointStyle=this.startPointStyle=this.flowStyle=0}}class Fa{constructor(a,b,c,e,d,h,g,q){this.id=a.toString();this.color=E(b);this.coordinates=U(c);
this.framecolor=E(e);this.framethickness=d;this.depthTest=h||!0;this.brightness=g;this.style=q;if(0>this.style||10<this.style)this.style=0}}class Ga{constructor(a,b,c,e,d,h){this.id=a.toString();this.imagePath=b;this.coordinate=c;this.yaw=e;this.groupId=d||"";this.userData=h||""}}class Ha{constructor(a,b,c,e,d,h,g,q){this.id=a.toString();this.order=b;this.texturePath=c;this.location=e;this.rotation=d;this.scale=h;this.groupId=g;this.userData=q}}class Ia{constructor(a,b,c,e,d){this.id=a.toString();
this.fileName=b;this.location=c;this.rotation=e;this.scale=d}}class Ja{constructor(a,b,c,e,d,h,g){this.id=a;this.pakFilePath=b;this.assetPath=c;this.location=e;this.rotation=d;this.scale=h;this.smoothMotion=g}}class Ka{constructor(a,b,c,e,d,h,g){this.id=a;this.tileLayerId=b;this.objectId=c;this.location=e;this.rotation=d;this.scale=h;this.smoothMotion=g}}class La{constructor(a,b,c,e,d,h,g){this.id=a;this.videoURL=b;this.location=c;this.rotation=e;this.fov=d;this.aspectRatio=h;this.distance=g}}class Ma{constructor(a,
b,c,e,d){this.id=a;this.coordinates=U(b);this.style=c;this.groupId=e;this.userData=d}}class Na{constructor(a,b,c,e,d){this.actorTag=a;this.objectName=b;this.functionName=c;this.paramType=e;this.paramValue=d}}class W{constructor(a,b){this.tileLayerId=a;this.tileLayerActorNames=K(b)}}class Oa{constructor(a,b,c,e){this.index=a;this.time=b;this.location=c;this.rotation=e}}class Pa{constructor(a,b,c){this.id=a.toString();this.name=b.toString();this.keyFrames=c}}class N{constructor(a,b,c){this.int=a;this.type=
b;this.colorProps=c;this._useBatchUpdate=!1;this._tempUpdateData=[]}_checkCommand(a){a=this.type+a;let b=r[a];void 0==b&&this.int.logWithColor("red",`Invalid command: ${a}`);return b}_convertFilePath(a){return this.int.resourcesPath?a.replace("@path:",this.int.resourcesPath+"/"):a}_processProps(a){a=I(a);for(var b of a)for(let c in b)"string"==typeof b[c]&&b[c].startsWith("@path:")&&(b[c]=this._convertFilePath(b[c]));for(let c of a)"string"!=typeof c.id&&(c.id=c.id.toString());if(this.colorProps){b=
this.colorProps.split("|");for(let c of a)for(let e of b)c.hasOwnProperty(e)&&(c[e]=E(c[e]))}if(-1!=["Polygon","Polygon3D","HighlightArea","DynamicWater"].indexOf(this.type))for(let c of a)c.coordinates=U(c.coordinates)}_add(a,b){this._processProps(a);return this.int.call({command:this._checkCommand("_Add"),data:I(a)},b)}_update(a,b){this._processProps(a);return this.int.call({command:this._checkCommand("_Update"),data:I(a)},b)}_delete(a,b){return this.int.call({command:this._checkCommand("_Delete"),
ids:K(a)},b)}_clear(a){return this.int.call0(this._checkCommand("_Clear"),a)}_get(a,b){return this.int.call({command:this._checkCommand("_Get"),ids:K(a)},b)}_focus(a,b,c,e){"function"==typeof c&&(e=c,c=void 0);return this.int.call({command:this._checkCommand("_Focus"),ids:K(a),distance:b||0,flyTime:c},e)}_focusAll(a,b,c){"function"==typeof b&&(c=b,b=void 0);return this.int.call({command:this._checkCommand("_FocusAll"),ids:[],distance:a||0,flyTime:b},c)}_show(a,b){return this.int.call({command:this._checkCommand("_Show"),
ids:K(a)},b)}_showAll(a){return this.int.call0(this._checkCommand("_ShowAll"),a)}_hide(a,b){return this.int.call({command:this._checkCommand("_Hide"),ids:K(a)},b)}_hideAll(a){return this.int.call0(this._checkCommand("_HideAll"),a)}_updateOneProp(a,b,c,e){if(this._useBatchUpdate){e=!1;for(var d of this._tempUpdateData)if(d.id==a.toString()){e=!0;d[b]=c;break}e||(e={},e.id=a.toString(),e[b]=c,this._tempUpdateData.push(e))}else return d={},d.id=a.toString(),d[b]=c,this.update(d,e)}updateBegin(){this._useBatchUpdate=
!0;this._tempUpdateData=[]}updateEnd(a){a=this.update(this._tempUpdateData,a);this._tempUpdateData=null;this._useBatchUpdate=!1;return a}test(){alert("test")}}class Qa extends N{constructor(a){super(a,"Beam","color")}add(a,b){return super._add(a,b)}update(a,b){return super._update(a,b)}delete(a,b){return super._delete(a,b)}clear(a){return super._clear(a)}focus(a,b,c,e){return super._focus(a,b,c,e)}show(a,b){return super._show(a,b)}hide(a,b){return super._hide(a,b)}showAll(a){return super._showAll(a)}hideAll(a){return super._hideAll(a)}get(a,
b){return super._get(a,b)}setDuration(a,b,c){return super._updateOneProp(a,"duration",b,c)}setThickness(a,b,c){return super._updateOneProp(a,"thickness",b,c)}setInterval(a,b,c){return super._updateOneProp(a,"interval",b,c)}setVelocity(a,b,c){return super._updateOneProp(a,"velocity",b,c)}setColor(a,b,c){return super._updateOneProp(a,"color",E(b),c)}setCoordinates(a,b,c){return super._updateOneProp(a,"coordinates",b,c)}}class Ra extends N{constructor(a){super(a,"CameraTour")}add(a,b){return super._add(a,
b)}update(a,b){return super._update(a,b)}delete(a,b){return super._delete(a,b)}play(a,b){return this.int.call({command:r.CameraTour_Play,ids:K(a)},b)}pause(a){return this.int.call0(r.CameraTour_Pause,a)}resume(a){return this.int.call0(r.CameraTour_Resume,a)}stop(a){return this.int.call({command:r.CameraTour_Stop},a)}setUserData(a,b,c){return super._updateOneProp(a,"userData",b,c)}setDuration(a,b,c){return super._updateOneProp(a,"duration",b,c)}setKeyFrames(a,b,c){return super._updateOneProp(a,"keyFrames",
b,c)}setName(a,b,c){return super._updateOneProp(a,"name",b,c)}}class Sa extends N{constructor(a){super(a,"Cesium3DTile")}add(a,b){return super._add(a,b)}update(a,b){return super._update(a,b)}delete(a,b){return super._delete(a,b)}clear(a){return super._clear(a)}focus(a,b,c,e){return super._focus(a,b,c,e)}show(a,b){return super._show(a,b)}showAll(a){return super._showAll(a)}hide(a,b){return super._hide(a,b)}hideAll(a){return super._hideAll(a)}get(a,b){return super._get(a,b)}setTileURL(a,b,c){return super._updateOneProp(a,
"tileURL",b,c)}}class Ta extends N{constructor(a){super(a,"CustomMesh","color")}add(a,b){return super._add(a,b)}update(a,b){return super._update(a,b)}delete(a,b){return super._delete(a,b)}clear(a){return super._clear(a)}focus(a,b,c,e){return super._focus(a,b,c,e)}show(a,b){return super._show(a,b)}hide(a,b){return super._hide(a,b)}get(a,b){return super._get(a,b)}setCoordinates(a,b,c){return super._updateOneProp(a,"coordinates",b,c)}setIndices(a,b,c){return super._updateOneProp(a,"indices",b,c)}setColor(a,
b,c){return super._updateOneProp(a,"color",b,c)}}class Ua extends N{constructor(a){super(a,"CustomObject")}add(a,b){return super._add(a,b)}update(a,b){return super._update(a,b)}delete(a,b){return super._delete(a,b)}clear(a){return super._clear(a)}focus(a,b,c,e){return super._focus(a,b,c,e)}show(a,b){return super._show(a,b)}hide(a,b){return super._hide(a,b)}get(a,b){return super._get(a,b)}addByTileLayer(a,b){return this.int.call({command:r.CustomObject_AddByTileLayer,data:I(a)},b)}highlight(a,b,c){return this.int.call({command:r.CustomObject_Highlight,
ids:K(a),color:E(b)},c)}unhighlight(a,b){return"undefined"==typeof a||"function"==typeof a?("function"==typeof a&&(b=a),this.int.call({command:r.CustomObject_StopHighlight},b)):this.int.call({command:r.CustomObject_Unhighlight,ids:K(a)},b)}callFunction(a,b,c,e,d){return this.int.call({command:r.CustomObject_CallFunction,data:I({id:a.toString(),functionName:b,paramType:c,paramValue:e})},d)}setLocation(a,b,c){return super._updateOneProp(a,"location",b,c)}setRotation(a,b,c){return super._updateOneProp(a,
"rotation",b,c)}setScale(a,b,c){return super._updateOneProp(a,"scale",b,c)}setSmoothMotion(a,b,c){return super._updateOneProp(a,"smoothMotion",b,c)}setTintColor(a,b,c){a={ids:I(a),color:E(b)};return this.int.call({command:r.CustomObject_SetTintColor,data:I(a)},c)}overrideMaterial(a,b){return this.int.call({command:r.CustomObject_OverrideMaterial,data:I(a)},b)}restoreMaterial(a,b){return this.int.call({command:r.CustomObject_RestoreMaterial,ids:I(a)},b)}setViewportVisible(a,b,c){let e=[];e.push({viewportIndex:1,
viewportVisible:!!(b&T.V1)});e.push({viewportIndex:2,viewportVisible:!!(b&T.V2)});e.push({viewportIndex:3,viewportVisible:!!(b&T.V3)});e.push({viewportIndex:4,viewportVisible:!!(b&T.V4)});return this.int.call({command:r.CustomObject_SetViewportVisible,id:a,data:e},c)}startMove(a,b,c,e){return this.int.call({command:r.CustomObject_StartMove,id:a,coordinateType:b,data:I(c)},e)}stopMove(a,b){return this.int.call({command:r.CustomObject_StopMove,id:a},b)}}class Va extends N{constructor(a){super(a,"CustomTag")}add(a,
b){return super._add(a,b)}update(a,b){return super._update(a,b)}delete(a,b){return super._delete(a,b)}clear(a){return super._clear(a)}focus(a,b,c,e){return super._focus(a,b,c,e)}show(a,b){return super._show(a,b)}showAll(a){return super._showAll(a)}hide(a,b){return super._hide(a,b)}hideAll(a){return super._hideAll(a)}get(a,b){return super._get(a,b)}setAutoHidePopupWindow(a,b,c){return super._updateOneProp(a,"autoHidePopupWindow",b,c)}}class Wa extends N{constructor(a){super(a,"Decal")}add(a,b){return super._add(a,
b)}update(a,b){return super._update(a,b)}delete(a,b){return super._delete(a,b)}clear(a){return super._clear(a)}focus(a,b,c,e){return super._focus(a,b,c,e)}focusAll(a,b,c){return super._focusAll(a,b,c)}get(a,b){return super._get(a,b)}}class Xa extends N{constructor(a){super(a,"DynamicWater")}add(a,b){return super._add(a,b)}update(a,b){return super._update(a,b)}delete(a,b){return super._delete(a,b)}clear(a){return super._clear(a)}focus(a,b,c,e){return super._focus(a,b,c,e)}get(a,b){return super._get(a,
b)}setCoordinates(a,b,c){return super._updateOneProp(a,"coordinates",U(b),c)}setMaterialPath(a,b,c){return super._updateOneProp(a,"materialPath",b,c)}setStyle(a,b,c){return super._updateOneProp(a,"style",b,c)}}class Ya extends N{constructor(a){super(a,"FloodFill","color")}add(a,b){return super._add(a,b)}update(a,b){return super._update(a,b)}delete(a,b){return super._delete(a,b)}clear(a){return super._clear(a)}focus(a,b,c,e){return super._focus(a,b,c,e)}show(a,b){return super._show(a,b)}showAll(a){return super._showAll(a)}hide(a,
b){return super._hide(a,b)}hideAll(a){return super._hideAll(a)}get(a,b){return super._get(a,b)}setRange(a,b,c,e){b instanceof Array&&c instanceof Array?0<b.length&&0<c.length?this.update({id:a,min:b,max:c},e):console.error("\u6570\u7ec4\u53c2\u6570\u4e0d\u80fd\u4e3a\u7a7a."):console.error("\u6570\u7ec4\u53c2\u6570\u683c\u5f0f\u4e0d\u6b63\u786e.")}setMin(a,b,c){return super._updateOneProp(a,"min",b,c)}setMax(a,b,c){return super._updateOneProp(a,"max",b,c)}setSeed(a,b,c){return super._updateOneProp(a,
"seed",b,c)}setElevation(a,b,c){return super._updateOneProp(a,"elevation",b,c)}setColor(a,b,c){return super._updateOneProp(a,"color",E(b),c)}setPrecision(a,b,c){return super._updateOneProp(a,"precision",b,c)}}class Za extends N{constructor(a){super(a,"HeatMap")}_checkBBox(a){if(a instanceof Array){if(6!=a.length||a[0]>a[3]||a[1]>a[4]||a[2]>a[5])return!1}else return!1;return!0}add(a,b,c,e,d){return this._checkBBox(b)?this.int.call({command:r.HeatMap_Add,id:a.toString(),bbox:b,range:c,data:I(e)},d):
(this.int.logWithColor("red","Invalid bbox value"),!1)}update(a,b,c,e,d){a={command:r.HeatMap_Update,id:a.toString()};if(b){if(!this._checkBBox(b))return this.int.logWithColor("red","Invalid bbox value"),!1;a.bbox=b}c&&(a.range=c);e&&(a.data=I(e));return this.int.call(a,d)}delete(a,b){return super._delete(a,b)}clear(a){return super._clear(a)}focus(a,b,c,e){return super._focus(a,b,c,e)}show(a,b){return super._show(a,b)}hide(a,b){return super._hide(a,b)}get(a,b){return super._get(a,b)}addPoints(a,b,
c){return this.int.call({command:r.HeatMap_AddPoints,id:a,data:I(b)},c)}removePoints(a,b,c){return this.int.call({command:r.HeatMap_RemovePoints,id:a,pointIds:I(b)},c)}setRange(a,b,c){return this.int.call({command:r.HeatMap_Update,id:a,range:b},c)}setBBox(a,b,c){return this._checkBBox(b)?this.int.call({command:r.HeatMap_Update,id:a,bbox:b},c):(this.int.logWithColor("red","Invalid bbox value"),!1)}}class $a extends N{constructor(a){super(a,"HighlightArea","color")}add(a,b){return super._add(a,b)}update(a,
b){return super._update(a,b)}delete(a,b){return super._delete(a,b)}clear(a){return super._clear(a)}focus(a,b,c,e){return super._focus(a,b,c,e)}show(a,b){return super._show(a,b)}hide(a,b){return super._hide(a,b)}get(a,b){return super._get(a,b)}setColor(a,b,c){return super._updateOneProp(a,"color",E(b),c)}setCoordinates(a,b,c){return super._updateOneProp(a,"coordinates",b,c)}setHeightRange(a,b,c){return super._updateOneProp(a,"heightRange",b,c)}setIntensity(a,b,c){return super._updateOneProp(a,"intensity",
b,c)}setDepthTest(a,b,c){return super._updateOneProp(a,"depthTest",b,c)}}class ab extends N{constructor(a){super(a,"Light","color")}add(a,b){return super._add(a,b)}update(a,b){return super._update(a,b)}delete(a,b){return super._delete(a,b)}clear(a){return super._clear(a)}focus(a,b,c,e){return super._focus(a,b,c,e)}show(a,b){return super._show(a,b)}showAll(a){return super._showAll(a)}hide(a,b){return super._hide(a,b)}hideAll(a){return super._hideAll(a)}get(a,b){return super._get(a,b)}}class bb extends N{constructor(a){super(a,
"Marker","fontColor|fontOutlineColor|textBackgroundColor|lineColor")}add(a,b){this._fixMarkerData(a);return super._add(a,b)}_fixMarkerProperty(a){a.textColor&&(a.fontColor=a.textColor);a.url&&(a.popupURL=a.url);a.dispalyMode&&(a.displayMode=a.dispalyMode);a.popupURL&&!a.popupSize&&(a.popupSize=[600,400]);0==a.showLine&&(a.lineSize=[0,0]);1!=a.showLine||null!=a.lineSize&&void 0!=a.lineSize||(a.lineSize=[2,100])}_fixMarkerData(a){if(a instanceof Array)for(let b of a)this._fixMarkerProperty(b);else this._fixMarkerProperty(a)}update(a,
b){this._fixMarkerData(a);return super._update(a,b)}delete(a,b){return super._delete(a,b)}clear(a){return super._clear(a)}focus(a,b,c,e){return super._focus(a,b,c,e)}focusAll(a,b,c){return super._focusAll(a,b,c)}show(a,b){return super._show(a,b)}showAll(a){return super._showAll(a)}hide(a,b){return super._hide(a,b)}hideAll(a){return super._hideAll(a)}showPopupWindow(a,b){return this.int.call({command:r.Marker_ShowPopupWindow,ids:K(a)},b)}hidePopupWindow(a,b){return this.int.call({command:r.Marker_HidePopupWindow,
ids:K(a)},b)}showAllPopupWindow(a){return this.int.call0(r.Marker_ShowAllPopupWindow,a)}hideAllPopupWindow(a){return this.int.call0(r.Marker_HideAllPopupWindow,a)}get(a,b){return super._get(a,b)}setGroupId(a,b,c){return super._updateOneProp(a,"groupId",b,c)}setUserData(a,b,c){return super._updateOneProp(a,"userData",b,c)}setScreenOffset(a,b,c){return super._updateOneProp(a,"screenOffset",b,c)}setCoordinate(a,b,c){return super._updateOneProp(a,"coordinate",b,c)}setImagePath(a,b,c){return super._updateOneProp(a,
"imagePath",b,c)}setImageSize(a,b,c){return super._updateOneProp(a,"imageSize",b,c)}setHoverImagePath(a,b,c){return super._updateOneProp(a,"hoverImagePath",b,c)}setURL(a,b,c){return super._updateOneProp(a,"url",b,c)}setText(a,b,c){return super._updateOneProp(a,"text",b,c)}setTextOffset(a,b,c){return super._updateOneProp(a,"textOffset",b,c)}setFontSize(a,b,c){return super._updateOneProp(a,"fontSize",b,c)}setFontOutlineSize(a,b,c){return super._updateOneProp(a,"fontOutlineSize",b,c)}setRange(a,b,c){return super._updateOneProp(a,
"range",b,c)}setTextRange(a,b,c){return super._updateOneProp(a,"textRange",b,c)}setFontColor(a,b,c){return super._updateOneProp(a,"fontColor",b,c)}setFontOutlineColor(a,b,c){return super._updateOneProp(a,"fontOutlineColor",b,c)}setTextBackgroundColor(a,b,c){return super._updateOneProp(a,"textBackgroundColor",b,c)}setAutoHidePopupWindow(a,b,c){return super._updateOneProp(a,"autoHidePopupWindow",b,c)}setPopupURL(a,b,c){return super._updateOneProp(a,"popupURL",b,c)}setPopupSize(a,b,c){return super._updateOneProp(a,
"popupSize",b,c)}setPopupOffset(a,b,c){return super._updateOneProp(a,"popupOffset",b,c)}setLineSize(a,b,c){return super._updateOneProp(a,"lineSize",b,c)}setLineColor(a,b,c){return super._updateOneProp(a,"lineColor",b,c)}setLineOffset(a,b,c){return super._updateOneProp(a,"lineOffset",b,c)}setPriority(a,b,c){return super._updateOneProp(a,"priority",b,c)}setOcclusionCull(a,b,c){return super._updateOneProp(a,"occlusionCull",b,c)}}class cb extends N{constructor(a){super(a,"Marker3D","fontColor")}add(a,
b){return super._add(a,b)}update(a,b){return super._update(a,b)}delete(a,b){return super._delete(a,b)}clear(a){return super._clear(a)}focus(a,b,c,e){return super._focus(a,b,c,e)}show(a,b){return super._show(a,b)}showAll(a){return super._showAll(a)}hide(a,b){return super._hide(a,b)}hideAll(a){return super._hideAll(a)}get(a,b){return super._get(a,b)}}class db extends N{constructor(a){super(a,"ODLine","color")}add(a,b){this._fixODlineData(a);return super._add(a,b)}_fixODlineProperty(a){a.intensity&&
(a.brightness=a.intensity)}_fixODlineData(a){if(a instanceof Array)for(let b of a)this._fixODlineProperty(b);else this._fixODlineProperty(a)}update(a,b){this._fixODlineData(a);return super._update(a,b)}delete(a,b){return super._delete(a,b)}clear(a){return super._clear(a)}focus(a,b,c,e){return super._focus(a,b,c,e)}show(a,b){return super._show(a,b)}showAll(a){return super._showAll(a)}hide(a,b){return super._hide(a,b)}hideAll(a){return super._hideAll(a)}get(a,b){return super._get(a,b)}setCoordinates(a,
b,c){return super._updateOneProp(a,"coordinates",b,c)}setColor(a,b,c){return super._updateOneProp(a,"color",E(b),c)}setFlowRate(a,b,c){return super._updateOneProp(a,"flowRate",b,c)}setBrightness(a,b,c){return super._updateOneProp(a,"brightness",b,c)}setTiling(a,b,c){return super._updateOneProp(a,"tiling",b,c)}setBendDegree(a,b,c){return super._updateOneProp(a,"bendDegree",b,c)}setLineThickness(a,b,c){return super._updateOneProp(a,"lineThickness",b,c)}setflowPointSizeScale(a,b,c){return super._updateOneProp(a,
"flowPointSizeScale",b,c)}setLabelSizeScale(a,b,c){return super._updateOneProp(a,"labelSizeScale",b,c)}setLineShape(a,b,c){return super._updateOneProp(a,"lineShape",b,c)}setLineStyle(a,b,c){return super._updateOneProp(a,"lineStyle",b,c)}setFlowShape(a,b,c){return super._updateOneProp(a,"flowShape",b,c)}setStartPointShape(a,b,c){return super._updateOneProp(a,"startPointShape",b,c)}setEndPointShape(a,b,c){return super._updateOneProp(a,"endPointShape",b,c)}setStartLabelShape(a,b,c){return super._updateOneProp(a,
"startLabelShape",b,c)}setEndLabelShape(a,b,c){return super._updateOneProp(a,"endLabelShape",b,c)}}class eb extends N{constructor(a){super(a,"Panorama")}add(a,b){return super._add(a,b)}update(a,b){return super._update(a,b)}delete(a,b){return super._delete(a,b)}clear(a){return super._clear(a)}focus(a,b,c,e){return super._focus(a,b,c,e)}get(a,b){return super._get(a,b)}}class fb extends N{constructor(a){super(a,"Polygon","color|frameColor")}add(a,b){this._fixPolygonData(a);return super._add(a,b)}_fixPolygonProperty(a){a.intensity&&
(a.brightness=a.intensity)}_fixPolygonData(a){if(a instanceof Array)for(let b of a)this._fixPolygonProperty(b);else this._fixPolygonProperty(a)}update(a,b){this._fixPolygonData(a);return super._update(a,b)}delete(a,b){return super._delete(a,b)}clear(a){return super._clear(a)}focus(a,b,c,e){return super._focus(a,b,c,e)}show(a,b){return super._show(a,b)}hide(a,b){return super._hide(a,b)}get(a,b){return super._get(a,b)}glow(a,b,c){return this.int.call({command:r.Polygon_Glow,ids:K(a),duration:b},c)}highlight(a,
b){return this.int.call({command:r.Polygon_Highlight,ids:K(a)},b)}stopHighlight(a,b){return this.int.call({command:r.Polygon_StopHighlight,ids:K(a)},b)}setCoordinates(a,b,c){return super._updateOneProp(a,"coordinates",U(b),c)}setColor(a,b,c){return super._updateOneProp(a,"color",E(b),c)}setDepthTest(a,b,c){return super._updateOneProp(a,"depthTest",b,c)}}class gb extends N{constructor(a){super(a,"Polygon3D","color")}add(a,b){return super._add(a,b)}update(a,b){return super._update(a,b)}delete(a,b){return super._delete(a,
b)}clear(a){return super._clear(a)}focus(a,b,c,e){return super._focus(a,b,c,e)}show(a,b){return super._show(a,b)}hide(a,b){return super._hide(a,b)}get(a,b){return super._get(a,b)}highlight(a,b){return this.int.call({command:r.Polygon3D_Highlight,ids:K(a)},b)}stopHighlight(a,b){return this.int.call({command:r.Polygon3D_StopHighlight,ids:K(a)},b)}glow(a,b,c){return this.int.call({command:r.Polygon3D_Glow,ids:K(a),duration:b},c)}stopGlow(a,b){return this.int.call({command:r.Polygon3D_StopGlow,ids:K(a)},
b)}setStyle(a,b,c){return super._updateOneProp(a,"style",b,c)}setCoordinates(a,b,c){return super._updateOneProp(a,"coordinates",b,c)}setColor(a,b,c){return super._updateOneProp(a,"color",E(b),c)}setHeight(a,b,c){return super._updateOneProp(a,"height",b,c)}setIntensity(a,b,c){return super._updateOneProp(a,"intensity",b,c)}setTillingX(a,b,c){return super._updateOneProp(a,"tillingX",b,c)}setTillingY(a,b,c){return super._updateOneProp(a,"tillingY",b,c)}}class hb extends N{constructor(a){super(a,"Polyline",
"color")}add(a,b){this._fixPolylineData(a);return super._add(a,b)}_fixPolylineProperty(a){a.intensity&&(a.brightness=a.intensity)}_fixPolylineData(a){if(a instanceof Array)for(let b of a)this._fixPolylineProperty(b);else this._fixPolylineProperty(a)}update(a,b){this._fixPolylineData(a);return super._update(a,b)}delete(a,b){return super._delete(a,b)}clear(a){return super._clear(a)}focus(a,b,c,e){return super._focus(a,b,c,e)}show(a,b){return super._show(a,b)}showAll(a){return super._showAll(a)}hide(a,
b){return super._hide(a,b)}hideAll(a){return super._hideAll(a)}get(a,b){return super._get(a,b)}setCoordinates(a,b,c){return super._updateOneProp(a,"coordinates",b,c)}setStyle(a,b,c){return super._updateOneProp(a,"style",b,c)}setThickness(a,b,c){return super._updateOneProp(a,"thickness",b,c)}setColor(a,b,c){return super._updateOneProp(a,"color",E(b),c)}setFlowRate(a,b,c){return super._updateOneProp(a,"flowRate",b,c)}setBrightness(a,b,c){return super._updateOneProp(a,"brightness",b,c)}setShape(a,b,
c){return super._updateOneProp(a,"shape",b,c)}setDepth(a,b,c){return super._updateOneProp(a,"depthTest",b,c)}}class ib extends N{constructor(a){super(a,"RadiationPoint","color")}add(a,b){this._fixRadiationPointData(a);return super._add(a,b)}_fixRadiationPointProperty(a){a.intensity&&(a.brightness=a.intensity)}_fixRadiationPointData(a){if(a instanceof Array)for(let b of a)this._fixRadiationPointProperty(b);else this._fixRadiationPointProperty(a)}update(a,b){this._fixRadiationPointData(a);return super._update(a,
b)}delete(a,b){return super._delete(a,b)}clear(a){return super._clear(a)}focus(a,b,c,e){return super._focus(a,b,c,e)}focusAll(a,b,c){return super._focusAll(a,b,c)}show(a,b){return super._show(a,b)}hide(a,b){return super._hide(a,b)}showAll(a){return super._showAll(a)}hideAll(a){return super._hideAll(a)}get(a,b){return super._get(a,b)}setCoordinate(a,b,c){return super._updateOneProp(a,"coordinate",b,c)}setRadius(a,b,c){return super._updateOneProp(a,"radius",b,c)}setRippleNumber(a,b,c){return super._updateOneProp(a,
"rippleNumber",b,c)}setColor(a,b,c){return super._updateOneProp(a,"color",E(b),c)}setBrightness(a,b,c){return super._updateOneProp(a,"brightness",b,c)}setAutoHeight(a,b,c){return super._updateOneProp(a,"autoHeight",b,c)}}class jb extends N{constructor(a){super(a,"ShapeFile","color")}add(a,b){return super._add(a,b)}update(a,b){return super._update(a,b)}delete(a,b){return super._delete(a,b)}clear(a){return super._clear(a)}get(a,b){return super._get(a,b)}focus(a,b,c,e){return super._focus(a,b,c,e)}show(a,
b){return super._show(a,b)}hide(a,b){return super._hide(a,b)}showAll(a){return super._showAll(a)}hideAll(a){return super._hideAll(a)}open(a,b){return this.int.call({command:r.ShapeFile_OpenShapeFile,data:I(a)},b)}}class kb extends N{constructor(a){super(a,"Tag","textColor|textBackgroundColor|textBorderColor")}add(a,b){return super._add(a,b)}update(a,b){return super._update(a,b)}delete(a,b){return super._delete(a,b)}clear(a){return super._clear(a)}focus(a,b,c,e){return super._focus(a,b,c,e)}focusAll(a,
b,c){return super._focusAll(a,b,c)}show(a,b){return super._show(a,b)}showAll(a){return super._showAll(a)}hide(a,b){return super._hide(a,b)}hideAll(a){return super._hideAll(a)}get(a,b){return super._get(a,b)}setCoordinate(a,b,c){return super._updateOneProp(a,"coordinate",b,c)}setImagePath(a,b,c){return super._updateOneProp(a,"imagePath",b,c)}setImageSize(a,b,c){return super._updateOneProp(a,"imageSize",b,c)}setText(a,b,c){return super._updateOneProp(a,"text",b,c)}setRange(a,b,c){return super._updateOneProp(a,
"range",b,c)}setTextColor(a,b,c){return super._updateOneProp(a,"textColor",b,c)}setTextBackgroundColor(a,b,c){return super._updateOneProp(a,"textBackgroundColor",b,c)}setTextBorderColor(a,b,c){return super._updateOneProp(a,"textBorderColor",b,c)}setShowLine(a,b,c){return super._updateOneProp(a,"showLine",b,c)}setAutoHidePopupWindow(a,b,c){return super._updateOneProp(a,"autoHidePopupWindow",b,c)}setURL(a,b,c){return super._updateOneProp(a,"url",b,c)}showPopupWindow(a,b){return this.int.call({command:r.Tag_PopupWindow_Show,
ids:K(a)},b)}hidePopupWindow(a,b){return this.int.call({command:r.Tag_PopupWindow_Hide,ids:K(a)},b)}showAllPopupWindow(a){return this.int.call0(r.Tag_PopupWindow_ShowAll,a)}hideAllPopupWindow(a){return this.int.call0(r.Tag_PopupWindow_HideAll,a)}}class lb extends N{constructor(a){super(a,"TileLayer")}add(a,b){return super._add(a,b)}update(a,b){return super._update(a,b)}delete(a,b){return super._delete(a,b)}focus(a,b,c,e){return super._focus(a,b,c,e)}show(a,b){return super._show(a,b)}hide(a,b){return super._hide(a,
b)}get(a,b){return super._get(a,b)}getActorInfoFromDB(a,b){return this.int.call({command:r.TileLayer_GetActorInfoFromDB,data:I(a)},b)}enableXRay(a,b,c){return this.int.call({command:r.TileLayer_EnableXRay,ids:K(a),color:E(b)},c)}disableXRay(a,b){return this.int.call({command:r.TileLayer_DisableXRay,ids:K(a)},b)}enableClip(a,b){let c=[];a=I(a);for(let e of a)c.push({id:e,allowClip:!0});return this.int.call({command:r.TileLayer_SetAllowClip,data:c},b)}disableClip(a,b){let c=[];a=I(a);for(let e of a)c.push({id:e,
allowClip:!1});return this.int.call({command:r.TileLayer_SetAllowClip,data:c},b)}setFileName(a,b,c){return super._updateOneProp(a,"fileName",b,c)}setLocation(a,b,c){return super._updateOneProp(a,"location",b,c)}setTranslation(a,b,c){return this.setLocation(a,b,c)}setRotation(a,b,c){return super._updateOneProp(a,"rotation",b,c)}setScale(a,b,c){return super._updateOneProp(a,"scale",b,c)}showActor(a,b,c){a=new W(a,b);return this.int.call({command:r.TileLayer_Actor_Show,data:I(a)},c)}showActors(a,b){let c=
[];if(a instanceof Array)for(let d=0;d<a.length;d++){var e=a[d];e={tileLayerId:e.id,tileLayerActorNames:K(e.objectIds)};c.push(e)}else a={tileLayerId:a.id,tileLayerActorNames:K(a.objectIds)},c.push(a);return this.int.call({command:r.TileLayer_Actor_Show,data:c},b)}hideActor(a,b,c){a=new W(a,b);return this.int.call({command:r.TileLayer_Actor_Hide,data:I(a)},c)}hideActors(a,b){let c=[];if(a instanceof Array)for(let d=0;d<a.length;d++){var e=a[d];e={tileLayerId:e.id,tileLayerActorNames:K(e.objectIds)};
c.push(e)}else a={tileLayerId:a.id,tileLayerActorNames:K(a.objectIds)},c.push(a);return this.int.call({command:r.TileLayer_Actor_Hide,data:c},b)}focusActor(a,b,c){a=new W(a,b);return this.int.call({command:r.TileLayer_Actor_Focus,data:I(a)},c)}focusActors(a,b){a=new W(a.id,a.objectIds);return this.int.call({command:r.TileLayer_Actor_Focus,data:I(a)},b)}highlightActor(a,b,c){a=new W(a,b);return this.int.call({command:r.TileLayer_Actor_Highlight,data:I(a)},c)}highlightActors(a,b){a=new W(a.id,a.objectIds);
return this.int.call({command:r.TileLayer_Actor_Highlight,data:I(a)},b)}stopHighlightActor(a,b,c){let e=void 0==a;"function"==typeof a&&(c=a,e=!0);if(e)return this.stopHighlightActors(c);a=new W(a,b);return this.stopHighlightActors(a,c)}stopHighlightActors(a,b){let c=!a;"function"==typeof a&&(b=a,c=!0);return c?this.int.call0(r.TileLayer_Actor_StopHightlight,b):this.int.call({command:r.TileLayer_Actor_Unhighlight,data:I(a)},b)}showAllActors(a,b){return this.int.call({command:r.TileLayer_Actor_ShowAll,
ids:K(a)},b)}hideAllActors(a,b){return this.int.call({command:r.TileLayer_Actor_HideAll,ids:K(a)},b)}setStyle(a,b,c,e,d,h,g,q){return this.int.call({command:r.TileLayer_SetStyle,ids:K(a),style:b,color:E(c),saturation:e,brightness:d,contrast:h,contrastbase:g},q)}setCollision(a,b,c,e,d,h){a=K(a);let g=[];for(let q of a)g.push({id:q,enableCollision:b,enableMouseInteract:c,enableMousePick:e,enableCharacterCollision:d});return this.int.call({command:r.TileLayer_SetCollision,data:g},h)}addModifiers(a,b){return this.int.call({command:r.TileLayer_Modifier_Add,
data:I(a)},b)}addModifierByShapeFile(a,b){return this.int.call({command:r.TileLayer_Modifier_Add,data:I(a)},b)}addModifier(a,b,c,e,d){this.addModifiers([{id:a,tileLayerId:b,coordinates:c,ententBufferSize:e}])}updateModifier(a,b,c,e,d){return this.int.call({command:r.TileLayer_Modifier_Update,data:I([{id:a,tileLayerId:b,coordinates:c,ententBufferSize:e}])},d)}deleteModifier(a,b,c){return this.int.call({command:r.TileLayer_Modifier_Delete,id:a,tileLayerId:b},c)}clearModifier(a,b){return this.int.call({command:r.TileLayer_Modifier_Clear,
ids:K(a)},b)}setViewportVisible(a,b,c){let e=[];e.push({viewportIndex:1,viewportVisible:!!(b&T.V1)});e.push({viewportIndex:2,viewportVisible:!!(b&T.V2)});e.push({viewportIndex:3,viewportVisible:!!(b&T.V3)});e.push({viewportIndex:4,viewportVisible:!!(b&T.V4)});return this.int.call({command:r.TileLayer_SetViewportVisible,id:a,data:e},c)}getObjectIDs(a,b){return this.int.call({command:r.TileLayer_GetObjectIDs,ids:K(a)},b)}getActorInfo(a,b){return this.int.call({command:r.TileLayer_Actor_GetInfo,data:I(a)},
b)}addHoleByShapeFile(a,b){return this.int.call({command:r.TileLayer_CutPolygon_Add,data:I(a)},b)}addHole(a,b){return this.int.call({command:r.TileLayer_CutPolygon_Add,data:I(a)},b)}updateHole(a,b,c,e,d){return this.int.call({command:r.TileLayer_CutPolygon_Update,data:I({id:a,tileLayerId:b,coordinates:c,isReverseCut:e})},d)}deleteHole(a,b,c){return this.int.call({command:r.TileLayer_CutPolygon_Delete,id:a,tileLayerId:b},c)}clearHole(a,b){return this.int.call({command:r.TileLayer_CutPolygon_Clear,
ids:K(a)},b)}setViewHeightRange(a,b,c,e){return this.int.call({command:r.TileLayer_SetViewHeightRange,data:[{id:a,minVisibleHeight:b,maxVisibleHeight:c}]},e)}}class mb extends N{constructor(a){super(a,"VideoProjection")}add(a,b){return super._add(a,b)}update(a,b){return super._update(a,b)}delete(a,b){return super._delete(a,b)}focus(a,b,c,e){return super._focus(a,b,c,e)}show(a,b){return super._show(a,b)}hide(a,b){return super._hide(a,b)}get(a,b){return super._get(a,b)}setVideoURL(a,b,c){return super._updateOneProp(a,
"videoURL",b,c)}setLocation(a,b,c){return super._updateOneProp(a,"location",b,c)}setRotation(a,b,c){return super._updateOneProp(a,"rotation",b,c)}setFovy(a,b,c){return super._updateOneProp(a,"fov",b,c)}setAspectRatio(a,b,c){return super._updateOneProp(a,"aspectRatio",b,c)}setDistance(a,b,c){return super._updateOneProp(a,"distance",b,c)}setDepthCulling(a,b,c){return super._updateOneProp(a,"depthCulling",b,c)}setFrustumColor(a,b,c){return super._updateOneProp(a,"frustumColor",b,c)}}class nb extends N{constructor(a){super(a,
"WaterFlowField")}add(a,b){return super._add(a,b)}update(a,b){return super._update(a,b)}delete(a,b){return super._delete(a,b)}clear(a){return super._clear(a)}focus(a,b,c,e){return super._focus(a,b,c,e)}show(a,b){return super._show(a,b)}hide(a,b){return super._hide(a,b)}get(a,b){return super._get(a,b)}}class ob extends N{constructor(a){super(a,"WaterMesh","color")}add(a,b){return super._add(a,b)}update(a,b){return super._update(a,b)}delete(a,b){return super._delete(a,b)}clear(a){return super._clear(a)}focus(a,
b,c,e){return super._focus(a,b,c,e)}show(a,b){return super._show(a,b)}hide(a,b){return super._hide(a,b)}showAll(a){return super._showAll(a)}hideAll(a){return super._hideAll(a)}get(a,b){return super._get(a,b)}setCoordinates(a,b,c){return super._updateOneProp(a,"coordinates",b,c)}setIndices(a,b,c){return super._updateOneProp(a,"indices",b,c)}setNormals(a,b,c){return super._updateOneProp(a,"normals",b,c)}setWaterColor(a,b,c){return super._updateOneProp(a,"waterColor",b,c)}setWaterSpeed(a,b,c){return super._updateOneProp(a,
"waterSpeed",b,c)}setWaterUVRepeat(a,b,c){return super._updateOneProp(a,"waterUVRepeat",b,c)}setWaterDirection(a,b,c){return super._updateOneProp(a,"waterDirection",b,c)}setWaterWaveScale(a,b,c){return super._updateOneProp(a,"waveScale",b,c)}}class pb{constructor(a){this.int=a;this._useOldDataFormat=!1}useOldDataFormat(a){this._useOldDataFormat=a||!0}get(a){return this.int.call0(r.Camera_GetCamera,a)}_setByArray(a,b,c){return this.set(a[0],a[1],a[2],a[3],a[4],b,c)}_setByObject(a,b,c){return this.set(a.x,
a.y,a.z,a.pitch,a.yaw,b,c)}set(a,b,c,e,d,h,g){if(a instanceof Array&&5<=a.length)return this._setByArray(a,b,c);if("object"==typeof a&&a.hasOwnProperty("x"))return this._setByObject(a,b,c);"function"==typeof h&&(g=h,h=void 0);if(this._useOldDataFormat){let q=e;e=d;d=q}return this.int.call({command:r.Camera_Set,coordinate:[a,b,c],pitch:e||0,yaw:d||0,flyTime:h},g)}lookAt(a,b,c,e,d,h,g,q){"function"==typeof g&&(q=g,g=void 0);if(this._useOldDataFormat){let k=d;d=h;h=k}return this.int.call({command:r.Camera_Set,
coordinate:[a,b,c],distance:e,pitch:d||0,yaw:h||0,flyTime:g},q)}lookAtBBox(a,b,c,e,d){"function"==typeof e&&(d=e,e=void 0);if(this._useOldDataFormat){let h=b;b=c;c=h}return this.int.call({command:r.Camera_LookAtBBox,bbox:a,pitch:b||0,yaw:c||0,flyTime:e},d)}playAnimation(a,b){return this.int.call({command:r.Camera_PlayAnimation,id:a},b)}stopAnimation(a){return this.int.call0(r.Camera_StopAnimation,a)}pauseAnimation(a){return this.int.call0(r.Camera_PauseAnimation,a)}resumeAnimation(a){return this.int.call0(r.Camera_ResumeAnimation,
a)}getAnimationList(a){return this.int.call0(r.Camera_GetAnimationList,a)}getAnimationImage(a,b){return this.int.call({command:r.Camera_GetAnimationImage,name:a},b)}moveForward(a){return this.int.call({command:r.Camera_Move,moveForward:!0},a)}moveBackward(a){return this.int.call({command:r.Camera_Move,moveBackward:!0},a)}moveLeft(a){return this.int.call({command:r.Camera_Move,moveLeft:!0},a)}moveRight(a){return this.int.call({command:r.Camera_Move,moveRight:!0},a)}moveUp(a){return this.int.call({command:r.Camera_Move,
moveUp:!0},a)}moveDown(a){return this.int.call({command:r.Camera_Move,moveDown:!0},a)}turnLeft(a){return this.int.call({command:r.Camera_Move,turnLeft:!0},a)}turnRight(a){return this.int.call({command:r.Camera_Move,turnRight:!0},a)}turnUp(a){return this.int.call({command:r.Camera_Move,turnUp:!0},a)}turnDown(a){return this.int.call({command:r.Camera_Move,turnDown:!0},a)}stop(a){return this.int.call({command:r.Camera_Move,stop:!0},a)}}class qb{constructor(a){this.int=a}screen2World(a,b,c){return this.int.call({command:r.Coord_Screen2World,
screenPosition:[a,b]},c)}world2Screen(a,b,c,e){return this.int.call({command:r.Coord_World2Screen,worldlocation:[a,b,c]},e)}gcs2pcs(a,b){return this.int.call({command:r.Coord_GCS2PCS,coordinates:ja(a)},b)}pcs2gcs(a,b){return this.int.call({command:r.Coord_PCS2GCS,coordinates:ja(a)},b)}}class rb{constructor(a){this.int=a}start(a){return this.int.call0(r.EditHelper_Start,a)}cancel(a){return this.int.call0(r.EditHelper_Quit,a)}finish(a,b){return this.int.call({command:r.EditHelper_Finish,withOffset:a||
!0},b)}setParam(a,b,c,e){return this.int.call({command:r.EditHelper_SetParam,lineType:a,buildType:b,color:E(c)},e)}}class sb{constructor(a){this.int=a}setVisibility(a,b){return this.int.call({command:r.InfoTree_SetVisibility,layers:I(a)},b)}show(a,b){return this.int.call({command:r.InfoTree_Show,ids:K(a)},b)}hide(a,b){return this.int.call({command:r.InfoTree_Hide,ids:K(a)},b)}enableXRay(a,b,c){return this.int.call({command:r.InfoTree_EnableXRay,ids:I(a),color:E(b)},c)}disableXRay(a,b){return this.int.call({command:r.InfoTree_DisableXRay,
ids:I(a)},b)}showByGroupId(a,b){return this.int.call({command:r.InfoTree_ShowByGroupId,ids:K(a)},b)}hideByGroupId(a,b){return this.int.call({command:r.InfoTree_HideByGroupId,ids:K(a)},b)}highlightByGroupId(a,b){return this.int.call({command:r.InfoTree_HighlightByGroupId,ids:K(a)},b)}deleteByGroupId(a,b){return this.int.call({command:r.InfoTree_DeleteByGroupId,ids:K(a)},b)}get(a){return this.int.call0(r.InfoTree_Get,a)}}class tb{constructor(a){this.int=a;this.apiVersion="5.1";this.apiVersionServer=
""}isApiVersionMatched(){return"5.1"==this.apiVersionServer}addImageButtons(a,b){return this.int.call({command:r.Misc_AddImageButton,data:I(a)},b)}deleteImageButtons(a,b){return this.int.call({command:r.Misc_DeleteImageButton,ids:K(a)},b)}addAnimatedImageButtons(a,b){return this.int.call({command:r.Misc_AddAnimatedImageButton,data:I(a)},b)}setApiVersionReceived(a){this.int.onApiVersionReceived=a}playVideo(a,b,c,e,d,h,g){return this.int.call({command:r.Misc_PlayVideo,data:[{id:a.toString(),position:[b,
c],size:[e,d],url:h}]},g)}stopPlayVideo(a,b){return this.int.call({command:r.Misc_StopPlayVideo,ids:K(a)},b)}playMovie(a,b,c){"function"==typeof b&&(c=b,b=!1);return this.int.call({command:r.Misc_PlayMovie,loop:b,url:a},c)}stopMovie(a){return this.int.call({command:r.Misc_StopMovie},a)}setWindowResolution(a,b,c){return this.int.call({command:r.Misc_SetWindowResolution,cx:a,cy:b,mode:0},c)}callBPFunction(a,b){return this.int.call({command:r.Misc_CallBPFunction,data:I(a)},b)}enterReportMode(a){return this.int.call0(r.Misc_EnterReportMode)}exitReportMode(a){return this.int.call0(r.Misc_ExitReportMode,
a)}showAllFoliages(a){return this.int.call0(r.Misc_ShowAllFoliages,a)}hideAllFoliages(a){return this.int.call0(r.Misc_HideAllFoliages,a)}startProcess(a,b,c,e){"function"==typeof c&&(e=c,c=!0);return this.int.call({command:r.Misc_StartProcess,appName:a,commandLine:b,visible:c},e)}startPolygonClip(a,b,c){return this.int.tools.startPolygonClip(a,b,c)}stopClip(a){return this.int.tools.stopClip(a)}playAnimation(a,b){return this.int.camera.playAnimation(a,b)}stopAnimation(a){return this.int.camera.stopAnimation(a)}setDateTime(a,
b,c,e,d,h,g){return this.int.weather.setDateTime(a,b,c,e,d,h,g)}setQueryToolState(a,b){return this.int.call({"c.ommand":r.Settings_SetMousePickMask,mouseClick:a},b)}setCampassVisible(a,b){return this.int.settings.setCampassVisible(a,b)}setMainUIVisibility(a,b){return this.int.settings.setMainUIVisibility(a,b)}setMousePickMask(a,b){return this.int.settings.setMousePickMask(a,b)}}class ub{constructor(a){this.int=a}setMapMode(a,b,c){b=b||{};return this.int.call({command:r.Settings_SetMapMode,mode:a,
serviceType:b.serviceType||0,coordType:b.coordType||0,mapPoint:b.mapPoint||[0,0],longitude:b.longitude||0,latitude:b.latitude||0,cache:b.cache||":memory:",style:b.style||"mapbox://styles/mapbox/streets-v10",groundHeight:b.groundHeight||0,renderMode:b.renderMode||0,serverURL:b.serverURL,coordOrder:b.coordOrder},c)}getMapMode(a){return this.int.call0(r.Settings_GetMapMode,a)}setWMTSLayerVisible(a,b){this.setwmtsLayerVisible(a,b)}setwmtsLayerVisible(a,b){return this.int.call({command:r.Settings_SetWMTSLayerVisible,
data:a},b)}setMapURL(a,b){return this.int.call({command:r.Settings_SetMapURL,url:a},b)}highlightColor(a,b){return this.setHighlightColor(a,b)}setHighlightColor(a,b){return this.int.call({command:r.Settings_SetHighlightColor,color:E(a)},b)}setFovX(a,b){return this.int.call({command:r.Settings_SetFovX,value:a},b)}setOceanColor(a,b){return this.int.call({command:r.Settings_SetOceanColor,color:a},b)}setEnableInteract(a,b){return this.int.call({command:r.Settings_SetEnableInteract,enableInteract:a},b)}setInteractiveMode(a,
b){return this.int.call({command:r.Settings_SetInteractiveMode,mode:a},b)}setCampassVisible(a,b){return this.int.call({command:r.Settings_SetCampassVisible,visible:a},b)}setMainUIVisibility(a,b){return this.int.call({command:r.Settings_SetMainUIVisibility,visible:a},b)}setMousePickMask(a,b){let c=!1,e=!1,d=!1;a&ca.MouseClick&&(c=!0);a&ca.MouseMove&&(e=!0);a&ca.MouseHover&&(d=!0);return this.int.call({command:r.Settings_SetMousePickMask,mouseClick:c,mouseMove:e,mouseHover:d},b)}setTerrainAlpha(a,b){return this.int.call({command:r.Settings_SetTerrainAlpha,
alpha:a},b)}setEnableCameraMovingEvent(a,b){return this.int.call({command:r.Settings_EnableCameraMovingEvent,bEnable:a},b)}}class vb{constructor(a){this.int=a}setReportMode(a,b,c,e){return this.int.call({command:r.Settings_SetReport,alignment:a,playMode:b,moveInOtherView:c},e)}getReportMode(a){return this.int.call({command:r.Settings_GetReport},a)}setControlMode(a,b,c,e,d){return this.int.call({command:r.Settings_SetControl,speed:a,yawSpeed:b,rotateSelf:c,useFemale:e},d)}getControlMode(a){return this.int.call({command:r.Settings_GetControl},
a)}setPostProcessMode(a,b){return this.int.call({command:r.Settings_SetPostProcess,contrast:a.contrast,saturation:a.saturation,lensFlareIntensity:a.lensFlareIntensity,ambientIntensity:a.ambientIntensity,screenPercentage:a.screenPercentage,terrainGlobalAlpha:a.terrainGlobalAlpha,terrainGlobalLitStatus:a.terrainGlobalLitStatus,osgbGlobalLitStatus:a.osgbGlobalLitStatus,osgbGlobalAlpha:a.osgbGlobalAlpha,antiAliasing:a.antiAliasing,tonemapper:a.tonemapper,postProcessEffects:a.postProcessEffects,dofMode:a.dofMode,
wireThickness:a.wireThickness,receiveDecalMode:a.receiveDecalMode},b)}getPostProcessMode(a){return this.int.call({command:r.Settings_GetPostProcess},a)}setCameraMode(a,b,c,e){return this.int.call({command:r.Settings_SetCamera,nearClipPlane:a,fovH:b,minCamHeight:c},e)}getCameraMode(a){return this.int.call({command:r.Settings_GetCamera},a)}setMapMode(a,b,c){b=b||{};return this.int.call({command:r.Settings_SetMapMode,mode:a,serviceType:b.serviceType||0,coordType:b.coordType||0,mapPoint:b.mapPoint||[0,
0],longitude:b.longitude||0,latitude:b.latitude||0,cache:b.cache||":memory:",style:b.style||"mapbox://styles/mapbox/streets-v10",groundHeight:b.groundHeight||0,renderMode:b.renderMode||0,serverURL:b.serverURL,coordOrder:b.coordOrder},c)}getMapMode(a){return this.int.call0(r.Settings_GetMapMode,a)}}class wb{constructor(a){this.int=a}startPolygonClip(a,b,c){return this.int.call({command:r.Tools_StartPolygonClip,data:I({id:"0",coordinates:U(a),toggleImageCut:b})},c)}startPlaneClip(a,b,c,e,d){return this.int.call({command:r.Tools_StartPlaneClip,
location:a,rotation:b,isShowPlane:c,isEdit:e},d)}startVolumeClip(a,b,c,e,d){return this.int.call({command:r.Tools_StartVolumeClip,bbox:a,value:b,isShowPlane:c,isEdit:e},d)}stopClip(a){return this.stopPolygonClip(a)}stopPolygonClip(a){return this.int.call0(r.Tools_StopClip,a)}stopPlaneClip(a){return this.int.call({command:r.Tools_StopPlaneClip},a)}stopVolumeClip(a){return this.int.call({command:r.Tools_StopVolumeClip},a)}setMeasurement(a,b,c){b=b||{};return this.int.call({command:r.Tools_SetMeasurement,
type:a,pointSize:b.pointSize,textColor:E(b.textColor),pointColor:E(b.pointColor),lineColor:E(b.lineColor),areaColor:E(b.areaColor),showCoordinateText:b.showCoordinateText},c)}startMeasurement(a){return this.int.call0(r.Tools_StartMeasurement,a)}stopMeasurement(a){return this.int.call0(r.Tools_StopMeasurement,a)}lineIntersect(a,b,c){return this.int.call({command:r.Tools_LineIntersect,data:[{start:a,end:b}],highPrecision:!1,returnDetails:!0},c)}linesIntersect(a,b,c,e){return this.int.call({command:r.Tools_LineIntersect,
data:I(a),highPrecision:b,returnDetails:c},e)}startGeometryEdit(a,b,c){return this.int.call({command:r.Tools_StartGeometryEdit,id:a,type:b},c)}stopGeometryEdit(a){return this.int.call0(r.Tools_StopGeometryEdit,a)}startSkylineAnalysis(a,b){a=a||{};a.outlineColor&&(a.outlineColor=E(a.outlineColor));a.sceneColor&&(a.sceneColor=E(a.sceneColor));a.skylineColor&&(a.skylineColor=E(a.skylineColor));a.backgroundColor&&(a.backgroundColor=E(a.backgroundColor));if(a.tileLayers){a.tileLayers=I(a.tileLayers);for(let c of a.tileLayers)c.hasOwnProperty("color")&&
(c.color=E(c.color))}a.command=r.Tools_StartSkylineAnalysis;return this.int.call(a,b)}stopSkylineAnalysis(a){return this.int.call0(r.Tools_StopSkylineAnalysis,a)}exportSkyline(a,b,c,e){c=c||{};c.skylineColor&&(c.skylineColor=E(c.skylineColor));c.backgroundColor&&(c.backgroundColor=E(c.backgroundColor));if(c.tileLayers){c.tileLayers=I(c.tileLayers);for(let d of c.tileLayer)d.hasOwnProperty("color")&&(d.color=E(d.color))}return this.int.call({command:r.Tools_ExportSkyline,path:a,size:b,skylineColor:c.skylineColor,
backgroundColor:c.backgroundColor},e)}startViewshedAnalysis(a,b){a=a||{};a.visibleColor&&(a.visibleColor=E(a.visibleColor));a.invisibleColor&&(a.invisibleColor=E(a.invisibleColor));a.command=r.Tools_StartViewshedAnalysis;return this.int.call(a,b)}stopViewshedAnalysis(a){return this.int.call0(r.Tools_StopViewshedAnalysis,a)}startVisiblityAnalysis(a,b){a=a||{};a.visibleColor&&(a.visibleColor=E(a.visibleColor));a.invisibleColor&&(a.invisibleColor=E(a.invisibleColor));a.command=r.Tools_StartVisiblityAnalysis;
return this.int.call(a,b)}stopVisiblityAnalysis(a){return this.int.call0(r.Tools_StopVisiblityAnalysis,a)}startViewDomeAnalysis(a,b){a=a||{};a.visibleColor&&(a.visibleColor=E(a.visibleColor));a.invisibleColor&&(a.invisibleColor=E(a.invisibleColor));a.command=r.Tools_StartViewDomeAnalysis;return this.int.call(a,b)}stopViewDomeAnalysis(a){return this.int.call0(r.Tools_StopViewDomeAnalysis,a)}startCutFillAnalysis(a,b){a=a||{};a.cutLineColor&&(a.cutLineColor=E(a.cutLineColor));a.fillLineColor&&(a.fillLineColor=
E(a.fillLineColor));a.cutPointColor&&(a.cutPointColor=E(a.cutPointColor));a.fillPointColor&&(a.fillPointColor=E(a.fillPointColor));a.gridColor&&(a.gridColor=E(a.gridColor));a.command=r.Tools_StartCutFillAnalysis;return this.int.call(a,b)}stopCutFillAnalysis(a){return this.int.call0(r.Tools_StopCutFillAnalysis,a)}startSunshineAnalysis(a,b){a.command=r.Tools_StartSunshineAnalysis;return this.int.call(a,b)}stopSunshineAnalysis(a){return this.int.call0(r.Tools_StopSunshineAnalysis,a)}startTerrainSlopeAnalysis(a,
b){a.command=r.Tools_StartTerrainSlopeAnalysis;return this.int.call(a,b)}stopTerrainSlopeAnalysis(a){return this.int.call0(r.Tools_StopTerrainSlopeAnalysis,a)}startContourLineAnalysis(a,b){a.command=r.Tools_StartContourLineAnalysis;return this.int.call(a,b)}stopContourLineAnalysis(a){return this.int.call0(r.Tools_StopContourLineAnalysis,a)}startFloodFill(a,b){a=a||{};a.color&&(a.color=E(a.color));a.command=r.Tools_StartFloodFill;return this.int.call(a,b)}stopFloodFill(a){return this.int.call0(r.Tools_StopFloodFill,
a)}replaceTextureByVideo(a,b,c){return this.int.call({command:r.Tools_ReplaceTexture,texturePackage:a,newTexture:b,type:1},c)}replaceTextureByImage(a,b,c){return this.int.call({command:r.Tools_ReplaceTexture,texturePackage:a,newTexture:b,type:2},c)}replaceTextureByUrl(a,b,c){return this.int.call({command:r.Tools_ReplaceTexture,texturePackage:a,newTexture:b,type:3},c)}restoreTexture(a,b){return this.int.call({command:r.Tools_RestoreTexture,ids:I(a)},b)}}class xb{constructor(a){this.int=a}getParams(a){return this.int.call0(r.Weather_GetParams,
a)}_setParam(a,b){return this.int.call({command:r.Weather_SetParams,data:a},b)}setDateTime(a,b,c,e,d,h,g){return this.int.call({command:r.Weather_SetDate,year:a,month:b,day:c,hour:e,minute:d,daynightLoop:h},g)}getDateTime(a){return this.int.call0(r.Weather_GetDate,a)}simulateTime(a,b,c,e){let d=0,h=0,g=0,q=0;a instanceof Array?(0<a.length&&(d=a[0]),1<a.length&&(h=a[1])):d=parseInt(a);b instanceof Array?(0<b.length&&(g=b[0]),1<b.length&&(q=b[1])):g=parseInt(b);return this.int.call({command:r.Weather_SimulateTime,
startHour:d,startMinute:h,endHour:g,endMinute:q,duration:c},e)}setCloudThickness(a,b){return this.int.call({command:r.Weather_SetParams,cloudThickness:a},b)}setCloudDensity(a,b){return this.int.call({command:r.Weather_SetParams,cloudDensity:a},b)}setRainParam(a,b,c,e){return this.int.call({command:r.Weather_SetParams,rainsnow:0,rainsnowStrength:a,rainsnowSpeed:b,raindropSize:c},e)}setSnowParam(a,b,c,e){return this.int.call({command:r.Weather_SetParams,rainsnow:1,rainsnowStrength:a,rainsnowSpeed:b,
snowflakeSize:c},e)}disableRainSnow(a){return this.int.call({command:r.Weather_SetParams,rainsnowStrength:0},a)}setFogParam(a,b,c,e){return this.int.call({command:r.Weather_SetParams,fogDensity:a,fogGroundDensity:b,fogGroundHeight:c},e)}setSunIntensity(a,b){return this.int.call({command:r.Weather_SetParams,sunIntensity:a},b)}setMoonIntensity(a,b){return this.int.call({command:r.Weather_SetParams,moonIntensity:a},b)}setAmbientLightIntensity(a,b){return this.int.call({command:r.Weather_SetParams,ambientLightIntensity:a},
b)}setTemperature(a,b){return this.int.call({command:r.Weather_SetParams,temperature:a},b)}setShadowQuality(a,b){return this.int.call({command:r.Weather_SetParams,shadowQuality:a},b)}setShadowDistance(a,b){return this.int.call({command:r.Weather_SetParams,shadowDistance:a},b)}setDarkMode(a,b){return this.int.call({command:r.Weather_SetParams,darkMode:!!a},b)}}var la={};class da{constructor(a,b,c){la=this;"function"==typeof da.__onApiConstructed&&da.__onApiConstructed(la);this.callbackMap=new Map;
this.eventCall=this.webSocket=null;this.isFirstReady=!0;this.callbackIndex=0;this.isConnected=!1;this.onApiVersionReceived=void 0;"function"==typeof b?(this.onReadyCall=b,"function"==typeof c&&(this.fnLog=c)):"object"==typeof b&&(this.onReadyCall=b.onReady,this.eventCall=b.onEvent,this.fnLog=b.onLog,this.useColorLog=b.useColorLog,this.onApiVersionReceived=b.onApiVersion,(this.player=b.player)&&(this.player.aircityApi=this));this.player||(b=a.split("-"),4==b.length?(a=b[0],c=[],c[0]=a>>>24>>>0,c[1]=
a<<8>>>24>>>0,c[2]=a<<16>>>24,c[3]=a<<24>>>24,this.url=`ws://${String(c[0])+"."+String(c[1])+"."+String(c[2])+"."+String(c[3])}:${b[3]}`):this.url=`ws://${a}`,this.initWebSocket());this.initInterface()}setHost(a,b){this.url=`ws://${a}:${b}`}reconnect(){this.initWebSocket(this.host,this.fnLog)}_getCBIndex(){return++this.callbackIndex}call0(a,b){return this.call({command:a},b)}call(a,b){if(!this.isConnected)return this.logWithColor("red","Not connected!"),b?void 0:Promise.reject("Not connected!");if(void 0==
a.command||a.command==r.None)return this.logWithColor("red","command is undefined or None"),b?void 0:Promise.reject("command is undefined or None");a.timestamp=Date.now();a.callbackIndex=this._getCBIndex();a.__command=r[a.command]||"Unknown";null===b&&(a.__noResponse=!0);let c=a.command+"_"+a.callbackIndex;b&&(this.callbackMap[c]=b);let e=JSON.stringify(a);this.log("");this.logWithColor("RoyalBlue",`Request: ${r[a.command]||"Unknown"}`,!0);this.logWithColor("green","\uff08"+(new Date(a.timestamp)).toLocaleTimeString()+
"\uff09");this.logWithColor("gray",`${e}`);if(b)this.player?this.player.rtc_send_api(a):this.webSocket.send(e);else return new Promise(d=>{this.callbackMap[c]=d;this.player?this.player.rtc_send_api(a):this.webSocket.send(e)})}onEvent(a){this.eventCall&&this.eventCall(a)}onReady(){this.player&&this.player.onApiReady();this.onReadyCall&&this.onReadyCall();this.call({command:r.Misc_GetVersion})}setEventCallback(a){this.eventCall=a}log(a,b,c){this.fnLog&&this.fnLog(a,b,c)}logWithColor(a,b,c){this.fnLog&&
(this.useColorLog?this.log(`<font color='${a}'>${b}</font>`,c):this.log(b,c))}onConnectionOpen(){this.isConnected=!0;this.logWithColor("blue","Connected!")}onConnectionClose(a){this.isConnected=!1;this.logWithColor("red",`Closed! code: ${a.code}, reason: ${1006==a.code?"close abnormal":a.reason||a.message||"-"}`);this.log("");this.logWithColor("SpringGreen","Reconnecting...");this.isDestroyed||this.player||this.reconnect()}onConnectionMessage(a){this.log("");let b=null;try{b=JSON.parse(a)}catch(e){console.error(e.message);
this.log("Response: [Unknown]");return}if(b.command==r.Misc_GetVersion){this.misc.apiVersionServer=b.version||b.versionType;if("5.1"!=this.misc.apiVersionServer){var c=`\u8b66\u544a\uff1a\n--------------------------------------------------\n    ac.min.js\u6587\u4ef6\u7248\u672c\u548c\u4e91\u6e32\u67d3\u670d\u52a1\u5668\u7684\u6587\u4ef6\u7248\u672c\u4e0d\u4e00\u81f4\uff1as:${this.misc.apiVersionServer}-c:${"5.1"}\uff0c\n    \u53ef\u80fd\u9020\u6210\u63a5\u53e3\u8c03\u7528\u9519\u8bef\u6216\u5d29\u6e83\uff0c\n    \u8bf7\u786e\u4fdd\u672c\u5730\u5de5\u7a0b\u7684ac.min.js\u7248\u672c\u548cCloudMaster\u6700\u65b0\u5b89\u88c5\u7684\u6587\u4ef6\u7248\u672c\u4e00\u81f4!`;
console.warn(c);alert(c)}if(this.onApiVersionReceived)this.onApiVersionReceived(this.misc.apiVersionServer)}b.command?(c=Date.now()-b.timestamp,this.logWithColor("RoyalBlue",`Response: ${r[b.command]||"Unknown"}`,!0),this.logWithColor("green",`\uff08\u8017\u65f6\uff1a${c}ms\uff09`),this.logWithColor("gray",`\u8bf7\u6c42\u65f6\u95f4\uff1a${(new Date(b.timestamp)).toLocaleTimeString()}`,!0),this.logWithColor("gray",`  \u54cd\u5e94\u65f6\u95f4\uff1a${(new Date(Date.now())).toLocaleTimeString()}`)):b.eventtype?
this.log("Response: Event"):this.log("Response: [Unknown]");this.logWithColor("gray",a);a=b.command+"_"+b.callbackIndex;if(c=this.callbackMap[a])c(b),delete this.callbackMap[a];if(b.eventtype)if("CompleteInitialization"==b.eventtype)this.log("The initialization is complete, now you can call the interfaces in onReady callback function."),this.onReady();else if("NodeConfiguration"==b.eventtype)this.resourcesPath=b.ResourcesPath,this.log("ResourcesPath:"+this.resourcesPath);else this.onEvent(b)}onConnectionError(a){console.error("WebSocket error observed")}initWebSocket(){this.player||
("WebSocket"in window?(this.log(`Connecting: ${this.url}`),this.webSocket=new WebSocket(this.url),this.webSocket.onopen=()=>this.onConnectionOpen(),this.webSocket.onmessage=a=>this.onConnectionMessage(a.data),this.webSocket.onclose=a=>this.onConnectionClose(a),this.webSocket.onerror=a=>this.onConnectionError(a)):this.log("Not Support WebSocket!"))}initInterface(){this.camera=new pb(this);this.coord=new qb(this);this.layers=this.infoTree=new sb(this);this.ct=this.cameraTour=new Ra(this);this.tl=this.tileLayer=
new lb(this);this.tag=new kb(this);this.marker=new bb(this);this.marker3d=new cb(this);this.ctag=this.customTag=new Va(this);this.rp=this.radiationPoint=new ib(this);this.cm=this.customMesh=new Ta(this);this.wm=this.waterMesh=new ob(this);this.waterFlowField=new nb(this);this.wff=this.WaterFlowField;this.line=this.polyline=new hb(this);this.ol=this.odline=new db(this);this.p3d=this.polygon3d=new gb(this);this.polygon=new fb(this);this.hm=this.heatmap=new Za(this);this.beam=new Qa(this);this.ha=this.highlightArea=
new $a(this);this.co=this.customObject=new Ua(this);this.vp=this.videoProjection=new mb(this);this.panorama=new eb(this);this.decal=new Wa(this);this.dw=this.dynamicWater=new Xa(this);this.ff=this.floodFill=new Ya(this);this.c3d=this.cesium3DTileset=new Sa(this);this.shp=this.shapeFile=new jb(this);this.misc=new tb(this);this.tools=new wb(this);this.settings=new ub(this);this.weather=new xb(this);this.light=new ab(this);this.eh=this.editHelper=new rb(this);this.sp=this.settingsPanel=new vb(this)}destroy(){this.isDestroyed=
!0;this.player?this.player.destroy():this.webSocket&&this.webSocket.close()}reset(a){return this.call0(r.Reset,a)}quit(){return this.call0(r.Quit)}}(function(a){"object"===typeof C&&"undefined"!==typeof module?module.exports=a():"function"===typeof define&&define.amd?define([],a):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).adapter=a()})(function(){return function(){function a(b,c,e){function d(q,k){if(!c[q]){if(!b[q]){var f="function"==
typeof require&&require;if(!k&&f)return f(q,!0);if(h)return h(q,!0);k=Error("Cannot find module '"+q+"'");throw k.code="MODULE_NOT_FOUND",k;}k=c[q]={exports:{}};b[q][0].call(k.exports,function(l){return d(b[q][1][l]||l)},k,k.exports,a,b,c,e)}return c[q].exports}for(var h="function"==typeof require&&require,g=0;g<e.length;g++)d(e[g]);return d}return a}()({1:[function(a,b,c){a=(0,a("./adapter_factory.js").adapterFactory)({window});b.exports=a},{"./adapter_factory.js":2}],2:[function(a,b,c){function e(l){if(l&&
l.__esModule)return l;var t={};if(null!=l)for(var v in l)Object.prototype.hasOwnProperty.call(l,v)&&(t[v]=l[v]);t.default=l;return t}Object.defineProperty(c,"__esModule",{value:!0});c.adapterFactory=function(){var l=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).window,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},v=d.log,p=d.detectBrowser(l),x={browserDetails:p,commonShim:f,extractVersion:d.extractVersion,disableLog:d.disableLog,
disableWarnings:d.disableWarnings};switch(p.browser){case "chrome":if(!h||!h.shimPeerConnection||!t.shimChrome){v("Chrome shim is not included in this adapter release.");break}if(null===p.version){v("Chrome shim can not determine version, not shimming.");break}v("adapter.js shimming chrome.");x.browserShim=h;h.shimGetUserMedia(l);h.shimMediaStream(l);h.shimPeerConnection(l);h.shimOnTrack(l);h.shimAddTrackRemoveTrack(l);h.shimGetSendersWithDtmf(l);h.shimGetStats(l);h.shimSenderReceiverGetStats(l);
h.fixNegotiationNeeded(l);f.shimRTCIceCandidate(l);f.shimConnectionState(l);f.shimMaxMessageSize(l);f.shimSendThrowTypeError(l);f.removeAllowExtmapMixed(l);break;case "firefox":if(!q||!q.shimPeerConnection||!t.shimFirefox){v("Firefox shim is not included in this adapter release.");break}v("adapter.js shimming firefox.");x.browserShim=q;q.shimGetUserMedia(l);q.shimPeerConnection(l);q.shimOnTrack(l);q.shimRemoveStream(l);q.shimSenderGetStats(l);q.shimReceiverGetStats(l);q.shimRTCDataChannel(l);q.shimAddTransceiver(l);
q.shimGetParameters(l);q.shimCreateOffer(l);q.shimCreateAnswer(l);f.shimRTCIceCandidate(l);f.shimConnectionState(l);f.shimMaxMessageSize(l);f.shimSendThrowTypeError(l);break;case "edge":if(!g||!g.shimPeerConnection||!t.shimEdge){v("MS edge shim is not included in this adapter release.");break}v("adapter.js shimming edge.");x.browserShim=g;g.shimGetUserMedia(l);g.shimGetDisplayMedia(l);g.shimPeerConnection(l);g.shimReplaceTrack(l);f.shimMaxMessageSize(l);f.shimSendThrowTypeError(l);break;case "safari":if(!k||
!t.shimSafari){v("Safari shim is not included in this adapter release.");break}v("adapter.js shimming safari.");x.browserShim=k;k.shimRTCIceServerUrls(l);k.shimCreateOfferLegacy(l);k.shimCallbacksAPI(l);k.shimLocalStreamsAPI(l);k.shimRemoteStreamsAPI(l);k.shimTrackEventTransceiver(l);k.shimGetUserMedia(l);k.shimAudioContext(l);f.shimRTCIceCandidate(l);f.shimMaxMessageSize(l);f.shimSendThrowTypeError(l);f.removeAllowExtmapMixed(l);break;default:v("Unsupported browser!")}return x};b=a("./utils");var d=
e(b);b=a("./chrome/chrome_shim");var h=e(b);b=a("./edge/edge_shim");var g=e(b);b=a("./firefox/firefox_shim");var q=e(b);b=a("./safari/safari_shim");var k=e(b);a=a("./common_shim");var f=e(a)},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(a,b,c){function e(f,l,t){l in f?Object.defineProperty(f,l,{value:t,enumerable:!0,configurable:!0,writable:!0}):f[l]=t;return f}function d(f){f.RTCPeerConnection.prototype.getLocalStreams=
function(){var x=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};return Object.keys(this._shimmedLocalStreams).map(function(u){return x._shimmedLocalStreams[u][0]})};var l=f.RTCPeerConnection.prototype.addTrack;f.RTCPeerConnection.prototype.addTrack=function(x,u){if(!u)return l.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var z=l.apply(this,arguments);this._shimmedLocalStreams[u.id]?-1===this._shimmedLocalStreams[u.id].indexOf(z)&&this._shimmedLocalStreams[u.id].push(z):
this._shimmedLocalStreams[u.id]=[u,z];return z};var t=f.RTCPeerConnection.prototype.addStream;f.RTCPeerConnection.prototype.addStream=function(x){var u=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};x.getTracks().forEach(function(n){if(u.getSenders().find(function(w){return w.track===n}))throw new DOMException("Track already exists.","InvalidAccessError");});var z=this.getSenders();t.apply(this,arguments);var m=this.getSenders().filter(function(n){return-1===z.indexOf(n)});this._shimmedLocalStreams[x.id]=
[x].concat(m)};var v=f.RTCPeerConnection.prototype.removeStream;f.RTCPeerConnection.prototype.removeStream=function(x){this._shimmedLocalStreams=this._shimmedLocalStreams||{};delete this._shimmedLocalStreams[x.id];return v.apply(this,arguments)};var p=f.RTCPeerConnection.prototype.removeTrack;f.RTCPeerConnection.prototype.removeTrack=function(x){var u=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};x&&Object.keys(this._shimmedLocalStreams).forEach(function(z){var m=u._shimmedLocalStreams[z].indexOf(x);
-1!==m&&u._shimmedLocalStreams[z].splice(m,1);1===u._shimmedLocalStreams[z].length&&delete u._shimmedLocalStreams[z]});return p.apply(this,arguments)}}Object.defineProperty(c,"__esModule",{value:!0});c.shimGetDisplayMedia=c.shimGetUserMedia=void 0;var h="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(f){return typeof f}:function(f){return f&&"function"===typeof Symbol&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},g=a("./getusermedia");Object.defineProperty(c,
"shimGetUserMedia",{enumerable:!0,get:function(){return g.shimGetUserMedia}});var q=a("./getdisplaymedia");Object.defineProperty(c,"shimGetDisplayMedia",{enumerable:!0,get:function(){return q.shimGetDisplayMedia}});c.shimMediaStream=function(f){f.MediaStream=f.MediaStream||f.webkitMediaStream};c.shimOnTrack=function(f){if("object"!==("undefined"===typeof f?"undefined":h(f))||!f.RTCPeerConnection||"ontrack"in f.RTCPeerConnection.prototype)k.wrapPeerConnectionEvent(f,"track",function(t){t.transceiver||
Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}});return t});else{Object.defineProperty(f.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(t){this._ontrack&&this.removeEventListener("track",this._ontrack);this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});var l=f.RTCPeerConnection.prototype.setRemoteDescription;f.RTCPeerConnection.prototype.setRemoteDescription=function(){var t=this;this._ontrackpoly||(this._ontrackpoly=
function(v){v.stream.addEventListener("addtrack",function(p){var x=void 0;x=f.RTCPeerConnection.prototype.getReceivers?t.getReceivers().find(function(z){return z.track&&z.track.id===p.track.id}):{track:p.track};var u=new Event("track");u.track=p.track;u.receiver=x;u.transceiver={receiver:x};u.streams=[v.stream];t.dispatchEvent(u)});v.stream.getTracks().forEach(function(p){var x=void 0;x=f.RTCPeerConnection.prototype.getReceivers?t.getReceivers().find(function(z){return z.track&&z.track.id===p.id}):
{track:p};var u=new Event("track");u.track=p;u.receiver=x;u.transceiver={receiver:x};u.streams=[v.stream];t.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly));return l.apply(this,arguments)}}};c.shimGetSendersWithDtmf=function(f){if("object"===("undefined"===typeof f?"undefined":h(f))&&f.RTCPeerConnection&&!("getSenders"in f.RTCPeerConnection.prototype)&&"createDTMFSender"in f.RTCPeerConnection.prototype){var l=function(z,m){return{track:m,get dtmf(){void 0===this._dtmf&&(this._dtmf=
"audio"===m.kind?z.createDTMFSender(m):null);return this._dtmf},_pc:z}};if(!f.RTCPeerConnection.prototype.getSenders){f.RTCPeerConnection.prototype.getSenders=function(){this._senders=this._senders||[];return this._senders.slice()};var t=f.RTCPeerConnection.prototype.addTrack;f.RTCPeerConnection.prototype.addTrack=function(z,m){var n=t.apply(this,arguments);n||(n=l(this,z),this._senders.push(n));return n};var v=f.RTCPeerConnection.prototype.removeTrack;f.RTCPeerConnection.prototype.removeTrack=function(z){v.apply(this,
arguments);var m=this._senders.indexOf(z);-1!==m&&this._senders.splice(m,1)}}var p=f.RTCPeerConnection.prototype.addStream;f.RTCPeerConnection.prototype.addStream=function(z){var m=this;this._senders=this._senders||[];p.apply(this,[z]);z.getTracks().forEach(function(n){m._senders.push(l(m,n))})};var x=f.RTCPeerConnection.prototype.removeStream;f.RTCPeerConnection.prototype.removeStream=function(z){var m=this;this._senders=this._senders||[];x.apply(this,[z]);z.getTracks().forEach(function(n){var w=
m._senders.find(function(y){return y.track===n});w&&m._senders.splice(m._senders.indexOf(w),1)})}}else if("object"===("undefined"===typeof f?"undefined":h(f))&&f.RTCPeerConnection&&"getSenders"in f.RTCPeerConnection.prototype&&"createDTMFSender"in f.RTCPeerConnection.prototype&&f.RTCRtpSender&&!("dtmf"in f.RTCRtpSender.prototype)){var u=f.RTCPeerConnection.prototype.getSenders;f.RTCPeerConnection.prototype.getSenders=function(){var z=this,m=u.apply(this,[]);m.forEach(function(n){return n._pc=z});
return m};Object.defineProperty(f.RTCRtpSender.prototype,"dtmf",{get:function(){void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null);return this._dtmf}})}};c.shimGetStats=function(f){if(f.RTCPeerConnection){var l=f.RTCPeerConnection.prototype.getStats;f.RTCPeerConnection.prototype.getStats=function(){var t=this,v=Array.prototype.slice.call(arguments),p=v[0],x=v[1];v=v[2];if(0<arguments.length&&"function"===typeof p)return l.apply(this,arguments);if(0===
l.length&&(0===arguments.length||"function"!==typeof p))return l.apply(this,[]);var u=function(m){var n={};m.result().forEach(function(w){var y={id:w.id,timestamp:w.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[w.type]||w.type};w.names().forEach(function(A){y[A]=w.stat(A)});n[y.id]=y});return n},z=function(m){return new Map(Object.keys(m).map(function(n){return[n,m[n]]}))};return 2<=arguments.length?l.apply(this,[function(m){x(z(u(m)))},p]):(new Promise(function(m,
n){l.apply(t,[function(w){m(z(u(w)))},n])})).then(x,v)}}};c.shimSenderReceiverGetStats=function(f){if("object"===("undefined"===typeof f?"undefined":h(f))&&f.RTCPeerConnection&&f.RTCRtpSender&&f.RTCRtpReceiver){if(!("getStats"in f.RTCRtpSender.prototype)){var l=f.RTCPeerConnection.prototype.getSenders;l&&(f.RTCPeerConnection.prototype.getSenders=function(){var x=this,u=l.apply(this,[]);u.forEach(function(z){return z._pc=x});return u});var t=f.RTCPeerConnection.prototype.addTrack;t&&(f.RTCPeerConnection.prototype.addTrack=
function(){var x=t.apply(this,arguments);x._pc=this;return x});f.RTCRtpSender.prototype.getStats=function(){var x=this;return this._pc.getStats().then(function(u){return k.filterStats(u,x.track,!0)})}}if(!("getStats"in f.RTCRtpReceiver.prototype)){var v=f.RTCPeerConnection.prototype.getReceivers;v&&(f.RTCPeerConnection.prototype.getReceivers=function(){var x=this,u=v.apply(this,[]);u.forEach(function(z){return z._pc=x});return u});k.wrapPeerConnectionEvent(f,"track",function(x){x.receiver._pc=x.srcElement;
return x});f.RTCRtpReceiver.prototype.getStats=function(){var x=this;return this._pc.getStats().then(function(u){return k.filterStats(u,x.track,!1)})}}if("getStats"in f.RTCRtpSender.prototype&&"getStats"in f.RTCRtpReceiver.prototype){var p=f.RTCPeerConnection.prototype.getStats;f.RTCPeerConnection.prototype.getStats=function(){if(0<arguments.length&&arguments[0]instanceof f.MediaStreamTrack){var x=arguments[0],u=void 0,z=void 0,m=void 0;this.getSenders().forEach(function(n){n.track===x&&(u?m=!0:u=
n)});this.getReceivers().forEach(function(n){n.track===x&&(z?m=!0:z=n);return n.track===x});return m||u&&z?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):u?u.getStats():z?z.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return p.apply(this,arguments)}}}};c.shimAddTrackRemoveTrackWithNative=d;c.shimAddTrackRemoveTrack=function(f){function l(n,w){var y=w.sdp;Object.keys(n._reverseStreams||
[]).forEach(function(A){A=n._reverseStreams[A];y=y.replace(new RegExp(n._streams[A.id].id,"g"),A.id)});return new RTCSessionDescription({type:w.type,sdp:y})}function t(n,w){var y=w.sdp;Object.keys(n._reverseStreams||[]).forEach(function(A){A=n._reverseStreams[A];y=y.replace(new RegExp(A.id,"g"),n._streams[A.id].id)});return new RTCSessionDescription({type:w.type,sdp:y})}if(f.RTCPeerConnection){var v=k.detectBrowser(f);if(f.RTCPeerConnection.prototype.addTrack&&65<=v.version)return d(f);var p=f.RTCPeerConnection.prototype.getLocalStreams;
f.RTCPeerConnection.prototype.getLocalStreams=function(){var n=this,w=p.apply(this);this._reverseStreams=this._reverseStreams||{};return w.map(function(y){return n._reverseStreams[y.id]})};var x=f.RTCPeerConnection.prototype.addStream;f.RTCPeerConnection.prototype.addStream=function(n){var w=this;this._streams=this._streams||{};this._reverseStreams=this._reverseStreams||{};n.getTracks().forEach(function(A){if(w.getSenders().find(function(B){return B.track===A}))throw new DOMException("Track already exists.",
"InvalidAccessError");});if(!this._reverseStreams[n.id]){var y=new f.MediaStream(n.getTracks());this._streams[n.id]=y;this._reverseStreams[y.id]=n;n=y}x.apply(this,[n])};var u=f.RTCPeerConnection.prototype.removeStream;f.RTCPeerConnection.prototype.removeStream=function(n){this._streams=this._streams||{};this._reverseStreams=this._reverseStreams||{};u.apply(this,[this._streams[n.id]||n]);delete this._reverseStreams[this._streams[n.id]?this._streams[n.id].id:n.id];delete this._streams[n.id]};f.RTCPeerConnection.prototype.addTrack=
function(n,w){var y=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var A=[].slice.call(arguments,1);if(1!==A.length||!A[0].getTracks().find(function(B){return B===n}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(B){return B.track===n}))throw new DOMException("Track already exists.",
"InvalidAccessError");this._streams=this._streams||{};this._reverseStreams=this._reverseStreams||{};(A=this._streams[w.id])?(A.addTrack(n),Promise.resolve().then(function(){y.dispatchEvent(new Event("negotiationneeded"))})):(A=new f.MediaStream([n]),this._streams[w.id]=A,this._reverseStreams[A.id]=w,this.addStream(A));return this.getSenders().find(function(B){return B.track===n})};["createOffer","createAnswer"].forEach(function(n){var w=f.RTCPeerConnection.prototype[n],y=e({},n,function(){var A=this,
B=arguments;return arguments.length&&"function"===typeof arguments[0]?w.apply(this,[function(D){D=l(A,D);B[0].apply(null,[D])},function(D){B[1]&&B[1].apply(null,D)},arguments[2]]):w.apply(this,arguments).then(function(D){return l(A,D)})});f.RTCPeerConnection.prototype[n]=y[n]});var z=f.RTCPeerConnection.prototype.setLocalDescription;f.RTCPeerConnection.prototype.setLocalDescription=function(){if(!arguments.length||!arguments[0].type)return z.apply(this,arguments);arguments[0]=t(this,arguments[0]);
return z.apply(this,arguments)};var m=Object.getOwnPropertyDescriptor(f.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(f.RTCPeerConnection.prototype,"localDescription",{get:function(){var n=m.get.apply(this);return""===n.type?n:l(this,n)}});f.RTCPeerConnection.prototype.removeTrack=function(n){var w=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!n._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.",
"TypeError");if(n._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var y=void 0;Object.keys(this._streams).forEach(function(A){w._streams[A].getTracks().find(function(B){return n.track===B})&&(y=w._streams[A])});y&&(1===y.getTracks().length?this.removeStream(this._reverseStreams[y.id]):y.removeTrack(n.track),this.dispatchEvent(new Event("negotiationneeded")))}}};c.shimPeerConnection=function(f){var l=k.detectBrowser(f);
!f.RTCPeerConnection&&f.webkitRTCPeerConnection&&(f.RTCPeerConnection=f.webkitRTCPeerConnection);if(f.RTCPeerConnection){var t=0===f.RTCPeerConnection.prototype.addIceCandidate.length;53>l.version&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(p){var x=f.RTCPeerConnection.prototype[p],u=e({},p,function(){arguments[0]=new ("addIceCandidate"===p?f.RTCIceCandidate:f.RTCSessionDescription)(arguments[0]);return x.apply(this,arguments)});f.RTCPeerConnection.prototype[p]=
u[p]});var v=f.RTCPeerConnection.prototype.addIceCandidate;f.RTCPeerConnection.prototype.addIceCandidate=function(){return t||arguments[0]?78>l.version&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():v.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};c.fixNegotiationNeeded=function(f){var l=k.detectBrowser(f);k.wrapPeerConnectionEvent(f,"negotiationneeded",function(t){var v=t.target;if(!(72>l.version||v.getConfiguration&&"plan-b"===v.getConfiguration().sdpSemantics)||
"stable"===v.signalingState)return t})};var k=function(f){if(f&&f.__esModule)return f;var l={};if(null!=f)for(var t in f)Object.prototype.hasOwnProperty.call(f,t)&&(l[t]=f[t]);l.default=f;return l}(a("../utils.js"))},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(a,b,c){Object.defineProperty(c,"__esModule",{value:!0});c.shimGetDisplayMedia=function(e,d){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||!e.navigator.mediaDevices||("function"!==typeof d?
console.error("shimGetDisplayMedia: getSourceId argument is not a function"):e.navigator.mediaDevices.getDisplayMedia=function(h){return d(h).then(function(g){var q=h.video&&h.video.width,k=h.video&&h.video.height;h.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:g,maxFrameRate:h.video&&h.video.frameRate||3}};q&&(h.video.mandatory.maxWidth=q);k&&(h.video.mandatory.maxHeight=k);return e.navigator.mediaDevices.getUserMedia(h)})})}},{}],5:[function(a,b,c){Object.defineProperty(c,"__esModule",
{value:!0});var e="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(g){return typeof g}:function(g){return g&&"function"===typeof Symbol&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g};c.shimGetUserMedia=function(g){var q=g&&g.navigator;if(q.mediaDevices){var k=d.detectBrowser(g),f=function(p){if("object"!==("undefined"===typeof p?"undefined":e(p))||p.mandatory||p.optional)return p;var x={};Object.keys(p).forEach(function(u){if("require"!==u&&"advanced"!==u&&
"mediaSource"!==u){var z="object"===e(p[u])?p[u]:{ideal:p[u]};void 0!==z.exact&&"number"===typeof z.exact&&(z.min=z.max=z.exact);var m=function(w,y){return w?w+y.charAt(0).toUpperCase()+y.slice(1):"deviceId"===y?"sourceId":y};if(void 0!==z.ideal){x.optional=x.optional||[];var n={};"number"===typeof z.ideal?(n[m("min",u)]=z.ideal,x.optional.push(n),n={},n[m("max",u)]=z.ideal):n[m("",u)]=z.ideal;x.optional.push(n)}void 0!==z.exact&&"number"!==typeof z.exact?(x.mandatory=x.mandatory||{},x.mandatory[m("",
u)]=z.exact):["min","max"].forEach(function(w){void 0!==z[w]&&(x.mandatory=x.mandatory||{},x.mandatory[m(w,u)]=z[w])})}});p.advanced&&(x.optional=(x.optional||[]).concat(p.advanced));return x},l=function(p,x){if(61<=k.version)return x(p);if((p=JSON.parse(JSON.stringify(p)))&&"object"===e(p.audio)){var u=function(n,w,y){w in n&&!(y in n)&&(n[y]=n[w],delete n[w])};p=JSON.parse(JSON.stringify(p));u(p.audio,"autoGainControl","googAutoGainControl");u(p.audio,"noiseSuppression","googNoiseSuppression");
p.audio=f(p.audio)}if(p&&"object"===e(p.video)){var z=p.video.facingMode;z=z&&("object"===("undefined"===typeof z?"undefined":e(z))?z:{ideal:z});u=66>k.version;if(!(!z||"user"!==z.exact&&"environment"!==z.exact&&"user"!==z.ideal&&"environment"!==z.ideal||q.mediaDevices.getSupportedConstraints&&q.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete p.video.facingMode;var m=void 0;if("environment"===z.exact||"environment"===z.ideal)m=["back","rear"];else if("user"===z.exact||"user"===z.ideal)m=
["front"];if(m)return q.mediaDevices.enumerateDevices().then(function(n){n=n.filter(function(y){return"videoinput"===y.kind});var w=n.find(function(y){return m.some(function(A){return y.label.toLowerCase().includes(A)})});!w&&n.length&&m.includes("back")&&(w=n[n.length-1]);w&&(p.video.deviceId=z.exact?{exact:w.deviceId}:{ideal:w.deviceId});p.video=f(p.video);h("chrome: "+JSON.stringify(p));return x(p)})}p.video=f(p.video)}h("chrome: "+JSON.stringify(p));return x(p)},t=function(p){return 64<=k.version?
p:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[p.name]||p.name,message:p.message,constraint:p.constraint||p.constraintName,
toString:function(){return this.name+(this.message&&": ")+this.message}}};q.getUserMedia=function(p,x,u){l(p,function(z){q.webkitGetUserMedia(z,x,function(m){u&&u(t(m))})})}.bind(q);if(q.mediaDevices.getUserMedia){var v=q.mediaDevices.getUserMedia.bind(q.mediaDevices);q.mediaDevices.getUserMedia=function(p){return l(p,function(x){return v(x).then(function(u){if(x.audio&&!u.getAudioTracks().length||x.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(function(z){z.stop()}),new DOMException("",
"NotFoundError");return u},function(u){return Promise.reject(t(u))})})}}}};var d=function(g){if(g&&g.__esModule)return g;var q={};if(null!=g)for(var k in g)Object.prototype.hasOwnProperty.call(g,k)&&(q[k]=g[k]);q.default=g;return q}(a("../utils.js")),h=d.log},{"../utils.js":15}],6:[function(a,b,c){Object.defineProperty(c,"__esModule",{value:!0});var e="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(g){return typeof g}:function(g){return g&&"function"===typeof Symbol&&g.constructor===
Symbol&&g!==Symbol.prototype?"symbol":typeof g};c.shimRTCIceCandidate=function(g){if(g.RTCIceCandidate&&!(g.RTCIceCandidate&&"foundation"in g.RTCIceCandidate.prototype)){var q=g.RTCIceCandidate;g.RTCIceCandidate=function(k){"object"===("undefined"===typeof k?"undefined":e(k))&&k.candidate&&0===k.candidate.indexOf("a=")&&(k=JSON.parse(JSON.stringify(k)),k.candidate=k.candidate.substr(2));if(k.candidate&&k.candidate.length){var f=new q(k);k=d.default.parseCandidate(k.candidate);var l=Object.assign(f,
k);l.toJSON=function(){return{candidate:l.candidate,sdpMid:l.sdpMid,sdpMLineIndex:l.sdpMLineIndex,usernameFragment:l.usernameFragment}};return l}return new q(k)};g.RTCIceCandidate.prototype=q.prototype;h.wrapPeerConnectionEvent(g,"icecandidate",function(k){k.candidate&&Object.defineProperty(k,"candidate",{value:new g.RTCIceCandidate(k.candidate),writable:"false"});return k})}};c.shimMaxMessageSize=function(g){if(g.RTCPeerConnection){var q=h.detectBrowser(g);"sctp"in g.RTCPeerConnection.prototype||
Object.defineProperty(g.RTCPeerConnection.prototype,"sctp",{get:function(){return"undefined"===typeof this._sctp?null:this._sctp}});var k=function(p){if(!p||!p.sdp)return!1;p=d.default.splitSections(p.sdp);p.shift();return p.some(function(x){return(x=d.default.parseMLine(x))&&"application"===x.kind&&-1!==x.protocol.indexOf("SCTP")})},f=function(p){p=p.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===p||2>p.length)return-1;p=parseInt(p[1],10);return p!==p?-1:p},l=function(p){var x=65536;"firefox"===
q.browser&&(x=57>q.version?-1===p?16384:2147483637:60>q.version?57===q.version?65535:65536:2147483637);return x},t=function(p,x){var u=65536;"firefox"===q.browser&&57===q.version&&(u=65535);p=d.default.matchPrefix(p.sdp,"a=max-message-size:");0<p.length?u=parseInt(p[0].substr(19),10):"firefox"===q.browser&&-1!==x&&(u=2147483637);return u},v=g.RTCPeerConnection.prototype.setRemoteDescription;g.RTCPeerConnection.prototype.setRemoteDescription=function(){this._sctp=null;"chrome"===q.browser&&76<=q.version&&
"plan-b"===this.getConfiguration().sdpSemantics&&Object.defineProperty(this,"sctp",{get:function(){return"undefined"===typeof this._sctp?null:this._sctp},enumerable:!0,configurable:!0});if(k(arguments[0])){var p=f(arguments[0]),x=l(p);p=t(arguments[0],p);var u=void 0;u=0===x&&0===p?Number.POSITIVE_INFINITY:0===x||0===p?Math.max(x,p):Math.min(x,p);x={};Object.defineProperty(x,"maxMessageSize",{get:function(){return u}});this._sctp=x}return v.apply(this,arguments)}}};c.shimSendThrowTypeError=function(g){function q(f,
l){var t=f.send;f.send=function(){var v=arguments[0];v=v.length||v.size||v.byteLength;if("open"===f.readyState&&l.sctp&&v>l.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+l.sctp.maxMessageSize+" bytes)");return t.apply(f,arguments)}}if(g.RTCPeerConnection&&"createDataChannel"in g.RTCPeerConnection.prototype){var k=g.RTCPeerConnection.prototype.createDataChannel;g.RTCPeerConnection.prototype.createDataChannel=function(){var f=k.apply(this,arguments);q(f,this);return f};
h.wrapPeerConnectionEvent(g,"datachannel",function(f){q(f.channel,f.target);return f})}};c.shimConnectionState=function(g){if(g.RTCPeerConnection&&!("connectionState"in g.RTCPeerConnection.prototype)){var q=g.RTCPeerConnection.prototype;Object.defineProperty(q,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0});Object.defineProperty(q,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||
null},set:function(k){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange);k&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=k)},enumerable:!0,configurable:!0});["setLocalDescription","setRemoteDescription"].forEach(function(k){var f=q[k];q[k]=function(){this._connectionstatechangepoly||(this._connectionstatechangepoly=function(l){var t=l.target;if(t._lastConnectionState!==
t.connectionState){t._lastConnectionState=t.connectionState;var v=new Event("connectionstatechange",l);t.dispatchEvent(v)}return l},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly));return f.apply(this,arguments)}})}};c.removeAllowExtmapMixed=function(g){if(g.RTCPeerConnection){var q=h.detectBrowser(g);if(!("chrome"===q.browser&&71<=q.version||"safari"===q.browser&&605<=q.version)){var k=g.RTCPeerConnection.prototype.setRemoteDescription;g.RTCPeerConnection.prototype.setRemoteDescription=
function(f){f&&f.sdp&&-1!==f.sdp.indexOf("\na=extmap-allow-mixed")&&(f.sdp=f.sdp.split("\n").filter(function(l){return"a=extmap-allow-mixed"!==l.trim()}).join("\n"));return k.apply(this,arguments)}}}};var d=(b=a("sdp"))&&b.__esModule?b:{default:b},h=function(g){if(g&&g.__esModule)return g;var q={};if(null!=g)for(var k in g)Object.prototype.hasOwnProperty.call(g,k)&&(q[k]=g[k]);q.default=g;return q}(a("./utils"))},{"./utils":15,sdp:17}],7:[function(a,b,c){Object.defineProperty(c,"__esModule",{value:!0});
c.shimGetDisplayMedia=c.shimGetUserMedia=void 0;var e=a("./getusermedia");Object.defineProperty(c,"shimGetUserMedia",{enumerable:!0,get:function(){return e.shimGetUserMedia}});var d=a("./getdisplaymedia");Object.defineProperty(c,"shimGetDisplayMedia",{enumerable:!0,get:function(){return d.shimGetDisplayMedia}});c.shimPeerConnection=function(k){var f=h.detectBrowser(k);if(k.RTCIceGatherer&&(k.RTCIceCandidate||(k.RTCIceCandidate=function(v){return v}),k.RTCSessionDescription||(k.RTCSessionDescription=
function(v){return v}),15025>f.version)){var l=Object.getOwnPropertyDescriptor(k.MediaStreamTrack.prototype,"enabled");Object.defineProperty(k.MediaStreamTrack.prototype,"enabled",{set:function(v){l.set.call(this,v);var p=new Event("enabled");p.enabled=v;this.dispatchEvent(p)}})}!k.RTCRtpSender||"dtmf"in k.RTCRtpSender.prototype||Object.defineProperty(k.RTCRtpSender.prototype,"dtmf",{get:function(){void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new k.RTCDtmfSender(this):"video"===this.track.kind&&
(this._dtmf=null));return this._dtmf}});k.RTCDtmfSender&&!k.RTCDTMFSender&&(k.RTCDTMFSender=k.RTCDtmfSender);var t=(0,q.default)(k,f.version);k.RTCPeerConnection=function(v){v&&v.iceServers&&(v.iceServers=(0,g.filterIceServers)(v.iceServers,f.version),h.log("ICE servers after filtering:",v.iceServers));return new t(v)};k.RTCPeerConnection.prototype=t.prototype};c.shimReplaceTrack=function(k){!k.RTCRtpSender||"replaceTrack"in k.RTCRtpSender.prototype||(k.RTCRtpSender.prototype.replaceTrack=k.RTCRtpSender.prototype.setTrack)};
var h=function(k){if(k&&k.__esModule)return k;var f={};if(null!=k)for(var l in k)Object.prototype.hasOwnProperty.call(k,l)&&(f[l]=k[l]);f.default=k;return f}(a("../utils")),g=a("./filtericeservers"),q=(a=a("rtcpeerconnection-shim"))&&a.__esModule?a:{default:a}},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(a,b,c){Object.defineProperty(c,"__esModule",{value:!0});c.filterIceServers=function(d,h){var g=!1;d=JSON.parse(JSON.stringify(d));
return d.filter(function(q){if(q&&(q.urls||q.url)){var k=q.urls||q.url;q.url&&!q.urls&&e.deprecated("RTCIceServer.url","RTCIceServer.urls");var f="string"===typeof k;f&&(k=[k]);k=k.filter(function(l){return 0===l.indexOf("stun:")?!1:(l=l.startsWith("turn")&&!l.startsWith("turn:[")&&l.includes("transport=udp"))&&!g?g=!0:l&&!g});delete q.url;q.urls=f?k[0]:k;return!!k.length}})};var e=function(d){if(d&&d.__esModule)return d;var h={};if(null!=d)for(var g in d)Object.prototype.hasOwnProperty.call(d,g)&&
(h[g]=d[g]);h.default=d;return h}(a("../utils"))},{"../utils":15}],9:[function(a,b,c){Object.defineProperty(c,"__esModule",{value:!0});c.shimGetDisplayMedia=function(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&!(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)&&(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator))}},{}],10:[function(a,b,c){Object.defineProperty(c,"__esModule",{value:!0});c.shimGetUserMedia=function(e){e=e&&
e.navigator;var d=function(g){return{name:{PermissionDeniedError:"NotAllowedError"}[g.name]||g.name,message:g.message,constraint:g.constraint,toString:function(){return this.name}}},h=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(g){return h(g).catch(function(q){return Promise.reject(d(q))})}}},{}],11:[function(a,b,c){function e(k,f,l){f in k?Object.defineProperty(k,f,{value:l,enumerable:!0,configurable:!0,writable:!0}):k[f]=l;return k}Object.defineProperty(c,
"__esModule",{value:!0});c.shimGetDisplayMedia=c.shimGetUserMedia=void 0;var d="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(k){return typeof k}:function(k){return k&&"function"===typeof Symbol&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},h=a("./getusermedia");Object.defineProperty(c,"shimGetUserMedia",{enumerable:!0,get:function(){return h.shimGetUserMedia}});var g=a("./getdisplaymedia");Object.defineProperty(c,"shimGetDisplayMedia",{enumerable:!0,get:function(){return g.shimGetDisplayMedia}});
c.shimOnTrack=function(k){"object"===("undefined"===typeof k?"undefined":d(k))&&k.RTCTrackEvent&&"receiver"in k.RTCTrackEvent.prototype&&!("transceiver"in k.RTCTrackEvent.prototype)&&Object.defineProperty(k.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})};c.shimPeerConnection=function(k){var f=q.detectBrowser(k);if("object"===("undefined"===typeof k?"undefined":d(k))&&(k.RTCPeerConnection||k.mozRTCPeerConnection)){!k.RTCPeerConnection&&k.mozRTCPeerConnection&&
(k.RTCPeerConnection=k.mozRTCPeerConnection);53>f.version&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(p){var x=k.RTCPeerConnection.prototype[p],u=e({},p,function(){arguments[0]=new ("addIceCandidate"===p?k.RTCIceCandidate:k.RTCSessionDescription)(arguments[0]);return x.apply(this,arguments)});k.RTCPeerConnection.prototype[p]=u[p]});if(68>f.version){var l=k.RTCPeerConnection.prototype.addIceCandidate;k.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?
arguments[0]&&""===arguments[0].candidate?Promise.resolve():l.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}var t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},v=k.RTCPeerConnection.prototype.getStats;k.RTCPeerConnection.prototype.getStats=function(){var p=Array.prototype.slice.call(arguments),x=p[1],u=p[2];return v.apply(this,[p[0]||null]).then(function(z){if(53>
f.version&&!x)try{z.forEach(function(m){m.type=t[m.type]||m.type})}catch(m){if("TypeError"!==m.name)throw m;z.forEach(function(n,w){z.set(w,Object.assign({},n,{type:t[n.type]||n.type}))})}return z}).then(x,u)}}};c.shimSenderGetStats=function(k){if("object"===("undefined"===typeof k?"undefined":d(k))&&k.RTCPeerConnection&&k.RTCRtpSender&&!(k.RTCRtpSender&&"getStats"in k.RTCRtpSender.prototype)){var f=k.RTCPeerConnection.prototype.getSenders;f&&(k.RTCPeerConnection.prototype.getSenders=function(){var t=
this,v=f.apply(this,[]);v.forEach(function(p){return p._pc=t});return v});var l=k.RTCPeerConnection.prototype.addTrack;l&&(k.RTCPeerConnection.prototype.addTrack=function(){var t=l.apply(this,arguments);t._pc=this;return t});k.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}};c.shimReceiverGetStats=function(k){if("object"===("undefined"===typeof k?"undefined":d(k))&&k.RTCPeerConnection&&k.RTCRtpSender&&!(k.RTCRtpSender&&"getStats"in
k.RTCRtpReceiver.prototype)){var f=k.RTCPeerConnection.prototype.getReceivers;f&&(k.RTCPeerConnection.prototype.getReceivers=function(){var l=this,t=f.apply(this,[]);t.forEach(function(v){return v._pc=l});return t});q.wrapPeerConnectionEvent(k,"track",function(l){l.receiver._pc=l.srcElement;return l});k.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}};c.shimRemoveStream=function(k){!k.RTCPeerConnection||"removeStream"in k.RTCPeerConnection.prototype||(k.RTCPeerConnection.prototype.removeStream=
function(f){var l=this;q.deprecated("removeStream","removeTrack");this.getSenders().forEach(function(t){t.track&&f.getTracks().includes(t.track)&&l.removeTrack(t)})})};c.shimRTCDataChannel=function(k){k.DataChannel&&!k.RTCDataChannel&&(k.RTCDataChannel=k.DataChannel)};c.shimAddTransceiver=function(k){if("object"===("undefined"===typeof k?"undefined":d(k))&&k.RTCPeerConnection){var f=k.RTCPeerConnection.prototype.addTransceiver;f&&(k.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=
[];var l=arguments[1],t=l&&"sendEncodings"in l;t&&l.sendEncodings.forEach(function(x){if("rid"in x&&!/^[a-z0-9]{0,16}$/i.test(x.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in x&&!(1<=parseFloat(x.scaleResolutionDownBy)))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in x&&!(0<=parseFloat(x.maxFramerate)))throw new RangeError("max_framerate must be >= 0.0");});var v=f.apply(this,arguments);if(t){var p=v.sender;t=p.getParameters();
"encodings"in t||(t.encodings=l.sendEncodings,p.sendEncodings=l.sendEncodings,this.setParametersPromises.push(p.setParameters(t).then(function(){delete p.sendEncodings}).catch(function(){delete p.sendEncodings})))}return v})}};c.shimGetParameters=function(k){if("object"===("undefined"===typeof k?"undefined":d(k))&&k.RTCRtpSender){var f=k.RTCRtpSender.prototype.getParameters;f&&(k.RTCRtpSender.prototype.getParameters=function(){var l=f.apply(this,arguments);return"sendEncodings"in this?Object.assign({},
{encodings:this.sendEncodings},l):l})}};c.shimCreateOffer=function(k){if("object"===("undefined"===typeof k?"undefined":d(k))&&k.RTCPeerConnection){var f=k.RTCPeerConnection.prototype.createOffer;k.RTCPeerConnection.prototype.createOffer=function(){var l=this,t=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return f.apply(l,t)}).finally(function(){l.setParametersPromises=[]}):f.apply(this,arguments)}}};c.shimCreateAnswer=
function(k){if("object"===("undefined"===typeof k?"undefined":d(k))&&k.RTCPeerConnection){var f=k.RTCPeerConnection.prototype.createAnswer;k.RTCPeerConnection.prototype.createAnswer=function(){var l=this,t=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return f.apply(l,t)}).finally(function(){l.setParametersPromises=[]}):f.apply(this,arguments)}}};var q=function(k){if(k&&k.__esModule)return k;var f={};if(null!=
k)for(var l in k)Object.prototype.hasOwnProperty.call(k,l)&&(f[l]=k[l]);f.default=k;return f}(a("../utils"))},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(a,b,c){Object.defineProperty(c,"__esModule",{value:!0});c.shimGetDisplayMedia=function(e,d){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||!e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=function(h){if(!h||!h.video)return h=new DOMException("getDisplayMedia without video constraints is undefined"),
h.name="NotFoundError",h.code=8,Promise.reject(h);!0===h.video?h.video={mediaSource:d}:h.video.mediaSource=d;return e.navigator.mediaDevices.getUserMedia(h)})}},{}],13:[function(a,b,c){Object.defineProperty(c,"__esModule",{value:!0});var e="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(h){return typeof h}:function(h){return h&&"function"===typeof Symbol&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h};c.shimGetUserMedia=function(h){var g=d.detectBrowser(h),
q=h&&h.navigator;h=h&&h.MediaStreamTrack;q.getUserMedia=function(v,p,x){d.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia");q.mediaDevices.getUserMedia(v).then(p,x)};if(!(55<g.version&&"autoGainControl"in q.mediaDevices.getSupportedConstraints())){var k=function(v,p,x){p in v&&!(x in v)&&(v[x]=v[p],delete v[p])},f=q.mediaDevices.getUserMedia.bind(q.mediaDevices);q.mediaDevices.getUserMedia=function(v){"object"===("undefined"===typeof v?"undefined":e(v))&&"object"===e(v.audio)&&
(v=JSON.parse(JSON.stringify(v)),k(v.audio,"autoGainControl","mozAutoGainControl"),k(v.audio,"noiseSuppression","mozNoiseSuppression"));return f(v)};if(h&&h.prototype.getSettings){var l=h.prototype.getSettings;h.prototype.getSettings=function(){var v=l.apply(this,arguments);k(v,"mozAutoGainControl","autoGainControl");k(v,"mozNoiseSuppression","noiseSuppression");return v}}if(h&&h.prototype.applyConstraints){var t=h.prototype.applyConstraints;h.prototype.applyConstraints=function(v){"audio"===this.kind&&
"object"===("undefined"===typeof v?"undefined":e(v))&&(v=JSON.parse(JSON.stringify(v)),k(v,"autoGainControl","mozAutoGainControl"),k(v,"noiseSuppression","mozNoiseSuppression"));return t.apply(this,[v])}}}};var d=function(h){if(h&&h.__esModule)return h;var g={};if(null!=h)for(var q in h)Object.prototype.hasOwnProperty.call(h,q)&&(g[q]=h[q]);g.default=h;return g}(a("../utils"))},{"../utils":15}],14:[function(a,b,c){function e(g){return g&&void 0!==g.video?Object.assign({},g,{video:h.compactObject(g.video)}):
g}Object.defineProperty(c,"__esModule",{value:!0});var d="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(g){return typeof g}:function(g){return g&&"function"===typeof Symbol&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g};c.shimLocalStreamsAPI=function(g){if("object"===("undefined"===typeof g?"undefined":d(g))&&g.RTCPeerConnection){"getLocalStreams"in g.RTCPeerConnection.prototype||(g.RTCPeerConnection.prototype.getLocalStreams=function(){this._localStreams||
(this._localStreams=[]);return this._localStreams});if(!("addStream"in g.RTCPeerConnection.prototype)){var q=g.RTCPeerConnection.prototype.addTrack;g.RTCPeerConnection.prototype.addStream=function(k){var f=this;this._localStreams||(this._localStreams=[]);this._localStreams.includes(k)||this._localStreams.push(k);k.getAudioTracks().forEach(function(l){return q.call(f,l,k)});k.getVideoTracks().forEach(function(l){return q.call(f,l,k)})};g.RTCPeerConnection.prototype.addTrack=function(k){for(var f=this,
l=arguments.length,t=Array(1<l?l-1:0),v=1;v<l;v++)t[v-1]=arguments[v];t&&t.forEach(function(p){f._localStreams?f._localStreams.includes(p)||f._localStreams.push(p):f._localStreams=[p]});return q.apply(this,arguments)}}"removeStream"in g.RTCPeerConnection.prototype||(g.RTCPeerConnection.prototype.removeStream=function(k){var f=this;this._localStreams||(this._localStreams=[]);var l=this._localStreams.indexOf(k);if(-1!==l){this._localStreams.splice(l,1);var t=k.getTracks();this.getSenders().forEach(function(v){t.includes(v.track)&&
f.removeTrack(v)})}})}};c.shimRemoteStreamsAPI=function(g){if("object"===("undefined"===typeof g?"undefined":d(g))&&g.RTCPeerConnection&&("getRemoteStreams"in g.RTCPeerConnection.prototype||(g.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in g.RTCPeerConnection.prototype))){Object.defineProperty(g.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(k){var f=this;this._onaddstream&&
(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly));this.addEventListener("addstream",this._onaddstream=k);this.addEventListener("track",this._onaddstreampoly=function(l){l.streams.forEach(function(t){f._remoteStreams||(f._remoteStreams=[]);if(!f._remoteStreams.includes(t)){f._remoteStreams.push(t);var v=new Event("addstream");v.stream=t;f.dispatchEvent(v)}})})}});var q=g.RTCPeerConnection.prototype.setRemoteDescription;g.RTCPeerConnection.prototype.setRemoteDescription=
function(){var k=this;this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(f){f.streams.forEach(function(l){k._remoteStreams||(k._remoteStreams=[]);if(!(0<=k._remoteStreams.indexOf(l))){k._remoteStreams.push(l);var t=new Event("addstream");t.stream=l;k.dispatchEvent(t)}})});return q.apply(k,arguments)}}};c.shimCallbacksAPI=function(g){if("object"===("undefined"===typeof g?"undefined":d(g))&&g.RTCPeerConnection){g=g.RTCPeerConnection.prototype;var q=g.createOffer,k=g.createAnswer,
f=g.setLocalDescription,l=g.setRemoteDescription,t=g.addIceCandidate;g.createOffer=function(p,x){var u=q.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);if(!x)return u;u.then(p,x);return Promise.resolve()};g.createAnswer=function(p,x){var u=k.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);if(!x)return u;u.then(p,x);return Promise.resolve()};var v=function(p,x,u){p=f.apply(this,[p]);if(!u)return p;p.then(x,u);return Promise.resolve()};g.setLocalDescription=v;v=function(p,x,
u){p=l.apply(this,[p]);if(!u)return p;p.then(x,u);return Promise.resolve()};g.setRemoteDescription=v;v=function(p,x,u){p=t.apply(this,[p]);if(!u)return p;p.then(x,u);return Promise.resolve()};g.addIceCandidate=v}};c.shimGetUserMedia=function(g){var q=g&&g.navigator;if(q.mediaDevices&&q.mediaDevices.getUserMedia){g=q.mediaDevices;var k=g.getUserMedia.bind(g);q.mediaDevices.getUserMedia=function(f){return k(e(f))}}!q.getUserMedia&&q.mediaDevices&&q.mediaDevices.getUserMedia&&(q.getUserMedia=function(f,
l,t){q.mediaDevices.getUserMedia(f).then(l,t)}.bind(q))};c.shimConstraints=e;c.shimRTCIceServerUrls=function(g){var q=g.RTCPeerConnection;g.RTCPeerConnection=function(k,f){if(k&&k.iceServers){for(var l=[],t=0;t<k.iceServers.length;t++){var v=k.iceServers[t];!v.hasOwnProperty("urls")&&v.hasOwnProperty("url")?(h.deprecated("RTCIceServer.url","RTCIceServer.urls"),v=JSON.parse(JSON.stringify(v)),v.urls=v.url,delete v.url,l.push(v)):l.push(k.iceServers[t])}k.iceServers=l}return new q(k,f)};g.RTCPeerConnection.prototype=
q.prototype;"generateCertificate"in g.RTCPeerConnection&&Object.defineProperty(g.RTCPeerConnection,"generateCertificate",{get:function(){return q.generateCertificate}})};c.shimTrackEventTransceiver=function(g){"object"===("undefined"===typeof g?"undefined":d(g))&&g.RTCTrackEvent&&"receiver"in g.RTCTrackEvent.prototype&&!("transceiver"in g.RTCTrackEvent.prototype)&&Object.defineProperty(g.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})};c.shimCreateOfferLegacy=
function(g){var q=g.RTCPeerConnection.prototype.createOffer;g.RTCPeerConnection.prototype.createOffer=function(k){if(k){"undefined"!==typeof k.offerToReceiveAudio&&(k.offerToReceiveAudio=!!k.offerToReceiveAudio);var f=this.getTransceivers().find(function(l){return"audio"===l.receiver.track.kind});!1===k.offerToReceiveAudio&&f?"sendrecv"===f.direction?f.setDirection?f.setDirection("sendonly"):f.direction="sendonly":"recvonly"===f.direction&&(f.setDirection?f.setDirection("inactive"):f.direction="inactive"):
!0!==k.offerToReceiveAudio||f||this.addTransceiver("audio");"undefined"!==typeof k.offerToReceiveVideo&&(k.offerToReceiveVideo=!!k.offerToReceiveVideo);f=this.getTransceivers().find(function(l){return"video"===l.receiver.track.kind});!1===k.offerToReceiveVideo&&f?"sendrecv"===f.direction?f.setDirection?f.setDirection("sendonly"):f.direction="sendonly":"recvonly"===f.direction&&(f.setDirection?f.setDirection("inactive"):f.direction="inactive"):!0!==k.offerToReceiveVideo||f||this.addTransceiver("video")}return q.apply(this,
arguments)}};c.shimAudioContext=function(g){"object"!==("undefined"===typeof g?"undefined":d(g))||g.AudioContext||(g.AudioContext=g.webkitAudioContext)};var h=function(g){if(g&&g.__esModule)return g;var q={};if(null!=g)for(var k in g)Object.prototype.hasOwnProperty.call(g,k)&&(q[k]=g[k]);q.default=g;return q}(a("../utils"))},{"../utils":15}],15:[function(a,b,c){function e(f,l,t){return(f=f.match(l))&&f.length>=t&&parseInt(f[t],10)}function d(f){return"[object Object]"!==Object.prototype.toString.call(f)?
f:Object.keys(f).reduce(function(l,t){var v="[object Object]"===Object.prototype.toString.call(f[t]),p=v?d(f[t]):f[t];v=v&&!Object.keys(p).length;if(void 0===p||v)return l;v=Object;var x=v.assign,u={};t in u?Object.defineProperty(u,t,{value:p,enumerable:!0,configurable:!0,writable:!0}):u[t]=p;return x.call(v,l,u)},{})}function h(f,l,t){l&&!t.has(l.id)&&(t.set(l.id,l),Object.keys(l).forEach(function(v){v.endsWith("Id")?h(f,f.get(l[v]),t):v.endsWith("Ids")&&l[v].forEach(function(p){h(f,f.get(p),t)})}))}
Object.defineProperty(c,"__esModule",{value:!0});var g="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(f){return typeof f}:function(f){return f&&"function"===typeof Symbol&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f};c.extractVersion=e;c.wrapPeerConnectionEvent=function(f,l,t){if(f.RTCPeerConnection){f=f.RTCPeerConnection.prototype;var v=f.addEventListener;f.addEventListener=function(x,u){if(x!==l)return v.apply(this,arguments);var z=function(m){(m=t(m))&&
(u.handleEvent?u.handleEvent(m):u(m))};this._eventMap=this._eventMap||{};this._eventMap[l]||(this._eventMap[l]=new Map);this._eventMap[l].set(u,z);return v.apply(this,[x,z])};var p=f.removeEventListener;f.removeEventListener=function(x,u){if(x!==l||!this._eventMap||!this._eventMap[l]||!this._eventMap[l].has(u))return p.apply(this,arguments);var z=this._eventMap[l].get(u);this._eventMap[l].delete(u);0===this._eventMap[l].size&&delete this._eventMap[l];0===Object.keys(this._eventMap).length&&delete this._eventMap;
return p.apply(this,[x,z])};Object.defineProperty(f,"on"+l,{get:function(){return this["_on"+l]},set:function(x){this["_on"+l]&&(this.removeEventListener(l,this["_on"+l]),delete this["_on"+l]);x&&this.addEventListener(l,this["_on"+l]=x)},enumerable:!0,configurable:!0})}};c.disableLog=function(f){return"boolean"!==typeof f?Error("Argument type: "+("undefined"===typeof f?"undefined":g(f))+". Please use a boolean."):(q=f)?"adapter.js logging disabled":"adapter.js logging enabled"};c.disableWarnings=
function(f){if("boolean"!==typeof f)return Error("Argument type: "+("undefined"===typeof f?"undefined":g(f))+". Please use a boolean.");k=!f;return"adapter.js deprecation warnings "+(f?"disabled":"enabled")};c.log=function(){"object"!==("undefined"===typeof window?"undefined":g(window))||q||"undefined"!==typeof console&&"function"===typeof console.log&&console.log.apply(console,arguments)};c.deprecated=function(f,l){k&&console.warn(f+" is deprecated, please use "+l+" instead.")};c.detectBrowser=function(f){var l=
f.navigator,t={browser:null,version:null};if("undefined"===typeof f||!f.navigator)return t.browser="Not a browser.",t;l.mozGetUserMedia?(t.browser="firefox",t.version=e(l.userAgent,/Firefox\/(\d+)\./,1)):l.webkitGetUserMedia||!1===f.isSecureContext&&f.webkitRTCPeerConnection&&!f.RTCIceGatherer?(t.browser="chrome",t.version=e(l.userAgent,/Chrom(e|ium)\/(\d+)\./,2)):l.mediaDevices&&l.userAgent.match(/Edge\/(\d+).(\d+)$/)?(t.browser="edge",t.version=e(l.userAgent,/Edge\/(\d+).(\d+)$/,2)):f.RTCPeerConnection&&
l.userAgent.match(/AppleWebKit\/(\d+)\./)?(t.browser="safari",t.version=e(l.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=f.RTCRtpTransceiver&&"currentDirection"in f.RTCRtpTransceiver.prototype):t.browser="Not a supported browser.";return t};c.compactObject=d;c.walkStats=h;c.filterStats=function(f,l,t){var v=t?"outbound-rtp":"inbound-rtp",p=new Map;if(null===l)return p;var x=[];f.forEach(function(u){"track"===u.type&&u.trackIdentifier===l.id&&x.push(u)});x.forEach(function(u){f.forEach(function(z){z.type===
v&&z.trackId===u.id&&h(f,z,p)})});return p};var q=!0,k=!0},{}],16:[function(a,b,c){function e(l,t,v,p,x){t=f.writeRtpDescription(l.kind,t);t+=f.writeIceParameters(l.iceGatherer.getLocalParameters());t+=f.writeDtlsParameters(l.dtlsTransport.getLocalParameters(),"offer"===v?"actpass":x||"active");t+="a=mid:"+l.mid+"\r\n";t=l.rtpSender&&l.rtpReceiver?t+"a=sendrecv\r\n":l.rtpSender?t+"a=sendonly\r\n":l.rtpReceiver?t+"a=recvonly\r\n":t+"a=inactive\r\n";l.rtpSender&&(v=l.rtpSender._initialTrackId||l.rtpSender.track.id,
l.rtpSender._initialTrackId=v,p="msid:"+(p?p.id:"-")+" "+v+"\r\n",t=t+("a="+p)+("a=ssrc:"+l.sendEncodingParameters[0].ssrc+" "+p),l.sendEncodingParameters[0].rtx&&(t+="a=ssrc:"+l.sendEncodingParameters[0].rtx.ssrc+" "+p,t+="a=ssrc-group:FID "+l.sendEncodingParameters[0].ssrc+" "+l.sendEncodingParameters[0].rtx.ssrc+"\r\n"));t+="a=ssrc:"+l.sendEncodingParameters[0].ssrc+" cname:"+f.localCName+"\r\n";l.rtpSender&&l.sendEncodingParameters[0].rtx&&(t+="a=ssrc:"+l.sendEncodingParameters[0].rtx.ssrc+" cname:"+
f.localCName+"\r\n");return t}function d(l,t){var v=!1;l=JSON.parse(JSON.stringify(l));return l.filter(function(p){if(p&&(p.urls||p.url)){var x=p.urls||p.url;p.url&&!p.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var u="string"===typeof x;u&&(x=[x]);x=x.filter(function(z){return 0!==z.indexOf("turn:")||-1===z.indexOf("transport=udp")||-1!==z.indexOf("turn:[")||v?0===z.indexOf("stun:")&&14393<=t&&-1===z.indexOf("?transport=udp"):v=!0});delete p.url;p.urls=u?x[0]:x;return!!x.length}})}
function h(l,t){var v={codecs:[],headerExtensions:[],fecMechanisms:[]},p=function(u,z){u=parseInt(u,10);for(var m=0;m<z.length;m++)if(z[m].payloadType===u||z[m].preferredPayloadType===u)return z[m]},x=function(u,z,m,n){u=p(u.parameters.apt,m);z=p(z.parameters.apt,n);return u&&z&&u.name.toLowerCase()===z.name.toLowerCase()};l.codecs.forEach(function(u){for(var z=0;z<t.codecs.length;z++){var m=t.codecs[z];if(u.name.toLowerCase()===m.name.toLowerCase()&&u.clockRate===m.clockRate&&("rtx"!==u.name.toLowerCase()||
!u.parameters||!m.parameters.apt||x(u,m,l.codecs,t.codecs))){m=JSON.parse(JSON.stringify(m));m.numChannels=Math.min(u.numChannels,m.numChannels);v.codecs.push(m);m.rtcpFeedback=m.rtcpFeedback.filter(function(n){for(var w=0;w<u.rtcpFeedback.length;w++)if(u.rtcpFeedback[w].type===n.type&&u.rtcpFeedback[w].parameter===n.parameter)return!0;return!1});break}}});l.headerExtensions.forEach(function(u){for(var z=0;z<t.headerExtensions.length;z++){var m=t.headerExtensions[z];if(u.uri===m.uri){v.headerExtensions.push(m);
break}}});return v}function g(l,t,v){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][l].indexOf(v)}function q(l,t){var v=l.getRemoteCandidates().find(function(p){return t.foundation===p.foundation&&t.ip===p.ip&&t.port===p.port&&t.priority===p.priority&&t.protocol===p.protocol&&t.type===
p.type});v||l.addRemoteCandidate(t);return!v}function k(l,t){t=Error(t);t.name=l;t.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[l];return t}var f=a("sdp");b.exports=function(l,t){function v(m,n){n.addTrack(m);n.dispatchEvent(new l.MediaStreamTrackEvent("addtrack",{track:m}))}function p(m,n){n.removeTrack(m);n.dispatchEvent(new l.MediaStreamTrackEvent("removetrack",{track:m}))}function x(m,n,w,y){var A=new Event("track");A.track=n;A.receiver=
w;A.transceiver={receiver:w};A.streams=y;l.setTimeout(function(){m._dispatchEvent("track",A)})}var u=function(m){var n=this,w=document.createDocumentFragment();["addEventListener","removeEventListener","dispatchEvent"].forEach(function(A){n[A]=w[A].bind(w)});this.canTrickleIceCandidates=null;this.needNegotiation=!1;this.localStreams=[];this.remoteStreams=[];this._remoteDescription=this._localDescription=null;this.signalingState="stable";this.iceGatheringState=this.connectionState=this.iceConnectionState=
"new";m=JSON.parse(JSON.stringify(m||{}));this.usingBundle="max-bundle"===m.bundlePolicy;if("negotiate"===m.rtcpMuxPolicy)throw k("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");m.rtcpMuxPolicy||(m.rtcpMuxPolicy="require");switch(m.iceTransportPolicy){case "all":case "relay":break;default:m.iceTransportPolicy="all"}switch(m.bundlePolicy){case "balanced":case "max-compat":case "max-bundle":break;default:m.bundlePolicy="balanced"}m.iceServers=d(m.iceServers||[],t);this._iceGatherers=
[];if(m.iceCandidatePoolSize)for(var y=m.iceCandidatePoolSize;0<y;y--)this._iceGatherers.push(new l.RTCIceGatherer({iceServers:m.iceServers,gatherPolicy:m.iceTransportPolicy}));else m.iceCandidatePoolSize=0;this._config=m;this.transceivers=[];this._sdpSessionId=f.generateSessionId();this._sdpSessionVersion=0;this._dtlsRole=void 0;this._isClosed=!1};Object.defineProperty(u.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}});Object.defineProperty(u.prototype,
"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}});u.prototype.onicecandidate=null;u.prototype.onaddstream=null;u.prototype.ontrack=null;u.prototype.onremovestream=null;u.prototype.onsignalingstatechange=null;u.prototype.oniceconnectionstatechange=null;u.prototype.onconnectionstatechange=null;u.prototype.onicegatheringstatechange=null;u.prototype.onnegotiationneeded=null;u.prototype.ondatachannel=null;u.prototype._dispatchEvent=function(m,n){if(!this._isClosed&&
(this.dispatchEvent(n),"function"===typeof this["on"+m]))this["on"+m](n)};u.prototype._emitGatheringStateChange=function(){var m=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",m)};u.prototype.getConfiguration=function(){return this._config};u.prototype.getLocalStreams=function(){return this.localStreams};u.prototype.getRemoteStreams=function(){return this.remoteStreams};u.prototype._createTransceiver=function(m,n){var w=0<this.transceivers.length;m={track:null,
iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:m,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};this.usingBundle&&w?(m.iceTransport=this.transceivers[0].iceTransport,m.dtlsTransport=this.transceivers[0].dtlsTransport):(w=this._createIceAndDtlsTransports(),m.iceTransport=w.iceTransport,m.dtlsTransport=w.dtlsTransport);n||this.transceivers.push(m);
return m};u.prototype.addTrack=function(m,n){if(this._isClosed)throw k("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");if(this.transceivers.find(function(A){return A.track===m}))throw k("InvalidAccessError","Track already exists.");for(var w,y=0;y<this.transceivers.length;y++)this.transceivers[y].track||this.transceivers[y].kind!==m.kind||(w=this.transceivers[y]);w||=this._createTransceiver(m.kind);this._maybeFireNegotiationNeeded();-1===this.localStreams.indexOf(n)&&
this.localStreams.push(n);w.track=m;w.stream=n;w.rtpSender=new l.RTCRtpSender(m,w.dtlsTransport);return w.rtpSender};u.prototype.addStream=function(m){var n=this;if(15025<=t)m.getTracks().forEach(function(y){n.addTrack(y,m)});else{var w=m.clone();m.getTracks().forEach(function(y,A){var B=w.getTracks()[A];y.addEventListener("enabled",function(D){B.enabled=D.enabled})});w.getTracks().forEach(function(y){n.addTrack(y,w)})}};u.prototype.removeTrack=function(m){if(this._isClosed)throw k("InvalidStateError",
"Attempted to call removeTrack on a closed peerconnection.");if(!(m instanceof l.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find(function(y){return y.rtpSender===m});if(!n)throw k("InvalidAccessError","Sender was not created by this connection.");var w=n.stream;n.rtpSender.stop();n.rtpSender=null;n.track=null;n.stream=null;-1===this.transceivers.map(function(y){return y.stream}).indexOf(w)&&-1<
this.localStreams.indexOf(w)&&this.localStreams.splice(this.localStreams.indexOf(w),1);this._maybeFireNegotiationNeeded()};u.prototype.removeStream=function(m){var n=this;m.getTracks().forEach(function(w){var y=n.getSenders().find(function(A){return A.track===w});y&&n.removeTrack(y)})};u.prototype.getSenders=function(){return this.transceivers.filter(function(m){return!!m.rtpSender}).map(function(m){return m.rtpSender})};u.prototype.getReceivers=function(){return this.transceivers.filter(function(m){return!!m.rtpReceiver}).map(function(m){return m.rtpReceiver})};
u.prototype._createIceGatherer=function(m,n){var w=this;if(n&&0<m)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var y=new l.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});Object.defineProperty(y,"state",{value:"new",writable:!0});this.transceivers[m].bufferedCandidateEvents=[];this.transceivers[m].bufferCandidates=function(A){var B=!A.candidate||0===Object.keys(A.candidate).length;y.state=B?
"completed":"gathering";null!==w.transceivers[m].bufferedCandidateEvents&&w.transceivers[m].bufferedCandidateEvents.push(A)};y.addEventListener("localcandidate",this.transceivers[m].bufferCandidates);return y};u.prototype._gather=function(m,n){var w=this,y=this.transceivers[n].iceGatherer;if(!y.onlocalcandidate){var A=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null;y.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates);y.onlocalcandidate=
function(B){if(!(w.usingBundle&&0<n)){var D=new Event("icecandidate");D.candidate={sdpMid:m,sdpMLineIndex:n};var J=B.candidate;if(B=!J||0===Object.keys(J).length){if("new"===y.state||"gathering"===y.state)y.state="completed"}else"new"===y.state&&(y.state="gathering"),J.component=1,J.ufrag=y.getLocalParameters().usernameFragment,J=f.writeCandidate(J),D.candidate=Object.assign(D.candidate,f.parseCandidate(J)),D.candidate.candidate=J,D.candidate.toJSON=function(){return{candidate:D.candidate.candidate,
sdpMid:D.candidate.sdpMid,sdpMLineIndex:D.candidate.sdpMLineIndex,usernameFragment:D.candidate.usernameFragment}};J=f.getMediaSections(w._localDescription.sdp);J[D.candidate.sdpMLineIndex]=B?J[D.candidate.sdpMLineIndex]+"a=end-of-candidates\r\n":J[D.candidate.sdpMLineIndex]+("a="+D.candidate.candidate+"\r\n");w._localDescription.sdp=f.getDescription(w._localDescription.sdp)+J.join("");J=w.transceivers.every(function(R){return R.iceGatherer&&"completed"===R.iceGatherer.state});"gathering"!==w.iceGatheringState&&
(w.iceGatheringState="gathering",w._emitGatheringStateChange());B||w._dispatchEvent("icecandidate",D);J&&(w._dispatchEvent("icecandidate",new Event("icecandidate")),w.iceGatheringState="complete",w._emitGatheringStateChange())}};l.setTimeout(function(){A.forEach(function(B){y.onlocalcandidate(B)})},0)}};u.prototype._createIceAndDtlsTransports=function(){var m=this,n=new l.RTCIceTransport(null);n.onicestatechange=function(){m._updateIceConnectionState();m._updateConnectionState()};var w=new l.RTCDtlsTransport(n);
w.ondtlsstatechange=function(){m._updateConnectionState()};w.onerror=function(){Object.defineProperty(w,"state",{value:"failed",writable:!0});m._updateConnectionState()};return{iceTransport:n,dtlsTransport:w}};u.prototype._disposeIceAndDtlsTransports=function(m){var n=this.transceivers[m].iceGatherer;n&&(delete n.onlocalcandidate,delete this.transceivers[m].iceGatherer);if(n=this.transceivers[m].iceTransport)delete n.onicestatechange,delete this.transceivers[m].iceTransport;if(n=this.transceivers[m].dtlsTransport)delete n.ondtlsstatechange,
delete n.onerror,delete this.transceivers[m].dtlsTransport};u.prototype._transceive=function(m,n,w){var y=h(m.localCapabilities,m.remoteCapabilities);n&&m.rtpSender&&(y.encodings=m.sendEncodingParameters,y.rtcp={cname:f.localCName,compound:m.rtcpParameters.compound},m.recvEncodingParameters.length&&(y.rtcp.ssrc=m.recvEncodingParameters[0].ssrc),m.rtpSender.send(y));w&&m.rtpReceiver&&0<y.codecs.length&&("video"===m.kind&&m.recvEncodingParameters&&15019>t&&m.recvEncodingParameters.forEach(function(A){delete A.rtx}),
y.encodings=m.recvEncodingParameters.length?m.recvEncodingParameters:[{}],y.rtcp={compound:m.rtcpParameters.compound},m.rtcpParameters.cname&&(y.rtcp.cname=m.rtcpParameters.cname),m.sendEncodingParameters.length&&(y.rtcp.ssrc=m.sendEncodingParameters[0].ssrc),m.rtpReceiver.receive(y))};u.prototype.setLocalDescription=function(m){var n=this;if(-1===["offer","answer"].indexOf(m.type))return Promise.reject(k("TypeError",'Unsupported type "'+m.type+'"'));if(!g("setLocalDescription",m.type,n.signalingState)||
n._isClosed)return Promise.reject(k("InvalidStateError","Can not set local "+m.type+" in state "+n.signalingState));if("offer"===m.type){var w=f.splitSections(m.sdp);var y=w.shift();w.forEach(function(B,D){B=f.parseRtpParameters(B);n.transceivers[D].localCapabilities=B});n.transceivers.forEach(function(B,D){n._gather(B.mid,D)})}else if("answer"===m.type){w=f.splitSections(n._remoteDescription.sdp);y=w.shift();var A=0<f.matchPrefix(y,"a=ice-lite").length;w.forEach(function(B,D){var J=n.transceivers[D],
R=J.iceGatherer,H=J.iceTransport,G=J.dtlsTransport,M=J.localCapabilities,O=J.remoteCapabilities;if(!(f.isRejected(B)&&0===f.matchPrefix(B,"a=bundle-only").length||J.rejected)){var S=f.getIceParameters(B,y);B=f.getDtlsParameters(B,y);A&&(B.role="server");n.usingBundle&&0!==D||(n._gather(J.mid,D),"new"===H.state&&H.start(R,S,A?"controlling":"controlled"),"new"===G.state&&G.start(B));D=h(M,O);n._transceive(J,0<D.codecs.length,!1)}})}n._localDescription={type:m.type,sdp:m.sdp};"offer"===m.type?n._updateSignalingState("have-local-offer"):
n._updateSignalingState("stable");return Promise.resolve()};u.prototype.setRemoteDescription=function(m){var n=this;if(-1===["offer","answer"].indexOf(m.type))return Promise.reject(k("TypeError",'Unsupported type "'+m.type+'"'));if(!g("setRemoteDescription",m.type,n.signalingState)||n._isClosed)return Promise.reject(k("InvalidStateError","Can not set remote "+m.type+" in state "+n.signalingState));var w={};n.remoteStreams.forEach(function(H){w[H.id]=H});var y=[],A=f.splitSections(m.sdp),B=A.shift(),
D=0<f.matchPrefix(B,"a=ice-lite").length,J=0<f.matchPrefix(B,"a=group:BUNDLE ").length;n.usingBundle=J;var R=f.matchPrefix(B,"a=ice-options:")[0];n.canTrickleIceCandidates=R?0<=R.substr(14).split(" ").indexOf("trickle"):!1;A.forEach(function(H,G){var M=f.splitLines(H),O=f.getKind(H),S=f.isRejected(H)&&0===f.matchPrefix(H,"a=bundle-only").length,Y=M[0].substr(2).split(" ")[2];M=f.getDirection(H,B);var P=f.parseMsid(H),aa=f.getMid(H)||f.generateIdentifier();if(S||"application"===O&&("DTLS/SCTP"===Y||
"UDP/DTLS/SCTP"===Y))n.transceivers[G]={mid:aa,kind:O,protocol:Y,rejected:!0};else{!S&&n.transceivers[G]&&n.transceivers[G].rejected&&(n.transceivers[G]=n._createTransceiver(O,!0));var ma=f.parseRtpParameters(H);if(!S){var ba=f.getIceParameters(H,B);var na=f.getDtlsParameters(H,B);na.role="client"}Y=f.parseRtpEncodingParameters(H);var oa=f.parseRtcpParameters(H),pa=0<f.matchPrefix(H,"a=end-of-candidates",B).length,Z=f.matchPrefix(H,"a=candidate:").map(function(Q){return f.parseCandidate(Q)}).filter(function(Q){return 1===
Q.component});("offer"===m.type||"answer"===m.type)&&!S&&J&&0<G&&n.transceivers[G]&&(n._disposeIceAndDtlsTransports(G),n.transceivers[G].iceGatherer=n.transceivers[0].iceGatherer,n.transceivers[G].iceTransport=n.transceivers[0].iceTransport,n.transceivers[G].dtlsTransport=n.transceivers[0].dtlsTransport,n.transceivers[G].rtpSender&&n.transceivers[G].rtpSender.setTransport(n.transceivers[0].dtlsTransport),n.transceivers[G].rtpReceiver&&n.transceivers[G].rtpReceiver.setTransport(n.transceivers[0].dtlsTransport));
if("offer"!==m.type||S)"answer"!==m.type||S||(L=n.transceivers[G],X=L.iceGatherer,O=L.iceTransport,aa=L.dtlsTransport,V=L.rtpReceiver,S=L.sendEncodingParameters,H=L.localCapabilities,n.transceivers[G].recvEncodingParameters=Y,n.transceivers[G].remoteCapabilities=ma,n.transceivers[G].rtcpParameters=oa,Z.length&&"new"===O.state&&(!D&&!pa||J&&0!==G?Z.forEach(function(Q){q(L.iceTransport,Q)}):O.setRemoteCandidates(Z)),J&&0!==G||("new"===O.state&&O.start(X,ba,"controlling"),"new"===aa.state&&aa.start(na)),
!h(L.localCapabilities,L.remoteCapabilities).codecs.filter(function(Q){return"rtx"===Q.name.toLowerCase()}).length&&L.sendEncodingParameters[0].rtx&&delete L.sendEncodingParameters[0].rtx,n._transceive(L,"sendrecv"===M||"recvonly"===M,"sendrecv"===M||"sendonly"===M),!V||"sendrecv"!==M&&"sendonly"!==M?delete L.rtpReceiver:(M=V.track,P?(w[P.stream]||(w[P.stream]=new l.MediaStream),v(M,w[P.stream]),y.push([M,V,w[P.stream]])):(w.default||(w.default=new l.MediaStream),v(M,w.default),y.push([M,V,w.default]))));
else{var L=n.transceivers[G]||n._createTransceiver(O);L.mid=aa;L.iceGatherer||(L.iceGatherer=n._createIceGatherer(G,J));Z.length&&"new"===L.iceTransport.state&&(!pa||J&&0!==G?Z.forEach(function(Q){q(L.iceTransport,Q)}):L.iceTransport.setRemoteCandidates(Z));H=l.RTCRtpReceiver.getCapabilities(O);15019>t&&(H.codecs=H.codecs.filter(function(Q){return"rtx"!==Q.name}));S=L.sendEncodingParameters||[{ssrc:1001*(2*G+2)}];ba=!1;if("sendrecv"===M||"sendonly"===M){ba=!L.rtpReceiver;var V=L.rtpReceiver||new l.RTCRtpReceiver(L.dtlsTransport,
O);if(ba){M=V.track;if(!P||"-"!==P.stream)if(P){w[P.stream]||(w[P.stream]=new l.MediaStream,Object.defineProperty(w[P.stream],"id",{get:function(){return P.stream}}));Object.defineProperty(M,"id",{get:function(){return P.track}});var X=w[P.stream]}else w.default||(w.default=new l.MediaStream),X=w.default;X&&(v(M,X),L.associatedRemoteMediaStreams.push(X));y.push([M,V,X])}}else L.rtpReceiver&&L.rtpReceiver.track&&(L.associatedRemoteMediaStreams.forEach(function(Q){var qa=Q.getTracks().find(function(yb){return yb.id===
L.rtpReceiver.track.id});qa&&p(qa,Q)}),L.associatedRemoteMediaStreams=[]);L.localCapabilities=H;L.remoteCapabilities=ma;L.rtpReceiver=V;L.rtcpParameters=oa;L.sendEncodingParameters=S;L.recvEncodingParameters=Y;n._transceive(n.transceivers[G],!1,ba)}}});void 0===n._dtlsRole&&(n._dtlsRole="offer"===m.type?"active":"passive");n._remoteDescription={type:m.type,sdp:m.sdp};"offer"===m.type?n._updateSignalingState("have-remote-offer"):n._updateSignalingState("stable");Object.keys(w).forEach(function(H){var G=
w[H];if(G.getTracks().length){if(-1===n.remoteStreams.indexOf(G)){n.remoteStreams.push(G);var M=new Event("addstream");M.stream=G;l.setTimeout(function(){n._dispatchEvent("addstream",M)})}y.forEach(function(O){G.id===O[2].id&&x(n,O[0],O[1],[G])})}});y.forEach(function(H){H[2]||x(n,H[0],H[1],[])});l.setTimeout(function(){n&&n.transceivers&&n.transceivers.forEach(function(H){H.iceTransport&&"new"===H.iceTransport.state&&0<H.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),
H.iceTransport.addRemoteCandidate({}))})},4E3);return Promise.resolve()};u.prototype.close=function(){this.transceivers.forEach(function(m){m.iceTransport&&m.iceTransport.stop();m.dtlsTransport&&m.dtlsTransport.stop();m.rtpSender&&m.rtpSender.stop();m.rtpReceiver&&m.rtpReceiver.stop()});this._isClosed=!0;this._updateSignalingState("closed")};u.prototype._updateSignalingState=function(m){this.signalingState=m;m=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",m)};u.prototype._maybeFireNegotiationNeeded=
function(){var m=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,l.setTimeout(function(){if(m.needNegotiation){m.needNegotiation=!1;var n=new Event("negotiationneeded");m._dispatchEvent("negotiationneeded",n)}},0))};u.prototype._updateIceConnectionState=function(){var m={"new":0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(w){w.iceTransport&&!w.rejected&&m[w.iceTransport.state]++});var n="new";0<m.failed?
n="failed":0<m.checking?n="checking":0<m.disconnected?n="disconnected":0<m.new?n="new":0<m.connected?n="connected":0<m.completed&&(n="completed");n!==this.iceConnectionState&&(this.iceConnectionState=n,n=new Event("iceconnectionstatechange"),this._dispatchEvent("iceconnectionstatechange",n))};u.prototype._updateConnectionState=function(){var m={"new":0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(w){w.iceTransport&&w.dtlsTransport&&!w.rejected&&
(m[w.iceTransport.state]++,m[w.dtlsTransport.state]++)});m.connected+=m.completed;var n="new";0<m.failed?n="failed":0<m.connecting?n="connecting":0<m.disconnected?n="disconnected":0<m.new?n="new":0<m.connected&&(n="connected");n!==this.connectionState&&(this.connectionState=n,n=new Event("connectionstatechange"),this._dispatchEvent("connectionstatechange",n))};u.prototype.createOffer=function(m){var n=this;if(n._isClosed)return Promise.reject(k("InvalidStateError","Can not call createOffer after close"));
var w=n.transceivers.filter(function(B){return"audio"===B.kind}).length,y=n.transceivers.filter(function(B){return"video"===B.kind}).length;if(m){if(m.mandatory||m.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==m.offerToReceiveAudio&&(w=!0===m.offerToReceiveAudio?1:!1===m.offerToReceiveAudio?0:m.offerToReceiveAudio);void 0!==m.offerToReceiveVideo&&(y=!0===m.offerToReceiveVideo?1:!1===m.offerToReceiveVideo?0:m.offerToReceiveVideo)}for(n.transceivers.forEach(function(B){"audio"===
B.kind?(w--,0>w&&(B.wantReceive=!1)):"video"===B.kind&&(y--,0>y&&(B.wantReceive=!1))});0<w||0<y;)0<w&&(n._createTransceiver("audio"),w--),0<y&&(n._createTransceiver("video"),y--);var A=f.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach(function(B,D){var J=B.track,R=B.kind,H=B.mid||f.generateIdentifier();B.mid=H;B.iceGatherer||(B.iceGatherer=n._createIceGatherer(D,n.usingBundle));H=l.RTCRtpSender.getCapabilities(R);15019>t&&(H.codecs=H.codecs.filter(function(G){return"rtx"!==
G.name}));H.codecs.forEach(function(G){"H264"===G.name&&void 0===G.parameters["level-asymmetry-allowed"]&&(G.parameters["level-asymmetry-allowed"]="1");B.remoteCapabilities&&B.remoteCapabilities.codecs&&B.remoteCapabilities.codecs.forEach(function(M){G.name.toLowerCase()===M.name.toLowerCase()&&G.clockRate===M.clockRate&&(G.preferredPayloadType=M.payloadType)})});H.headerExtensions.forEach(function(G){(B.remoteCapabilities&&B.remoteCapabilities.headerExtensions||[]).forEach(function(M){G.uri===M.uri&&
(G.id=M.id)})});D=B.sendEncodingParameters||[{ssrc:1001*(2*D+1)}];J&&15019<=t&&"video"===R&&!D[0].rtx&&(D[0].rtx={ssrc:D[0].ssrc+1});B.wantReceive&&(B.rtpReceiver=new l.RTCRtpReceiver(B.dtlsTransport,R));B.localCapabilities=H;B.sendEncodingParameters=D});"max-compat"!==n._config.bundlePolicy&&(A+="a=group:BUNDLE "+n.transceivers.map(function(B){return B.mid}).join(" ")+"\r\n");A+="a=ice-options:trickle\r\n";n.transceivers.forEach(function(B,D){A+=e(B,B.localCapabilities,"offer",B.stream,n._dtlsRole);
A+="a=rtcp-rsize\r\n";!B.iceGatherer||"new"===n.iceGatheringState||0!==D&&n.usingBundle||(B.iceGatherer.getLocalCandidates().forEach(function(J){J.component=1;A+="a="+f.writeCandidate(J)+"\r\n"}),"completed"===B.iceGatherer.state&&(A+="a=end-of-candidates\r\n"))});m=new l.RTCSessionDescription({type:"offer",sdp:A});return Promise.resolve(m)};u.prototype.createAnswer=function(){var m=this;if(m._isClosed)return Promise.reject(k("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==
m.signalingState&&"have-local-pranswer"!==m.signalingState)return Promise.reject(k("InvalidStateError","Can not call createAnswer in signalingState "+m.signalingState));var n=f.writeSessionBoilerplate(m._sdpSessionId,m._sdpSessionVersion++);m.usingBundle&&(n+="a=group:BUNDLE "+m.transceivers.map(function(A){return A.mid}).join(" ")+"\r\n");n+="a=ice-options:trickle\r\n";var w=f.getMediaSections(m._remoteDescription.sdp).length;m.transceivers.forEach(function(A,B){if(!(B+1>w))if(A.rejected)"application"===
A.kind?n="DTLS/SCTP"===A.protocol?n+"m=application 0 DTLS/SCTP 5000\r\n":n+("m=application 0 "+A.protocol+" webrtc-datachannel\r\n"):"audio"===A.kind?n+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===A.kind&&(n+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),n+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+A.mid+"\r\n";else{if(A.stream){var D;"audio"===A.kind?D=A.stream.getAudioTracks()[0]:"video"===A.kind&&(D=A.stream.getVideoTracks()[0]);D&&15019<=t&&"video"===
A.kind&&!A.sendEncodingParameters[0].rtx&&(A.sendEncodingParameters[0].rtx={ssrc:A.sendEncodingParameters[0].ssrc+1})}B=h(A.localCapabilities,A.remoteCapabilities);!B.codecs.filter(function(J){return"rtx"===J.name.toLowerCase()}).length&&A.sendEncodingParameters[0].rtx&&delete A.sendEncodingParameters[0].rtx;n+=e(A,B,"answer",A.stream,m._dtlsRole);A.rtcpParameters&&A.rtcpParameters.reducedSize&&(n+="a=rtcp-rsize\r\n")}});var y=new l.RTCSessionDescription({type:"answer",sdp:n});return Promise.resolve(y)};
u.prototype.addIceCandidate=function(m){var n=this,w;return m&&void 0===m.sdpMLineIndex&&!m.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(y,A){if(n._remoteDescription)if(m&&""!==m.candidate){var B=m.sdpMLineIndex;if(m.sdpMid)for(var D=0;D<n.transceivers.length;D++)if(n.transceivers[D].mid===m.sdpMid){B=D;break}var J=n.transceivers[B];if(J){if(J.rejected)return y();D=0<Object.keys(m.candidate).length?f.parseCandidate(m.candidate):{};if("tcp"===D.protocol&&
(0===D.port||9===D.port)||D.component&&1!==D.component)return y();if((0===B||0<B&&J.iceTransport!==n.transceivers[0].iceTransport)&&!q(J.iceTransport,D))return A(k("OperationError","Can not add ICE candidate"));A=m.candidate.trim();0===A.indexOf("a=")&&(A=A.substr(2));w=f.getMediaSections(n._remoteDescription.sdp);w[B]+="a="+(D.type?A:"end-of-candidates")+"\r\n";n._remoteDescription.sdp=f.getDescription(n._remoteDescription.sdp)+w.join("")}else return A(k("OperationError","Can not add ICE candidate"))}else for(B=
0;B<n.transceivers.length&&(n.transceivers[B].rejected||(n.transceivers[B].iceTransport.addRemoteCandidate({}),w=f.getMediaSections(n._remoteDescription.sdp),w[B]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=f.getDescription(n._remoteDescription.sdp)+w.join(""),!n.usingBundle));B++);else return A(k("InvalidStateError","Can not add ICE candidate without a remote description"));y()})};u.prototype.getStats=function(m){if(m&&m instanceof l.MediaStreamTrack){var n=null;this.transceivers.forEach(function(y){y.rtpSender&&
y.rtpSender.track===m?n=y.rtpSender:y.rtpReceiver&&y.rtpReceiver.track===m&&(n=y.rtpReceiver)});if(!n)throw k("InvalidAccessError","Invalid selector.");return n.getStats()}var w=[];this.transceivers.forEach(function(y){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(A){y[A]&&w.push(y[A].getStats())})});return Promise.all(w).then(function(y){var A=new Map;y.forEach(function(B){B.forEach(function(D){A.set(D.id,D)})});return A})};["RTCRtpSender","RTCRtpReceiver",
"RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(m){if((m=l[m])&&m.prototype&&m.prototype.getStats){var n=m.prototype.getStats;m.prototype.getStats=function(){return n.apply(this).then(function(w){var y=new Map;Object.keys(w).forEach(function(A){var B=w[A];w[A].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[B.type]||B.type;y.set(A,w[A])});return y})}}});var z=["createOffer",
"createAnswer"];z.forEach(function(m){var n=u.prototype[m];u.prototype[m]=function(){var w=arguments;return"function"===typeof w[0]||"function"===typeof w[1]?n.apply(this,[arguments[2]]).then(function(y){"function"===typeof w[0]&&w[0].apply(null,[y])},function(y){"function"===typeof w[1]&&w[1].apply(null,[y])}):n.apply(this,arguments)}});z=["setLocalDescription","setRemoteDescription","addIceCandidate"];z.forEach(function(m){var n=u.prototype[m];u.prototype[m]=function(){var w=arguments;return"function"===
typeof w[1]||"function"===typeof w[2]?n.apply(this,arguments).then(function(){"function"===typeof w[1]&&w[1].apply(null)},function(y){"function"===typeof w[2]&&w[2].apply(null,[y])}):n.apply(this,arguments)}});["getStats"].forEach(function(m){var n=u.prototype[m];u.prototype[m]=function(){var w=arguments;return"function"===typeof w[1]?n.apply(this,arguments).then(function(){"function"===typeof w[1]&&w[1].apply(null)}):n.apply(this,arguments)}});return u}},{sdp:17}],17:[function(a,b,c){var e={generateIdentifier:function(){return Math.random().toString(36).substr(2,
10)}};e.localCName=e.generateIdentifier();e.splitLines=function(d){return d.trim().split("\n").map(function(h){return h.trim()})};e.splitSections=function(d){return d.split("\nm=").map(function(h,g){return(0<g?"m="+h:h).trim()+"\r\n"})};e.getDescription=function(d){return(d=e.splitSections(d))&&d[0]};e.getMediaSections=function(d){d=e.splitSections(d);d.shift();return d};e.matchPrefix=function(d,h){return e.splitLines(d).filter(function(g){return 0===g.indexOf(h)})};e.parseCandidate=function(d){d=
0===d.indexOf("a=candidate:")?d.substring(12).split(" "):d.substring(10).split(" ");for(var h={foundation:d[0],component:parseInt(d[1],10),protocol:d[2].toLowerCase(),priority:parseInt(d[3],10),ip:d[4],address:d[4],port:parseInt(d[5],10),type:d[7]},g=8;g<d.length;g+=2)switch(d[g]){case "raddr":h.relatedAddress=d[g+1];break;case "rport":h.relatedPort=parseInt(d[g+1],10);break;case "tcptype":h.tcpType=d[g+1];break;case "ufrag":h.ufrag=d[g+1];h.usernameFragment=d[g+1];break;default:h[d[g]]=d[g+1]}return h};
e.writeCandidate=function(d){var h=[];h.push(d.foundation);h.push(d.component);h.push(d.protocol.toUpperCase());h.push(d.priority);h.push(d.address||d.ip);h.push(d.port);var g=d.type;h.push("typ");h.push(g);"host"!==g&&d.relatedAddress&&d.relatedPort&&(h.push("raddr"),h.push(d.relatedAddress),h.push("rport"),h.push(d.relatedPort));d.tcpType&&"tcp"===d.protocol.toLowerCase()&&(h.push("tcptype"),h.push(d.tcpType));if(d.usernameFragment||d.ufrag)h.push("ufrag"),h.push(d.usernameFragment||d.ufrag);return"candidate:"+
h.join(" ")};e.parseIceOptions=function(d){return d.substr(14).split(" ")};e.parseRtpMap=function(d){d=d.substr(9).split(" ");var h={payloadType:parseInt(d.shift(),10)};d=d[0].split("/");h.name=d[0];h.clockRate=parseInt(d[1],10);h.channels=3===d.length?parseInt(d[2],10):1;h.numChannels=h.channels;return h};e.writeRtpMap=function(d){var h=d.payloadType;void 0!==d.preferredPayloadType&&(h=d.preferredPayloadType);var g=d.channels||d.numChannels||1;return"a=rtpmap:"+h+" "+d.name+"/"+d.clockRate+(1!==
g?"/"+g:"")+"\r\n"};e.parseExtmap=function(d){d=d.substr(9).split(" ");return{id:parseInt(d[0],10),direction:0<d[0].indexOf("/")?d[0].split("/")[1]:"sendrecv",uri:d[1]}};e.writeExtmap=function(d){return"a=extmap:"+(d.id||d.preferredId)+(d.direction&&"sendrecv"!==d.direction?"/"+d.direction:"")+" "+d.uri+"\r\n"};e.parseFmtp=function(d){for(var h={},g=d.substr(d.indexOf(" ")+1).split(";"),q=0;q<g.length;q++)d=g[q].trim().split("="),h[d[0].trim()]=d[1];return h};e.writeFmtp=function(d){var h="",g=d.payloadType;
void 0!==d.preferredPayloadType&&(g=d.preferredPayloadType);if(d.parameters&&Object.keys(d.parameters).length){var q=[];Object.keys(d.parameters).forEach(function(k){d.parameters[k]?q.push(k+"="+d.parameters[k]):q.push(k)});h+="a=fmtp:"+g+" "+q.join(";")+"\r\n"}return h};e.parseRtcpFb=function(d){d=d.substr(d.indexOf(" ")+1).split(" ");return{type:d.shift(),parameter:d.join(" ")}};e.writeRtcpFb=function(d){var h="",g=d.payloadType;void 0!==d.preferredPayloadType&&(g=d.preferredPayloadType);d.rtcpFeedback&&
d.rtcpFeedback.length&&d.rtcpFeedback.forEach(function(q){h+="a=rtcp-fb:"+g+" "+q.type+(q.parameter&&q.parameter.length?" "+q.parameter:"")+"\r\n"});return h};e.parseSsrcMedia=function(d){var h=d.indexOf(" "),g={ssrc:parseInt(d.substr(7,h-7),10)},q=d.indexOf(":",h);-1<q?(g.attribute=d.substr(h+1,q-h-1),g.value=d.substr(q+1)):g.attribute=d.substr(h+1);return g};e.parseSsrcGroup=function(d){d=d.substr(13).split(" ");return{semantics:d.shift(),ssrcs:d.map(function(h){return parseInt(h,10)})}};e.getMid=
function(d){if(d=e.matchPrefix(d,"a=mid:")[0])return d.substr(6)};e.parseFingerprint=function(d){d=d.substr(14).split(" ");return{algorithm:d[0].toLowerCase(),value:d[1]}};e.getDtlsParameters=function(d,h){return{role:"auto",fingerprints:e.matchPrefix(d+h,"a=fingerprint:").map(e.parseFingerprint)}};e.writeDtlsParameters=function(d,h){var g="a=setup:"+h+"\r\n";d.fingerprints.forEach(function(q){g+="a=fingerprint:"+q.algorithm+" "+q.value+"\r\n"});return g};e.parseCryptoLine=function(d){d=d.substr(9).split(" ");
return{tag:parseInt(d[0],10),cryptoSuite:d[1],keyParams:d[2],sessionParams:d.slice(3)}};e.writeCryptoLine=function(d){return"a=crypto:"+d.tag+" "+d.cryptoSuite+" "+("object"===typeof d.keyParams?e.writeCryptoKeyParams(d.keyParams):d.keyParams)+(d.sessionParams?" "+d.sessionParams.join(" "):"")+"\r\n"};e.parseCryptoKeyParams=function(d){if(0!==d.indexOf("inline:"))return null;d=d.substr(7).split("|");return{keyMethod:"inline",keySalt:d[0],lifeTime:d[1],mkiValue:d[2]?d[2].split(":")[0]:void 0,mkiLength:d[2]?
d[2].split(":")[1]:void 0}};e.writeCryptoKeyParams=function(d){return d.keyMethod+":"+d.keySalt+(d.lifeTime?"|"+d.lifeTime:"")+(d.mkiValue&&d.mkiLength?"|"+d.mkiValue+":"+d.mkiLength:"")};e.getCryptoParameters=function(d,h){return e.matchPrefix(d+h,"a=crypto:").map(e.parseCryptoLine)};e.getIceParameters=function(d,h){var g=e.matchPrefix(d+h,"a=ice-ufrag:")[0];d=e.matchPrefix(d+h,"a=ice-pwd:")[0];return g&&d?{usernameFragment:g.substr(12),password:d.substr(10)}:null};e.writeIceParameters=function(d){return"a=ice-ufrag:"+
d.usernameFragment+"\r\na=ice-pwd:"+d.password+"\r\n"};e.parseRtpParameters=function(d){for(var h={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},g=e.splitLines(d)[0].split(" "),q=3;q<g.length;q++){var k=g[q],f=e.matchPrefix(d,"a=rtpmap:"+k+" ")[0];if(f){f=e.parseRtpMap(f);var l=e.matchPrefix(d,"a=fmtp:"+k+" ");f.parameters=l.length?e.parseFmtp(l[0]):{};f.rtcpFeedback=e.matchPrefix(d,"a=rtcp-fb:"+k+" ").map(e.parseRtcpFb);h.codecs.push(f);switch(f.name.toUpperCase()){case "RED":case "ULPFEC":h.fecMechanisms.push(f.name.toUpperCase())}}}e.matchPrefix(d,
"a=extmap:").forEach(function(t){h.headerExtensions.push(e.parseExtmap(t))});return h};e.writeRtpDescription=function(d,h){var g="";g+="m="+d+" ";g+=0<h.codecs.length?"9":"0";g+=" UDP/TLS/RTP/SAVPF ";g+=h.codecs.map(function(k){return void 0!==k.preferredPayloadType?k.preferredPayloadType:k.payloadType}).join(" ")+"\r\n";g+="c=IN IP4 0.0.0.0\r\n";g+="a=rtcp:9 IN IP4 0.0.0.0\r\n";h.codecs.forEach(function(k){g+=e.writeRtpMap(k);g+=e.writeFmtp(k);g+=e.writeRtcpFb(k)});var q=0;h.codecs.forEach(function(k){k.maxptime>
q&&(q=k.maxptime)});0<q&&(g+="a=maxptime:"+q+"\r\n");g+="a=rtcp-mux\r\n";h.headerExtensions&&h.headerExtensions.forEach(function(k){g+=e.writeExtmap(k)});return g};e.parseRtpEncodingParameters=function(d){var h=[],g=e.parseRtpParameters(d),q=-1!==g.fecMechanisms.indexOf("RED"),k=-1!==g.fecMechanisms.indexOf("ULPFEC"),f=e.matchPrefix(d,"a=ssrc:").map(function(p){return e.parseSsrcMedia(p)}).filter(function(p){return"cname"===p.attribute}),l=0<f.length&&f[0].ssrc,t;f=e.matchPrefix(d,"a=ssrc-group:FID").map(function(p){return p.substr(17).split(" ").map(function(x){return parseInt(x,
10)})});0<f.length&&1<f[0].length&&f[0][0]===l&&(t=f[0][1]);g.codecs.forEach(function(p){"RTX"===p.name.toUpperCase()&&p.parameters.apt&&(p={ssrc:l,codecPayloadType:parseInt(p.parameters.apt,10)},l&&t&&(p.rtx={ssrc:t}),h.push(p),q&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:l,mechanism:k?"red+ulpfec":"red"},h.push(p)))});0===h.length&&l&&h.push({ssrc:l});var v=e.matchPrefix(d,"b=");v.length&&(v=0===v[0].indexOf("b=TIAS:")?parseInt(v[0].substr(7),10):0===v[0].indexOf("b=AS:")?950*parseInt(v[0].substr(5),
10)-16E3:void 0,h.forEach(function(p){p.maxBitrate=v}));return h};e.parseRtcpParameters=function(d){var h={},g=e.matchPrefix(d,"a=ssrc:").map(function(q){return e.parseSsrcMedia(q)}).filter(function(q){return"cname"===q.attribute})[0];g&&(h.cname=g.value,h.ssrc=g.ssrc);g=e.matchPrefix(d,"a=rtcp-rsize");h.reducedSize=0<g.length;h.compound=0===g.length;d=e.matchPrefix(d,"a=rtcp-mux");h.mux=0<d.length;return h};e.parseMsid=function(d){var h=e.matchPrefix(d,"a=msid:");if(1===h.length)return d=h[0].substr(7).split(" "),
{stream:d[0],track:d[1]};d=e.matchPrefix(d,"a=ssrc:").map(function(g){return e.parseSsrcMedia(g)}).filter(function(g){return"msid"===g.attribute});if(0<d.length)return d=d[0].value.split(" "),{stream:d[0],track:d[1]}};e.parseSctpDescription=function(d){var h=e.parseMLine(d),g=e.matchPrefix(d,"a=max-message-size:"),q;0<g.length&&(q=parseInt(g[0].substr(19),10));isNaN(q)&&(q=65536);g=e.matchPrefix(d,"a=sctp-port:");if(0<g.length)return{port:parseInt(g[0].substr(12),10),protocol:h.fmt,maxMessageSize:q};
if(0<e.matchPrefix(d,"a=sctpmap:").length)return d=e.matchPrefix(d,"a=sctpmap:")[0].substr(10).split(" "),{port:parseInt(d[0],10),protocol:d[1],maxMessageSize:q}};e.writeSctpDescription=function(d,h){d="DTLS/SCTP"!==d.protocol?["m="+d.kind+" 9 "+d.protocol+" "+h.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+h.port+"\r\n"]:["m="+d.kind+" 9 "+d.protocol+" "+h.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+h.port+" "+h.protocol+" 65535\r\n"];void 0!==h.maxMessageSize&&d.push("a=max-message-size:"+
h.maxMessageSize+"\r\n");return d.join("")};e.generateSessionId=function(){return Math.random().toString().substr(2,21)};e.writeSessionBoilerplate=function(d,h,g){h=void 0!==h?h:2;d=d?d:e.generateSessionId();return"v=0\r\no="+(g||"thisisadapterortc")+" "+d+" "+h+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"};e.writeMediaSection=function(d,h,g,q){h=e.writeRtpDescription(d.kind,h);h+=e.writeIceParameters(d.iceGatherer.getLocalParameters());h+=e.writeDtlsParameters(d.dtlsTransport.getLocalParameters(),"offer"===
g?"actpass":"active");h+="a=mid:"+d.mid+"\r\n";h=d.direction?h+("a="+d.direction+"\r\n"):d.rtpSender&&d.rtpReceiver?h+"a=sendrecv\r\n":d.rtpSender?h+"a=sendonly\r\n":d.rtpReceiver?h+"a=recvonly\r\n":h+"a=inactive\r\n";d.rtpSender&&(g="msid:"+q.id+" "+d.rtpSender.track.id+"\r\n",h=h+("a="+g)+("a=ssrc:"+d.sendEncodingParameters[0].ssrc+" "+g),d.sendEncodingParameters[0].rtx&&(h+="a=ssrc:"+d.sendEncodingParameters[0].rtx.ssrc+" "+g,h+="a=ssrc-group:FID "+d.sendEncodingParameters[0].ssrc+" "+d.sendEncodingParameters[0].rtx.ssrc+
"\r\n"));h+="a=ssrc:"+d.sendEncodingParameters[0].ssrc+" cname:"+e.localCName+"\r\n";d.rtpSender&&d.sendEncodingParameters[0].rtx&&(h+="a=ssrc:"+d.sendEncodingParameters[0].rtx.ssrc+" cname:"+e.localCName+"\r\n");return h};e.getDirection=function(d,h){d=e.splitLines(d);for(var g=0;g<d.length;g++)switch(d[g]){case "a=sendrecv":case "a=sendonly":case "a=recvonly":case "a=inactive":return d[g].substr(2)}return h?e.getDirection(h):"sendrecv"};e.getKind=function(d){return e.splitLines(d)[0].split(" ")[0].substr(2)};
e.isRejected=function(d){return"0"===d.split(" ",2)[1]};e.parseMLine=function(d){d=e.splitLines(d)[0].substr(2).split(" ");return{kind:d[0],port:parseInt(d[1],10),protocol:d[2],fmt:d.slice(3).join(" ")}};e.parseOLine=function(d){d=e.matchPrefix(d,"o=")[0].substr(2).split(" ");return{username:d[0],sessionId:d[1],sessionVersion:parseInt(d[2],10),netType:d[3],addressType:d[4],address:d[5]}};e.isValidSDP=function(d){if("string"!==typeof d||0===d.length)return!1;d=e.splitLines(d);for(var h=0;h<d.length;h++)if(2>
d[h].length||"="!==d[h].charAt(1))return!1;return!0};"object"===typeof b&&(b.exports=e)},{}]},{},[1])(1)});class ia{constructor(a){this.parent=a;this.uid=a.uid}getElem(a){return document.getElementById(a+"_"+this.uid)}setElemValue(a,b){(a=this.getElem(a))&&(a.value=b)}setElemText(a,b){(a=this.getElem(a))&&(a.innerText=b)}getElemValue(a){if(a=this.getElem(a))return a.value}createCSS(a){let b=document.createElement("style");try{b.appendChild(document.createTextNode(a))}catch(c){b.styleSheet.cssText=
a}document.getElementsByTagName("head")[0].appendChild(b)}}class zb extends ia{constructor(a){super(a)}create(){this.createCSS(`#startupInfoPanel_${this.uid} { position: absolute; left: 0px; top: 0px; width: 350px; background-color: transparent !important; text-shadow: black 0.1em 0.1em 0.2em; color: white; font-family: Verdana; font-size: 12px !important; overflow: auto; }`);this.htmlElem=document.createElement("pre");this.htmlElem.id=`startupInfoPanel_${this.uid}`;this.htmlElem.oncontextmenu=new Function("return false");
this.htmlElem.onselectstart=new Function("return false");document.body.appendChild(this.htmlElem);this.parent.resize()}destroy(){this.htmlElem&&(document.body.removeChild(this.htmlElem),this.htmlElem=null)}setVisible(a){a&&this.htmlElem&&(this.htmlElem.innerText="");this.visible!=a&&this.htmlElem&&(this.visible=a,this.htmlElem.style.display=a?"block":"none",this.parent.bNeedReposUI=!0,this.parent.resize())}log(a){if(this.htmlElem){let b=this.htmlElem.innerText;b+=a+"\n";this.htmlElem.innerText=b;
this.htmlElem.scrollTop=this.htmlElem.scrollHeight+100}this.parent.aircityApi&&this.parent.aircityApi.log(a)}setPosition(a){this.htmlElem&&(this.htmlElem.style.left=`${a.left}px`,this.htmlElem.style.top=`${a.top}px`,this.htmlElem.style.height=`${a.height-20}px`)}}class Ab extends ia{constructor(a){super(a)}canDisplaySettings(){let a=this.parent.options;return void 0==a.showMarker?!0:"boolean"==typeof a.showMarker&&1==a.showMarker||"object"==typeof a.showMarker&&a.showMarker.showSettings}canDisplayLatency(){if(!this.parent.isChrome)return!1;
let a=this.parent.options;return void 0==a.showMarker?!0:"boolean"==typeof a.showMarker&&1==a.showMarker||"object"==typeof a.showMarker&&a.showMarker.showLatency}formatNumber(a,b){return(new Intl.NumberFormat(window.navigator.language,{maximumFractionDigits:b||0})).format(a)}createButton(){this.htmlElemButton||(this.createCSS(`#playerInfoPanel_${this.uid} {position: absolute; left: 100px; top: 100px; width: 200px; height: 266px; background-color: rgba(50,50,50, 0.75); color: #00FF00; padding-top: 10px; padding-left: 10px; font-family: Verdana; font-size: 10px; box-shadow: 0px 0px 10px 5px rgba(255,255,255,0.9); -moz-border-radius:8px; -webkit-border-radius:8px; }`+
`#playerInfoPanel_${this.uid} a:link { color: rgb(0,255,128); text-decoration: none; }`+`#playerInfoPanel_${this.uid} a:hover { color: yellow; background:transparent; }`+`#playerInfoPanel_${this.uid} input {background:transparent; border:1px solid gray; color: #00FF00;}`+`#playerInfoPanel_${this.uid} select {background:transparent; border:1px solid gray; color: #00FF00;}`+`#playerInfoPanel_${this.uid} option {background:black; color: #00FF00;}`+`#playerInfoPanelMarker_${this.uid} {position: absolute; color: white; text-shadow: black 0.1em 0.1em 0.2em; font-family: \u5b8b\u4f53; font-size: 10px; text-decoration: none;}`+
`#playerInfoPanelMarker_${this.uid}:hover{color:rgb(0,255,0);}`+`#startupInfoPanel_${this.uid} { position: absolute; background-color: transparent; text-shadow: black 0.1em 0.1em 0.2em; color: white; font-family: Verdana; font-size: 14px; }`),this.htmlElemButton=document.createElement("span"),this.htmlElemButton.id=`playerInfoPanelMarker_${this.uid}`,this.htmlElemButton.style.cursor="pointer",this.htmlElemButton.oncontextmenu=new Function("return false"),this.htmlElemButton.onselectstart=new Function("return false"),
this.htmlElemButton.onclick=()=>this.setPanelVisible(),this.htmlElemButton.innerText="\uff0b\u663e\u793a\u4fe1\u606f",this.htmlElemButton.title=this.parent.nodeInfoArray.join("\n"),document.body.appendChild(this.htmlElemButton),this.parent.bNeedReposUI=!0)}createPanel(){if(!this.htmlElemPanel){var a='<table border="0">'+`<tr><td align="right" width="78">\u8fde\u63a5\u4e2a\u6570\uff1a</td><td id="i_connections_${this.uid}">1</td></tr>`+`<tr><td align="right">\u8fd0\u884c\u65f6\u957f\uff1a</td><td id="i_duration_${this.uid}">00:00:00</td></tr>`+
`<tr><td align="right">\u5206\u8fa8\u7387\uff1a</td><td id="i_resolution_${this.uid}">1920 x 1080</td></tr>`+`<tr><td align="right">\u63a5\u6536\u6570\u636e\uff1a</td><td id="i_received_${this.uid}">0 kB</td></tr>`+`<tr><td align="right">\u89e3\u538b\u5e27\u6570\uff1a</td><td id="i_frameDecoded_${this.uid}">0</td></tr>`+`<tr><td align="right">\u4e22\u5305\u4e22\u5e27\uff1a</td><td><span id="i_packetsLost_${this.uid}"></span> / <span id="i_frameDropped_${this.uid}"></span></td></tr>`+`<tr><td align="right">\u89c6\u9891\u89e3\u7801\uff1a</td><td id="i_compositeTime_${this.uid}">0 ms</td></tr>`+
`<tr><td align="right">QP\uff1a</td><td id="i_qp_${this.uid}">0</td></tr>`+`<tr><td align="right">\u5e27\u7387\uff1a</td><td id="i_framerate_${this.uid}">-</td></tr>`+`<tr><td align="right">\u7801\u7387\uff1a</td><td id="i_bitrate_${this.uid}">-</td></tr>`+`<tr><td align="right">API\u961f\u5217\uff1a</td><td id="i_apiQueue_${this.uid}" title="\u547d\u4ee4\u961f\u5217 / \u54cd\u5e94\u961f\u5217">0 / 0</td></tr>`+`<tr><td align="right">\u952e\u76d8\u4ea4\u4e92\uff1a</td><td><select id="i_settings_keyEventReceiver_${this.uid}"><option value="document" selected>document</option><option value="video">video</option><option value="none">none</option></select></td></tr>`+
"<tr><td>&nbsp;</td><td></td></tr>";a+=this.canDisplaySettings()?`<tr><td align="right">\u7801\u7387\u63a7\u5236\uff1a</td><td><select id="i_settings_rateControl_${this.uid}"><option value="CBR" selected>CBR</option><option value="VBR">VBR</option></select></td></tr>`+`<tr><td align="right">QP\uff1a</td><td><input type="number" id="i_settings_minQP_${this.uid}" value="" min="10" max="45" title="\u53d6\u503c\u8303\u56f4\uff1a10-45\u3002\u8f83\u4f4e\u7684\u503c\u5bfc\u81f4\u66f4\u597d\u7684\u8d28\u91cf\u4f46\u66f4\u9ad8\u7684\u6bd4\u7279\u7387\u3002\u5982\u679c\u4e0d\u8f93\u5165\uff0c\u5c06\u7981\u7528\u5bf9\u6700\u5c0fQP\u7684\u4efb\u4f55\u786c\u9650\u5236\u3002" style="width:42px" />-<input type="number" id="i_settings_maxQP_${this.uid}" value="" min="10" max="45" title="\u53d6\u503c\u8303\u56f4\uff1a10-45\u3002\u8f83\u4f4e\u7684\u503c\u5bfc\u81f4\u66f4\u597d\u7684\u8d28\u91cf\u4f46\u66f4\u9ad8\u7684\u6bd4\u7279\u7387\u3002\u5982\u679c\u4e0d\u8f93\u5165\uff0c\u5c06\u7981\u7528\u5bf9\u6700\u5927QP\u7684\u4efb\u4f55\u786c\u9650\u5236" style="width:42px"  /></td></tr>`+
`<tr><td align="right">\u6700\u5927\u7801\u7387\uff1a</td><td><input type="number" id="i_maxBitrate_${this.uid}" value="20" min="10" max="45" title="\u6700\u5c0f\u503c1\uff0c\u6700\u5927\u503c50\uff0c\u4fee\u6539\u6700\u5927\u7801\u7387\u9700\u8981\u5237\u65b0\u9875\u9762\u624d\u4f1a\u751f\u6548" style="width:42px" /> Mbps</td></tr>`+`<tr><td align="right"><span id="i_settings_applyOK_${this.uid}" style="display:none;color:yellow;">\u8bbe\u7f6e\u6210\u529f\uff01</span></td><td><a href='javascript:' id="i_settings_apply_${this.uid}">\u5e94\u7528\u8bbe\u7f6e</a></td></tr>`:
"";a+=this.canDisplayLatency()?"<tr><td>&nbsp;</td><td></td></tr>"+`<tr><td align="right">\u5ef6\u8fdf\u6d4b\u8bd5\uff1a</td><td><a href='javascript:' id="i_test_startLatency_${this.uid}">START\uff01</td></tr>`+`<tr id="tr_placeholder_latencyTest_${this.uid}"></tr> `:"";a+="</table>";this.htmlElemPanel=document.createElement("div");this.htmlElemPanel.innerHTML=a;this.htmlElemPanel.id=`playerInfoPanel_${this.uid}`;this.htmlElemPanel.oncontextmenu=new Function("return false");this.htmlElemPanel.onselectstart=
new Function("return false");document.body.appendChild(this.htmlElemPanel);this.canDisplaySettings()&&(a=this.htmlElemPanel.getBoundingClientRect(),this.htmlElemPanel.style.height=a.height+100+"px",this.getElem("i_settings_apply").onclick=()=>{this.getElem("i_settings_applyOK").style.display="block";setTimeout(()=>this.getElem("i_settings_applyOK").style.display="none",300);let b=this.getElemValue("i_settings_rateControl"),c=this.getElemValue("i_settings_minQP"),e=this.getElemValue("i_settings_maxQP"),
d=1E6*this.getElemValue("i_maxBitrate");""==c.trim()?c=-1:(0>c&&(c=-1),0<=c&&10>c&&(c=10),45<c&&(c=45));""==e.trim()?e=-1:(0>e&&(e=-1),0<=e&&10>e&&(e=10),45<e&&(e=45));-1!=c&&-1!=e&&c>e&&(e=c*(c=e,1));this.setElemValue("i_settings_minQP",-1==c?"":c);this.setElemValue("i_settings_maxQP",-1==e?"":e);this.parent.rtc_send_descriptor(MessageType.UIInteraction,{Console:"PixelStreaming.Encoder.RateControl "+b});this.parent.rtc_send_descriptor(MessageType.UIInteraction,{Console:"PixelStreaming.Encoder.MinQP "+
c});this.parent.rtc_send_descriptor(MessageType.UIInteraction,{Console:"PixelStreaming.Encoder.MaxQP "+e});this.parent.rtc_send_descriptor(MessageType.UIInteraction,{Console:"PixelStreaming.WebRTC.MaxBitrate "+d})},a=this.getElem("i_settings_keyEventReceiver"),a.value=this.parent.keyEventReceiverStr,a.onchange=b=>{this.parent.setKeyEventReceiver(b.target.value);this.parent.video.focus()});this.canDisplayLatency()&&(a=this.htmlElemPanel.getBoundingClientRect(),this.htmlElemPanel.style.height=a.height+
15+"px",this.getElem("i_test_startLatency").onclick=()=>{if(!this.updateLatencyTestUI){let b=this.htmlElemPanel.getBoundingClientRect();this.updateLatencyTestUI=!0;this.htmlElemPanel.style.top=b.top-120+"px";this.htmlElemPanel.style.height=b.height+90+"px";this.getElem("tr_placeholder_latencyTest").outerHTML=`<tr><td align="right">\u540e\u53f0\uff1a</td><td><span id="i_test_totalUE_${this.uid}"></span> \uff08\u7f16\u7801\uff1a<span id="i_test_encode_${this.uid}"></span>\uff09</td></tr>`+`<tr><td align="right">\u4f20\u8f93\uff1a</td><td id="i_test_netLatency_${this.uid}"></td></tr>`+
`<tr><td align="right">\u89e3\u7801\uff1a</td><td id="i_test_browserReceve_${this.uid}"></td></tr>`+`<tr><td align="right">\u603b\u5ef6\u8fdf\uff1a</td><td id="i_test_total_${this.uid}"></td></tr>`}this.parent.rtc_startLatencyTest()})}}destroy(){this.htmlElemPanel&&(document.body.removeChild(this.htmlElemPanel),this.htmlElemPanel=null);this.htmlElemButton&&(document.body.removeChild(this.htmlElemButton),this.htmlElemButton=null)}setPanelVisible(){this.htmlElemPanel?"none"==this.htmlElemPanel.style.display?
(this.updateConnections(),this.htmlElemPanel.style.display="block",this.visible=!0,this.parent.resize(),this.htmlElemButton.innerText="\uff0d\u9690\u85cf\u4fe1\u606f"):(this.visible=!1,this.htmlElemPanel.style.display="none",this.htmlElemButton.innerText="\uff0b\u663e\u793a\u4fe1\u606f"):(this.createPanel(),this.visible=!0,this.parent.resize(),this.htmlElemButton.innerText="\uff0d\u9690\u85cf\u4fe1\u606f",this.updateConnections(),this.requestInitialSettings());this.parent.bNeedReposUI=!0;this.parent.resize()}requestInitialSettings(){this.canDisplaySettings()&&
this.parent.rtc_send_requestInitialSettings()}updateButtonTip(a){this.htmlElemButton&&(this.htmlElemButton.title=a)}updateConnections(a){void 0!=a&&(this.playersCount=a);this.setElemText("i_connections",this.playersCount);this.parent.canAdaptiveResolution=1==this.playersCount;this.parent.canAdaptiveResolution&&this.parent.resize()}updateStats(a){var b=(a.timestamp-a.timestampStart)/1E3,c=new Intl.NumberFormat(window.navigator.language,{maximumFractionDigits:0,minimumIntegerDigits:2}),e=[],d=[60,60];
for(let h=0;h<d.length;h++)e.push(b%d[h]),b/=d[h];e.push(b);b=c.format(e[0]);d=c.format(Math.floor(e[1]));c=c.format(Math.floor([e[2]]));this.setElemText("i_duration",c+":"+d+":"+b);this.setElemText("i_resolution",a.hasOwnProperty("frameWidth")&&a.hasOwnProperty("frameHeight")?a.frameWidth+" x "+a.frameHeight:"-");c="B";e=a.hasOwnProperty("bytesReceived")?a.bytesReceived:0;b=["kB","MB","GB"];for(d=0;d<b.length&&!(1E5>e);d++)e/=1E3,c=b[d];this.setElemText("i_received",this.formatNumber(e)+" "+c);this.setElemText("i_frameDecoded",
a.hasOwnProperty("framesDecoded")?this.formatNumber(a.framesDecoded):"-");this.updateFramerate(a.hasOwnProperty("framerate")?this.formatNumber(a.framerate):"-");this.updateBitrate(a.hasOwnProperty("bitrate")?this.formatNumber(a.bitrate):"-");this.setElemText("i_packetsLost",a.hasOwnProperty("packetsLost")?this.formatNumber(a.packetsLost):"-");this.setElemText("i_frameDropped",a.hasOwnProperty("framesDropped")?this.formatNumber(a.framesDropped):"-");this.setElemText("i_compositeTime",a.hasOwnProperty("receiveToCompositeMs")?
this.formatNumber(a.receiveToCompositeMs,1)+" ms":"-")}updateSettings(a){this.setElemValue("i_settings_rateControl",a.Encoder.RateControl);this.setElemValue("i_settings_minQP",-1==a.Encoder.MinQP?"":a.Encoder.MinQP);this.setElemValue("i_settings_maxQP",-1==a.Encoder.MaxQP?"":a.Encoder.MaxQP);this.setElemValue("i_maxBitrate",a.WebRTC.MaxBitrate/1E3/1E3)}updateQP(a){let b=this.getElem("i_qp");b.style.color=35<a?"red":26<a?"orange":"rgb(128,255,0)";b.innerText=a}updateFramerate(a){let b=this.getElem("i_framerate");
b.style.color=10>a?"red":20>a?"orange":"rgb(128,255,0)";b.innerText=a}updateBitrate(a){let b=this.getElem("i_bitrate");b.style.color=100>a?"red":1E3>a?"orange":"rgb(128,255,0)";b.innerText=a+" kbps"}updateApiQueueSize(a,b){this.getElem("i_apiQueue").innerText=a+" / "+b}updateLatencyTestResult(a){this.setElemText("i_test_netLatency",a.netLatency);this.setElemText("i_test_encode",a.encode);this.setElemText("i_test_totalUE",a.totalUE);this.setElemText("i_test_browserReceve",a.browserReceve);this.setElemText("i_test_total",
a.total)}setPosition(a){this.htmlElemButton&&(this.htmlElemButton.style.left=`${a.left+10}px`,this.htmlElemButton.style.top=`${a.bottom-30}px`);if(this.htmlElemPanel){let b=this.htmlElemPanel.getBoundingClientRect();this.htmlElemPanel.style.left=`${a.left+10}px`;this.htmlElemPanel.style.top=`${a.bottom-b.height-42}px`}}}class Bb extends ia{constructor(a){super(a)}create(){this.htmlElem||(this.createCSS(`@keyframes twinkling{ 0% {opacity:0;} 100% {opacity: 1;}} #statusPoint_${this.uid} { position: absolute; display: inline-block; width: 6px; height: 6px; border-radius: 50%; background-color: red; animation: twinkling 0.25s infinite ease-in-out; }`),
this.htmlElem=document.createElement("i"),this.htmlElem.id=`statusPoint_${this.uid}`,document.body.appendChild(this.htmlElem),this.setPosition(this.parent.container.getBoundingClientRect()))}destroy(){this.htmlElem&&(document.body.removeChild(this.htmlElem),this.htmlElem=null)}setStatus(a){let b="Red";switch(a){case 0:b="Red";this.getElem("statusPoint")&&(this.getElem("statusPoint").style.display="inline-block");break;case 1:b="RGB(200,200,200)";break;case 2:b="Yellow";break;case 3:b="RGB(0,128,255)";
4==this.lastStatus&&(b="RGB(0,255,0)",this.hidePoint());break;case 4:b="RGB(0,255,0)",3==this.lastStatus&&this.hidePoint()}this.lastStatus=a;this.getElem("statusPoint")&&(this.getElem("statusPoint").style.backgroundColor=b)}hidePoint(){setTimeout(()=>{this.getElem("statusPoint")&&(this.getElem("statusPoint").style.display="none")},1E3)}setPosition(a){this.htmlElem&&(this.htmlElem.style.left=`${a.left+5}px`,this.htmlElem.style.top=`${a.top+5}px`)}}const ha={abnormal_closure:1006,cannot_parse_message:1008,
no_free_instance:1013,out_of_control:4E3,instance_is_disconnected:4001,instance_not_found:4002,instance_is_not_started:4003,webrtc_connection_error:4004,only_one_client_allowed:4005,timeout:4006,iid_is_required:4007,cannot_change_because_locked:4008,project_is_not_specified:4009,kicked:4100,syncing_data:4101,instance_killed_by_user:4102,invalid_token:4103,wait_for_starting:4104};var ea=[];class Cb{constructor(a,b){if(a){this.host=a;this.uid||(this.uid=Date.now());this.uiStatusPoint=new Bb(this);this.uiStartup=
new zb(this);this.uiStatus=new Ab(this);"object"==typeof b?(this.options=b,this.options.onclose="function"==typeof b.onclose?b.onclose:null,this.options.onloaded="function"==typeof b.onloaded?b.onloaded:null,b.keyEventReceiver=b.keyEventReceiver||"none",this.keyEventReceiverStr=b.keyEventReceiver,this.keyEventReceiver="document"==b.keyEventReceiver?document:"none"==b.keyEventReceiver?null:"video",b.apiOptions&&(b.apiOptions.player=this,this.aircityApi=new da(null,b.apiOptions))):(this.options={},
1<arguments.length&&"string"==typeof arguments[1]&&(this.options.domId=arguments[1]),3<arguments.length&&(this.options.showMarker=arguments[3]),4<arguments.length&&(this.options.showStartupInfo=arguments[4]));this.container=this.options.domId?document.getElementById(this.options.domId):null;if(this.hasVideo=!!this.container)this.uiStatusPoint.create(),this.observer=new (window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver)(c=>{this.resize()}),this.observer.observe(this.container,
{attributes:!0,attributeFilter:["style"],attributeOldValue:!0}),this.options.showStartupInfo&&this.uiStartup.create(),this.canAdaptiveResolution=!0,this.fakeMouseWithTouches=!1,this.lastResizeTime=(new Date).getTime(),this.orientationChangeTimeout=void 0;this.isMac="Mac68K"==navigator.platform||"MacPPC"==navigator.platform||"Macintosh"==navigator.platform||"MacIntel"==navigator.platform;this.isChrome=-1!=window.navigator.userAgent.indexOf("Chrome");this.latencyTestTimings={TestStartTimeMs:null,UEReceiptTimeMs:null,
UEPreCaptureTimeMs:null,UEPostCaptureTimeMs:null,UEPreEncodeTimeMs:null,UEPostEncodeTimeMs:null,UETransmissionTimeMs:null,BrowserReceiptTimeMs:null,FrameDisplayDeltaTimeMs:null,player:this,Reset:function(){this.FrameDisplayDeltaTimeMs=this.BrowserReceiptTimeMs=this.UETransmissionTimeMs=this.UEPostEncodeTimeMs=this.UEPreEncodeTimeMs=this.UEPostCaptureTimeMs=this.UEPreCaptureTimeMs=this.UEReceiptTimeMs=this.TestStartTimeMs=null},SetUETimings:function(c){this.UEReceiptTimeMs=c.ReceiptTimeMs;this.UEPreCaptureTimeMs=
c.PreCaptureTimeMs;this.UEPostCaptureTimeMs=c.PostCaptureTimeMs;this.UEPreEncodeTimeMs=c.PreEncodeTimeMs;this.UEPostEncodeTimeMs=c.PostEncodeTimeMs;this.UETransmissionTimeMs=c.TransmissionTimeMs;this.BrowserReceiptTimeMs=Date.now();this.player.rtc_latencyTimingsReady()},SetFrameDisplayDeltaTime:function(c){null==this.FrameDisplayDeltaTimeMs&&(this.FrameDisplayDeltaTimeMs=Math.round(c),this.player.rtc_latencyTimingsReady())}};this.construct();if(this.hasVideo){for(let c=0;c<ea.length;c++){let e=ea[c];
if(!e)continue;let d=this.container.getBoundingClientRect(),h=e.container.getBoundingClientRect();d.left==h.left&&d.top==h.top&&(e.uiStartup.htmlElem&&e.uiStartup.destroy(),e.uiStatusPoint.htmlElem&&e.uiStatusPoint.destroy());delete ea[c]}ea.push(this);this.onUserInteraction()}}else console.error("[AirCityPlayer] The parameter `host` cannot be empty!")}construct(){this.uiStartup.log(`host: ${this.host}`);this.url=`${"https:"==location.protocol?"wss":"ws"}://${this.host}/player?hasVideo=${this.hasVideo}`;
this.options.iid&&(this.url+="&iid="+this.options.iid);this.options.pid&&(this.url+="&pid="+this.options.pid);this.options.token&&(this.url+="&token="+this.options.token);setTimeout(()=>{this.ws_connect()},200)}getHost(){return this.host}getAPI(){return this.aircityApi}getInstanceInfo(){return this.paramInfo}getVideoSize(){if(this.video)return{width:this.video.videoWidth,height:this.video.videoHeight}}setResolution(a,b){window.devicePixelRatio&&(a*=window.devicePixelRatio,b*=window.devicePixelRatio);
if(3840<a||2160<b)b=a/b,b>=3840/2160?(a=3840,b=3840/b):(a=2160*b,b=2160);this.streamerAdaptive&&this.streamerLimitMaxResolution&&(a>this.streamerResX||b>this.streamerResY)&&(b=a/b,b>=this.streamerResX/this.streamerResY?(a=this.streamerResX,b=this.streamerResX/b):(a=this.streamerResY*b,b=this.streamerResY));a=Math.floor(a);b=Math.floor(b);let c=this.video.videoWidth,e=this.video.videoHeight;if(a!=c&&a+1!=c&&a-1!=c||b!=e&&b+1!=e&&b-1!=e)a={Console:"setres "+a+"x"+b+"w"},this.rtc_send_descriptor(50,
a),console.log(JSON.stringify(a))}setBitrate(a){this.maxBitrate=a}destroy(a){this.isDestroyed||(this.isDestroyed=!0,this.destroyReason=a,this.video&&(this.rtc_close(),this.container.removeChild(this.video),this.video=null),this.uiStatus.destroy(),this.ws_checkOpen()&&(this.ws.close(),this.ws=null))}setKeyEventReceiver(a){this.keyEventReceiverStr!=a&&("none"!=this.keyEventReceiverStr&&this.unregisterKeyboardEvents(),"video"==a?(this.video&&(this.video.tabIndex=1),this.keyEventReceiver=this.video,this.registerKeyboardEvents()):
"document"==a&&(this.keyEventReceiver=document,this.registerKeyboardEvents()),this.keyEventReceiverStr=a)}resize(){if(this.container){this.rect=this.container.getBoundingClientRect();if(this.bNeedReposUI||!this.oldRect||this.oldRect.width!=this.rect.width||this.oldRect.height!=this.rect.height)this.bNeedReposUI=!1,this.oldRect=this.rect,this.uiStartup.setPosition(this.rect),this.uiStatus.setPosition(this.rect),this.uiStatusPoint.setPosition(this.rect);if(this.video){this.canAdaptiveResolution&&(this._updateVideoStreamSize||
(this._updateVideoStreamSize=()=>{500<(new Date).getTime()-this.lastResizeTime?(this.setResolution(this.video.clientWidth,this.video.clientHeight),this.lastResizeTime=(new Date).getTime()):(clearTimeout(this.resizeTimerId),this.resizeTimerId=setTimeout(c=>this._updateVideoStreamSize(),500))}),this._updateVideoStreamSize());var a=this.container.clientHeight/this.container.clientWidth,b=this.streamerAdaptive&&this.canAdaptiveResolution?a:this.video.videoHeight/this.video.videoWidth;if(a>b){let c=a/
b;this.normalizeAndQuantizeUnsigned=(e,d)=>{e/=this.container.clientWidth;d=c*(d/this.container.clientHeight-.5)+.5;return 0>e||1<e||0>d||1<d?{inRange:!1,x:65535,y:65535}:{inRange:!0,x:65536*e,y:65536*d}};this.unquantizeAndDenormalizeUnsigned=(e,d)=>({x:e/65536*this.container.clientWidth,y:((d/65536-.5)/c+.5)*this.container.clientHeight});this.normalizeAndQuantizeSigned=(e,d)=>({x:e/(.5*this.container.clientWidth)*32767,y:c*d/(.5*this.container.clientHeight)*32767})}else{let c=b/a;this.normalizeAndQuantizeUnsigned=
(e,d)=>{e=c*(e/this.container.clientWidth-.5)+.5;d/=this.container.clientHeight;return 0>e||1<e||0>d||1<d?{inRange:!1,x:65535,y:65535}:{inRange:!0,x:65536*e,y:65536*d}};this.unquantizeAndDenormalizeUnsigned=(e,d)=>({x:((e/65536-.5)/c+.5)*this.container.clientWidth,y:d/65536*this.container.clientHeight});this.normalizeAndQuantizeSigned=(e,d)=>({x:c*e/(.5*this.container.clientWidth)*32767,y:d/(.5*this.container.clientHeight)*32767})}}}}setInstanceOptions(a){if(a.pid==this.options.pid&&a.iid==this.options.iid||
!a.pid&&a.iid==this.options.iid||!a.iid&&a.pid==this.options.pid)return this.aircityApi&&this.aircityApi.log("setInstanceOptions: no change."),!1;this.destroy();this.options.iid=a.iid;this.options.pid=a.pid;this.construct();return!0}onApiReady(){this.uiStatusPoint.setStatus(4);this.ws_send({type:"ready"})}onUserInteraction(){this.timestampForInteraction=(new Date).getTime()}registerKeyboardEvents(){this.keyEventReceiver&&(this.isFKey=a=>112<=a.keyCode&&123>=a.keyCode,this.getKeyCode=a=>16===a.keyCode&&
"ShiftRight"===a.code?253:17===a.keyCode&&"ControlRight"===a.code?254:18===a.keyCode&&"AltRight"===a.code?255:a.keyCode,this.keyEventReceiver.onkeydown=a=>{this.isFKey(a)||a.ctrlKey||(this.rtc_send_keydown(a),this.onUserInteraction());if(8===a.keyCode)this.keyEventReceiver.onkeypress({charCode:8})},this.keyEventReceiver.onkeyup=a=>{this.isFKey(a)||a.ctrlKey||(this.rtc_send_keyup(a),this.onUserInteraction())},this.keyEventReceiver.onkeypress=a=>{this.isFKey(a)||(this.rtc_send_keypress(a),this.onUserInteraction())})}unregisterKeyboardEvents(){this.keyEventReceiver&&
(this.keyEventReceiver.onkeydown=null,this.keyEventReceiver.onkeyup=null,this.keyEventReceiver.onkeypress=null)}registerMouseEvents(){this.video.onmouseenter=a=>{this.rtc_send_mouseenter();a.buttons&1&&this.rtc_send_mousedown(0,a.offsetX,a.offsetY);a.buttons&2&&this.rtc_send_mousedown(2,a.offsetX,a.offsetY);a.buttons&4&&this.rtc_send_mousedown(1,a.offsetX,a.offsetY);a.buttons&8&&this.rtc_send_mousedown(3,a.offsetX,a.offsetY);a.buttons&16&&this.rtc_send_mousedown(4,a.offsetX,a.offsetY)};this.video.onmouseleave=
a=>{this.rtc_send_mouseleave();a.buttons&1&&this.rtc_send_mouseup(0,a.offsetX,a.offsetY);a.buttons&2&&this.rtc_send_mouseup(2,a.offsetX,a.offsetY);a.buttons&4&&this.rtc_send_mouseup(1,a.offsetX,a.offsetY);a.buttons&8&&this.rtc_send_mouseup(3,a.offsetX,a.offsetYy);a.buttons&16&&this.rtc_send_mouseup(4,a.offsetX,a.offsetY)};this.video.onmousemove=a=>{switch(this.mouseDownButton){case 0:this.video.style.cursor='url("../cursors/pan.cur"),auto';break;case 1:this.video.style.cursor="move";break;case 2:this.video.style.cursor=
'url("../cursors/rotate.cur"),auto';break;default:this.video.style.cursor='url("../cursors/point.cur"),auto'}this.rtc_send_mousemove(a.offsetX,a.offsetY,a.movementX,a.movementY);a.preventDefault()};this.video.onmousedown=a=>{this.keyEventReceiver==this.video&&this.video.focus();this.mouseDownButton=a.button;this.rtc_send_mousedown(a.button,a.offsetX,a.offsetY);a.preventDefault()};this.video.onmouseup=a=>{this.mouseDownButton=void 0;this.rtc_send_mouseup(a.button,a.offsetX,a.offsetY);a.preventDefault()};
this.video.oncontextmenu=a=>{this.isMac||this.rtc_send_mouseup(a.button,a.offsetX,a.offsetY);a.preventDefault()};"onmousewheel"in this.video?this.video.onmousewheel=a=>{this.rtc_send_mousewheel(a.wheelDelta,a.offsetX,a.offsetY);a.preventDefault()}:this.video.addEventListener("DOMMouseScroll",a=>{this.rtc_send_mousewheel(-120*a.detail,a.offsetX,a.offsetY);a.preventDefault()},!1)}registerTouchEvents(){this.fingers=[9,8,7,6,5,4,3,2,1,0];this.fingerIds={};this.rememberTouch=b=>{let c=this.fingers.pop();
void 0===c&&console.log("exhausted touch indentifiers");this.fingerIds[b.identifier]=c};this.forgetTouch=b=>{this.fingers.push(this.fingerIds[b.identifier]);delete this.fingerIds[b.identifier]};this.sendTouchData=(b,c)=>{this.rtc_send_touch(b,c);this.onUserInteraction()};if(this.fakeMouseWithTouches){var a=void 0;this.video.addEventListener("touchstart",b=>{if(void 0===a){let c=b.changedTouches[0];a={id:c.identifier,x:c.clientX-this.rect.left,y:c.clientY-this.rect.top};this.video.onmouseenter(b);
this.rtc_send_mousedown(0,a.x,a.y)}b.preventDefault()},!1);this.video.addEventListener("touchend",b=>{for(let c=0;c<b.changedTouches.length;c++){let e=b.changedTouches[c];if(e.identifier===a.id){this.rtc_send_mouseup(0,e.clientX-this.rect.left,e.clientY-this.rect.top);this.video.onmouseleave(b);a=void 0;break}}b.preventDefault()},!1);this.video.addEventListener("touchmove",b=>{for(var c=0;c<b.touches.length;c++){var e=b.touches[c];if(e.identifier===a.id){c=e.clientX-this.rect.left;e=e.clientY-this.rect.top;
this.rtc_send_mousemove(c,e,c-a.x,e-a.y);a.x=c;a.y=e;break}}b.preventDefault()},!1)}else this.video.addEventListener("touchstart",b=>{for(let c=0;c<b.changedTouches.length;c++)this.rememberTouch(b.changedTouches[c]);this.sendTouchData(80,b.changedTouches);b.preventDefault()},!1),this.video.addEventListener("touchend",b=>{this.sendTouchData(81,b.changedTouches);for(let c=0;c<b.changedTouches.length;c++)this.forgetTouch(b.changedTouches[c]);b.preventDefault()},!1),this.video.addEventListener("touchmove",
b=>{this.sendTouchData(82,b.touches);b.preventDefault()},!1)}receiveParamInfo(a){this.paramInfo=a;let b=a.project,c=a.nodeIP,e=a.hostName;this.options.iid=a.iid;this.options.pid=a.pid;this.streamerAdaptive=a.adjustResolution;this.streamerLimitMaxResolution=a.limitMaxResolution;this.streamerResX=a.resX;this.streamerResY=a.resY;if(this.kickOutInMinutes=a.kickOutInMinutes){let d=setInterval(()=>{(new Date).getTime()-this.timestampForInteraction>6E4*this.kickOutInMinutes&&(this.destroy("\u957f\u65f6\u95f4\u672a\u4f7f\u7528\u5df2\u88ab\u8e22\u51fa"),
console.warn("\u957f\u65f6\u95f4\u672a\u4f7f\u7528\u5df2\u88ab\u8e22\u51fa"),clearInterval(d))},2E4)}this.nodeInfoArray=["Node Information:"];e&&this.nodeInfoArray.push("\t"+e);c&&this.nodeInfoArray.push("\t"+c);b&&this.nodeInfoArray.push("\t"+b);this.nodeInfoArray.push("\tpid: "+this.options.pid);this.nodeInfoArray.push("\tiid: "+this.options.iid);this.nodeInfoArray.push("\tadaptive: "+this.streamerAdaptive);this.nodeInfoArray.push("\tlimitMax: "+this.streamerLimitMaxResolution);this.nodeInfoArray.push("\tresX: "+
this.streamerResX);this.nodeInfoArray.push("\tresY: "+this.streamerResY);this.uiStatus.updateButtonTip(this.nodeInfoArray.join("\n"));this.aircityApi&&this.aircityApi.log(this.nodeInfoArray.join("\n\t"))}rtc_send(a){this.dcClient&&"open"==this.dcClient.readyState&&this.dcClient.send(a)}rtc_lock_datachannel(a){this.datachannelLocked=a}rtc_unlock_datachannel(){this.datachannelLocked=null}rtc_send_requestInitialSettings(){this.datachannelLocked||this.rtc_send((new Uint8Array([7])).buffer)}rtc_send_requestQualityControl(){this.datachannelLocked||
this.rtc_send((new Uint8Array([1])).buffer)}rtc_send_api(a){if(!this.datachannelLocked){a.__playerId=this.playerId;var b=JSON.stringify(a),c=b.length,e=this.pcClient.sctp?Math.min(this.pcClient.sctp.maxMessageSize,65536):65536,d=(e-4)/2;if(c>d){this.numOfEventCalls=0;let g=Math.ceil(c/d),q=[];for(var h=0;h<g;h++){let t=h==g-1?c-h*d:d;q[h]={type:0==h?1:h==g-1?3:2,stringLength:t,content:b.substr(h*d,t)}}let k=0,f=t=>{for(t=this.dcClient.bufferedAmount;k<q.length;){var v=q[k++];let p=new DataView(new ArrayBuffer(4+
2*v.stringLength)),x=0;p.setUint8(x,52);x++;p.setUint8(x,v.type);x++;p.setUint16(x,v.stringLength,!0);x+=2;v=v.content;for(let u=0;u<v.length;u++)p.setUint16(x,v.charCodeAt(u),!0),x+=2;t+=p.byteLength;this.rtc_send(p.buffer);k==g-1&&(console.log(`api(command: ${a.command}) slices send finished. bufferedamountlow calls: ${this.numOfEventCalls}`),this.dcClient.onbufferedamountlow=null);if(t>l)break}},l=Math.max(8*e,1048576);this.dcClient.bufferedAmountLowThreshold=e;this.dcClient.onbufferedamountlow=
t=>{this.numOfEventCalls++;f()};console.log(`sending api(command: ${a.command}) slices, count: ${g}`);f()}else{e=new DataView(new ArrayBuffer(4+2*c));d=0;e.setUint8(d,52);d++;e.setUint8(d,0);d++;e.setUint16(d,c,!0);d+=2;for(h=0;h<c;h++)e.setUint16(d,b.charCodeAt(h),!0),d+=2;this.rtc_send(e.buffer)}}}rtc_send_descriptor(a,b){if(!this.datachannelLocked){b=JSON.stringify(b);var c=new DataView(new ArrayBuffer(3+2*b.length)),e=0;c.setUint8(e,a);e++;c.setUint16(e,b.length,!0);e+=2;for(a=0;a<b.length;a++)c.setUint16(e,
b.charCodeAt(a),!0),e+=2;this.rtc_send(c.buffer)}}rtc_send_keydown(a){this.datachannelLocked||this.rtc_send((new Uint8Array([60,this.getKeyCode(a),a.repeat])).buffer)}rtc_send_keyup(a){this.datachannelLocked||this.rtc_send((new Uint8Array([61,this.getKeyCode(a)])).buffer)}rtc_send_keypress(a){if(!this.datachannelLocked){var b=new DataView(new ArrayBuffer(3));b.setUint8(0,62);b.setUint16(1,a.charCode,!0);this.rtc_send(b.buffer)}}rtc_send_mouseenter(){if(!this.datachannelLocked){var a=new DataView(new ArrayBuffer(1));
a.setUint8(0,70);this.rtc_send(a.buffer)}}rtc_send_mouseleave(){if(!this.datachannelLocked){var a=new DataView(new ArrayBuffer(1));a.setUint8(0,71);this.rtc_send(a.buffer)}}rtc_send_mousemove(a,b,c,e){!this.datachannelLocked&&this.normalizeAndQuantizeUnsigned&&(a=this.normalizeAndQuantizeUnsigned(a,b),c=this.normalizeAndQuantizeSigned(c,e),e=new DataView(new ArrayBuffer(9)),e.setUint8(0,74),e.setUint16(1,a.x,!0),e.setUint16(3,a.y,!0),e.setInt16(5,c.x,!0),e.setInt16(7,c.y,!0),this.rtc_send(e.buffer),
this.onUserInteraction())}rtc_send_mousedown(a,b,c){!this.datachannelLocked&&this.normalizeAndQuantizeUnsigned&&(b=this.normalizeAndQuantizeUnsigned(b,c),c=new DataView(new ArrayBuffer(6)),c.setUint8(0,72),c.setUint8(1,a),c.setUint16(2,b.x,!0),c.setUint16(4,b.y,!0),this.rtc_send(c.buffer),this.onUserInteraction())}rtc_send_mouseup(a,b,c){!this.datachannelLocked&&this.normalizeAndQuantizeUnsigned&&(b=this.normalizeAndQuantizeUnsigned(b,c),c=new DataView(new ArrayBuffer(6)),c.setUint8(0,73),c.setUint8(1,
a),c.setUint16(2,b.x,!0),c.setUint16(4,b.y,!0),this.rtc_send(c.buffer))}rtc_send_mousewheel(a,b,c){!this.datachannelLocked&&this.normalizeAndQuantizeUnsigned&&(b=this.normalizeAndQuantizeUnsigned(b,c),c=new DataView(new ArrayBuffer(7)),c.setUint8(0,75),c.setInt16(1,a,!0),c.setUint16(3,b.x,!0),c.setUint16(5,b.y,!0),this.rtc_send(c.buffer),this.onUserInteraction())}rtc_send_touch(a,b){if(!this.datachannelLocked){var c=new DataView(new ArrayBuffer(2+6*b.length));c.setUint8(0,a);c.setUint8(1,b.length);
a=2;for(let e=0;e<b.length;e++){let d=b[e],h=this.normalizeAndQuantizeUnsigned(d.clientX-this.video.offsetLeft,d.clientY-this.video.offsetTop);c.setUint16(a,h.x,!0);a+=2;c.setUint16(a,h.y,!0);a+=2;c.setUint8(a,this.fingerIds[d.identifier],!0);a+=1;c.setUint8(a,255*d.force,!0);a+=1}this.rtc_send(c.buffer)}}rtc_states(a){let b={};a.forEach(c=>{"inbound-rtp"!=c.type||c.isRemote||"video"!=c.mediaType&&!c.id.toLowerCase().includes("video")||(b.timestamp=c.timestamp,b.bytesReceived=c.bytesReceived,b.framesDecoded=
c.framesDecoded,b.packetsLost=c.packetsLost,b.bytesReceivedStart=this.stats&&this.stats.bytesReceivedStart?this.stats.bytesReceivedStart:c.bytesReceived,b.framesDecodedStart=this.stats&&this.stats.framesDecodedStart?this.stats.framesDecodedStart:c.framesDecoded,b.timestampStart=this.stats&&this.stats.timestampStart?this.stats.timestampStart:c.timestamp,this.stats&&this.stats.timestamp&&(this.stats.bytesReceived&&(b.bitrate=8*(b.bytesReceived-this.stats.bytesReceived)/(b.timestamp-this.stats.timestamp),
b.bitrate=Math.floor(b.bitrate),b.lowBitrate=this.stats.lowBitrate&&this.stats.lowBitrate<b.bitrate?this.stats.lowBitrate:b.bitrate,b.highBitrate=this.stats.highBitrate&&this.stats.highBitrate>b.bitrate?this.stats.highBitrate:b.bitrate),this.stats.bytesReceivedStart&&(b.avgBitrate=8*(b.bytesReceived-this.stats.bytesReceivedStart)/(b.timestamp-this.stats.timestampStart),b.avgBitrate=Math.floor(b.avgBitrate)),this.stats.framesDecoded&&(b.framerate=(b.framesDecoded-this.stats.framesDecoded)/((b.timestamp-
this.stats.timestamp)/1E3),b.framerate=Math.floor(b.framerate),b.lowFramerate=this.stats.lowFramerate&&this.stats.lowFramerate<b.framerate?this.stats.lowFramerate:b.framerate,b.highFramerate=this.stats.highFramerate&&this.stats.highFramerate>b.framerate?this.stats.highFramerate:b.framerate),this.stats.framesDecodedStart&&(b.avgframerate=(b.framesDecoded-this.stats.framesDecodedStart)/((b.timestamp-this.stats.timestampStart)/1E3),b.avgframerate=Math.floor(b.avgframerate))));"track"==c.type&&c.frameWidth&&
(b.framesDropped=c.framesDropped,b.framesReceived=c.framesReceived,b.framesDroppedPercentage=c.framesDropped/c.framesReceived*100,b.frameHeight=c.frameHeight,b.frameWidth=c.frameWidth,b.frameHeightStart=this.stats&&this.stats.frameHeightStart?this.stats.frameHeightStart:c.frameHeight,b.frameWidthStart=this.stats&&this.stats.frameWidthStart?this.stats.frameWidthStart:c.frameWidth);"candidate-pair"==c.type&&c.hasOwnProperty("currentRoundTripTime")&&0!=c.currentRoundTripTime&&(b.currentRoundTripTime=
c.currentRoundTripTime)});this.stats.receiveToCompositeMs&&(b.receiveToCompositeMs=this.stats.receiveToCompositeMs,this.latencyTestTimings.SetFrameDisplayDeltaTime(this.stats.receiveToCompositeMs));this.stats=b;1E5<(this.stats.hasOwnProperty("bytesReceived")?this.stats.bytesReceived:0)&&this.uiStartup.setVisible(!1);this.uiStatus.visible&&this.uiStatus.updateStats(this.stats)}rtc_initVars(a){a=a||{};this.webRtcConfig=a.peerConnectionOptions||{};this.webRtcConfig.sdpSemantics="unified-plan";this.tnClient=
this.dcClient=this.pcClient=null;this.sdpConstraints={offerToReceiveAudio:0,offerToReceiveVideo:1,voiceActivityDetection:!1};this.dataChannelOptions={ordered:!0};this.stats={};this.playerId=0}rtc_close(){this.dcClient&&"open"==this.dcClient.readyState&&(this.dcClient.close(),this.dcClient=null);this.pcClient&&(this.pcClient.close(),this.pcClient=null);this.rtc_states_clearTimer()}rtc_states_clearTimer(){this.aggregateStatsIntervalId&&(clearInterval(this.aggregateStatsIntervalId),this.aggregateStatsIntervalId=
void 0)}rtc_onStateChanged(){this.signalingState!=this.pcClient.signalingState&&(this.signalingState=this.pcClient.signalingState,this.uiStartup.log(`---signalingState: ${this.signalingState}`));this.iceConnectionState!=this.pcClient.iceConnectionState&&(this.iceConnectionState=this.pcClient.iceConnectionState,this.uiStartup.log(`---iceConnectionState: ${this.iceConnectionState}`),"disconnected"!=this.iceConnectionState||this.isDatachannelOpened||this.uiStartup.log("\u8fde\u63a5\u5efa\u7acb\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u670d\u52a1\u5668\u7aef\u53e3\u8bbe\u7f6e"),
"failed"!=this.iceConnectionState||this.isDatachannelOpened||this.uiStartup.log("\u8fde\u63a5\u5efa\u7acb\u5931\u8d25\uff0c\u65e0\u53ef\u7528\u7684\u5019\u9009\u8fde\u63a5"));this.iceGatheringState!=this.pcClient.iceGatheringState&&(this.iceGatheringState=this.pcClient.iceGatheringState,this.uiStartup.log(`---iceGatheringState: ${this.iceGatheringState}`))}rtc_setup(){this.rtc_close();this.pcClient=new RTCPeerConnection(this.webRtcConfig);this.pcClient.addTransceiver("video",{direction:"recvonly"});
this.pcClient.onsignalingstatechange=a=>{this.rtc_onStateChanged()};this.pcClient.oniceconnectionstatechange=a=>{this.rtc_onStateChanged()};this.pcClient.onicegatheringstatechange=a=>{this.rtc_onStateChanged()};this.pcClient.ontrack=a=>{if(this.hasVideo)if(a.track&&this.uiStartup.log("got track - "+a.track.kind+" readyState="+a.track.readyState),"audio"==a.track.kind){if(a=a.streams[0],this.video.srcObject!=a&&this.video.srcObject&&this.video.srcObject!==a){let b=document.createElement("Audio");b.autoplay=
!0;b.srcObject=a;b.play();this.uiStartup.log("Created new audio element to play seperate audio stream.")}}else"video"==a.track.kind&&this.video.srcObject!==a.streams[0],this.video.srcObject=a.streams[0],this.uiStartup.log("set video source from video track.")};this.pcClient.onicecandidate=a=>{a.candidate&&a.candidate.candidate&&this.ws_send({type:"iceCandidate",candidate:a.candidate})};try{this.dcClient=this.pcClient.createDataChannel("cirrus",this.dataChannelOptions),this.dcClient.binaryType="arraybuffer",
this.dcClient.onopen=a=>this.rtc_datachannel_onopen(a),this.dcClient.onclose=a=>this.rtc_datachannel_onclose(a),this.dcClient.onerror=a=>this.rtc_datachannel_onerror(a),this.dcClient.onmessage=a=>this.rtc_datachannel_onmessage(a),this.uiStartup.log("created data channel")}catch(a){this.uiStartup.log("no data channel!"),this.dcClient=null}this.pcClient.createOffer(this.sdpConstraints).then(a=>{a.sdp=a.sdp.replace(/(a=fmtp:\d+ .*level-asymmetry-allowed=.*)\r\n/gm,`$1;x-google-start-bitrate=15000;x-google-max-bitrate=${this.maxBitrate||
3E4}\r\n`);a.sdp=a.sdp.replace("useinbandfec=1","useinbandfec=1;stereo=1;sprop-maxcapturerate=48000");this.pcClient.setLocalDescription(a);this.ws_send({type:"offer",sdp:a.sdp,hasVideo:this.hasVideo})},()=>{this.uiStartup.log("couldn't create offer")})}rtc_ice(a){a=new RTCIceCandidate(a);this.pcClient.addIceCandidate(a).then(b=>{this.uiStartup.log("candidate successfully added")})}rtc_config(a){this.rtc_initVars({peerConnectionOptions:a.peerConnectionOptions});if(this.hasVideo&&(this.video||(this.uiStartup.log("create video element"),
this.video=document.createElement("video"),this.video.id=`streamingVideo_${this.uid}`,this.video.style="width: 100%;height: 100%;",this.video.playsInline=!0,this.video.muted=!0,this.video.autoplay=!0,this.video.disablepictureinpicture=!0,"video"===this.keyEventReceiver&&(this.video.tabIndex=1,this.keyEventReceiver=this.video),this.container.appendChild(this.video),this.video.addEventListener("loadedmetadata",b=>{this.uiStatusPoint.setStatus(3);this.uiStartup.log("video event: loadedmetadata");this.video.onmouseenter({button:0,
x:0,y:0});this.options.showMarker&&this.uiStatus.createButton();if(this.options.onloaded)this.options.onloaded();this.resize()},!0)),"requestVideoFrameCallback"in HTMLVideoElement.prototype)){const b=(c,e)=>{e.receiveTime&&e.expectedDisplayTime&&(this.stats.receiveToCompositeMs=e.presentationTime-e.receiveTime);this.video&&this.video.requestVideoFrameCallback(b)};this.video.requestVideoFrameCallback(b)}this.uiStartup.log("setting up...");this.rtc_setup();this.hasVideo&&(this.uiStartup.log("register events"),
this.registerKeyboardEvents(),this.registerMouseEvents(),this.registerTouchEvents(),window.addEventListener("orientationchange",()=>{clearTimeout(this.orientationChangeTimeout);this.orientationChangeTimeout=setTimeout(()=>this.resize(),500)}))}rtc_receiveAnswer(a){this.playerId=a.playerId;this.uiStartup.log(`received server answer: ${this.playerId}`);a=new RTCSessionDescription(a);this.pcClient.setRemoteDescription(a);a=this.pcClient.getReceivers();for(let b of a)b.playoutDelayHint=0;this.hasVideo&&
!this.aggregateStatsIntervalId&&(this.aggregateStatsIntervalId=setInterval(()=>{this.pcClient&&this.pcClient.getStats(null).then(b=>{this.rtc_states(b)})},1E3))}rtc_datachannel_onopen(a){this.datachannelLocked=null;this.isDatachannelOpened=!0;this.uiStartup.log("data channel connected");this.hasVideo&&(this.rtc_send_requestQualityControl(),this.uiStatus.requestInitialSettings());this.uiStartup.log("waiting for video data...");if(this.aircityApi)this.aircityApi.onConnectionOpen()}rtc_datachannel_onclose(a){this.isDatachannelOpened=
!1;this.uiStartup.log("data channel closed");if(this.aircityApi)this.aircityApi.onConnectionClose(a)}rtc_datachannel_onerror(a){this.isDatachannelOpened=!1;this.uiStartup.log("data channel error");if(this.aircityApi)this.aircityApi.onConnectionClose(a.error)}rtc_datachannel_onmessage(a){var b=new Uint8Array(a.data);switch(b[0]){case 1:if(this.aircityApi&&(a=(new TextDecoder("utf-16")).decode(a.data.slice(1)))&&""!=a)this.aircityApi.onConnectionMessage(a);break;case 101:if(this.aircityApi)switch(b=
b[1],a=(new TextDecoder("utf-8")).decode(a.data.slice(2)),b){case 0:this.aircityApi.onConnectionMessage(a);break;case 1:this.reponse_api_json_string=a;break;case 2:this.reponse_api_json_string+=a;break;case 3:this.reponse_api_json_string+=a,this.aircityApi.onConnectionMessage(this.reponse_api_json_string)}break;case 6:a=(new TextDecoder("utf-16")).decode(a.data.slice(1));a=JSON.parse(a);this.latencyTestTimings.SetUETimings(a);break;case 7:a=(new TextDecoder("utf-16")).decode(a.data.slice(1));a=JSON.parse(a);
a.Encoder&&this.uiStatus.updateSettings(a);break;case 5:this.uiStatus.visible&&(a=(new TextDecoder("utf-16")).decode(a.data.slice(1)),a=JSON.parse(a),this.uiStatus.updateQP(a.qp),this.uiStatus.updateApiQueueSize(a.cqSize,a.rqSize))}}rtc_startLatencyTest(){this.video&&(this.latencyTestTimings.Reset(),this.latencyTestTimings.TestStartTimeMs=Date.now(),this.rtc_send_descriptor(6,{StartTime:this.latencyTestTimings.TestStartTimeMs}))}rtc_latencyTimingsReady(){let a=this.latencyTestTimings;if(a.BrowserReceiptTimeMs){var b=
a.BrowserReceiptTimeMs-a.TestStartTimeMs;0==a.UEPreEncodeTimeMs||0==a.UEPreCaptureTimeMs?"???":a.UEPostEncodeTimeMs-a.UEPreCaptureTimeMs;a.UEPostCaptureTimeMs-a.UEPreCaptureTimeMs;var c=a.UEPostEncodeTimeMs-a.UEPreEncodeTimeMs,e=a.UETransmissionTimeMs-a.UEReceiptTimeMs,d=null;a.FrameDisplayDeltaTimeMs&&a.BrowserReceiptTimeMs&&(d=a.FrameDisplayDeltaTimeMs+b);this.uiStatus.updateLatencyTestResult({netLatency:b-e,encode:c,totalUE:e,browserReceve:a.FrameDisplayDeltaTimeMs&&a.BrowserReceiptTimeMs?a.FrameDisplayDeltaTimeMs:
"",total:d?d+" ms":""})}}ws_checkOpen(){return this.ws&&1===this.ws.readyState}ws_send(a){a&&this.ws_checkOpen()&&this.ws.send(JSON.stringify(a))}ws_onOpen(){this.uiStatusPoint.setStatus(2);this.uiStartup.log("connected!");setInterval(()=>{this.ws_send({type:"ping",time:(new Date).getTime()})},6E4)}ws_onClose(a){this.uiStatusPoint.setStatus(0);if(this.options.onclose)this.options.onclose(a);if(this.aircityApi)this.aircityApi.onConnectionClose(a);this.uiStartup.setVisible(!0);let b=this.isDestroyed?
"Destroyed: "+this.destroyReason:`WS closed: ${JSON.stringify(a.code)} - ${a.reason}`;this.uiStartup.log(b);console.log(b);this.ws=void 0;ra(a.code)?this.options.showStartupInfo&&this.rtc_states_clearTimer():this.destroy();this.isDestroyed||setTimeout(()=>this.ws_connect(),3E3)}ws_onError(a){this.uiStatusPoint.setStatus(0);a=`ws error: ${JSON.stringify(a)}`;this.uiStartup.log(a);console.log(a)}ws_onMessage(a){a=JSON.parse(a.data);switch(a.type){case "config":this.rtc_config(a);break;case "answer":this.rtc_receiveAnswer(a);
break;case "iceCandidate":this.rtc_ice(a.candidate);break;case "paramInfo":this.receiveParamInfo(a);break;case "playerCount":this.uiStatus.updateConnections(a.count);break;case "status":this.uiStartup.log(a.info)}}ws_connect(){this.uiStatusPoint.setStatus(1);window.WebSocket=window.WebSocket||window.MozWebSocket;window.WebSocket?(this.uiStartup.log(`connecting ${this.host}...`),this.ws=new WebSocket(this.url),this.ws.onopen=()=>this.ws_onOpen(),this.ws.onmessage=a=>this.ws_onMessage(a),this.ws.onerror=
a=>this.ws_onError(a),this.ws.onclose=a=>this.ws_onClose(a)):alert("Your browser does not support WebSocket")}}C.APIErrorCode={OK:0,InvalidParameters:1,InternalError:2,ResourceNotFound:3,AcpProjWKTNotSet:4,CoordinateConversionFailed:5,IDExists:6,InvalidRequestType:7,InvalidRequestString:8,NoCommand:9,DataTypeNotSupport:10,InvalidOperation:11,ProjectNotOpened:12,CodeMax:65535};C.AirCityAPI=da;C.AirCityPlayer=Cb;C.AnimatedImageButtonData=za;C.BPFuncParamType={Bool:0,UInt8:1,Int32:2,Float:3,Double:4,
String:5,Color:6,Vector2D:7,Vector:8,Rotator:9,IntArray:10,StringArray:11,VectorArray:12,Coordinate:13,CoordinateArray:14};C.BPFunctionData=Na;C.BeamData=Aa;C.CameraTourData=Pa;C.CameraTourKeyFrame=Oa;C.Color={LightPink:"RGB(255,182,193)",Pink:"RGB(255,192,203)",Crimson:"RGB(220,20,60)",LavenderBlush:"RGB(255,240,245)",PaleVioletRed:"RGB(219,112,147)",HotPink:"RGB(255,105,180)",DeepPink:"RGB(255,20,147)",MediumVioletRed:"RGB(199,21,133)",Orchid:"RGB(218,112,214)",Thistle:"RGB(216,191,216)",plum:"RGB(221,160,221)",
Violet:"RGB(238,130,238)",Magenta:"RGB(255,0,255)",Fuchsia:"RGB(255,0,255)",DarkMagenta:"RGB(139,0,139)",Purple:"RGB(128,0,128)",MediumOrchid:"RGB(186,85,211)",DarkVoilet:"RGB(148,0,211)",DarkOrchid:"RGB(153,50,204)",Indigo:"RGB(75,0,130)",BlueViolet:"RGB(138,43,226)",MediumPurple:"RGB(147,112,219)",MediumSlateBlue:"RGB(123,104,238)",SlateBlue:"RGB(106,90,205)",DarkSlateBlue:"RGB(72,61,139)",Lavender:"RGB(230,230,250)",GhostWhite:"RGB(248,248,255)",Blue:"RGB(0,0,255)",MediumBlue:"RGB(0,0,205)",MidnightBlue:"RGB(25,25,112)",
DarkBlue:"RGB(0,0,139)",Navy:"RGB(0,0,128)",RoyalBlue:"RGB(65,105,225)",CornflowerBlue:"RGB(100,149,237)",LightSteelBlue:"RGB(176,196,222)",LightSlateGray:"RGB(119,136,153)",SlateGray:"RGB(112,128,144)",DoderBlue:"RGB(30,144,255)",AliceBlue:"RGB(240,248,255)",SteelBlue:"RGB(70,130,180)",LightSkyBlue:"RGB(135,206,250)",SkyBlue:"RGB(135,206,235)",DeepSkyBlue:"RGB(0,191,255)",LightBLue:"RGB(173,216,230)",PowDerBlue:"RGB(176,224,230)",CadetBlue:"RGB(95,158,160)",Azure:"RGB(240,255,255)",LightCyan:"RGB(225,255,255)",
PaleTurquoise:"RGB(175,238,238)",Cyan:"RGB(0,255,255)",Aqua:"RGB(212,242,231)",DarkTurquoise:"RGB(0,206,209)",DarkSlateGray:"RGB(47,79,79)",DarkCyan:"RGB(0,139,139)",Teal:"RGB(0,128,128)",MediumTurquoise:"RGB(72,209,204)",LightSeaGreen:"RGB(32,178,170)",Turquoise:"RGB(64,224,208)",Auqamarin:"RGB(127,255,170)",MediumAquamarine:"RGB(0,250,154)",MediumSpringGreen:"RGB(0,255,127)",MintCream:"RGB(245,255,250)",SpringGreen:"RGB(60,179,113)",SeaGreen:"RGB(46,139,87)",Honeydew:"RGB(240,255,240)",LightGreen:"RGB(144,238,144)",
PaleGreen:"RGB(152,251,152)",DarkSeaGreen:"RGB(143,188,143)",LimeGreen:"RGB(50,205,50)",Lime:"RGB(0,255,0)",ForestGreen:"RGB(34,139,34)",Green:"RGB(0,128,0)",DarkGreen:"RGB(0,100,0)",Chartreuse:"RGB(127,255,0)",LawnGreen:"RGB(124,252,0)",GreenYellow:"RGB(173,255,47)",OliveDrab:"RGB(85,107,47)",Beige:"RGB(245,245,220)",LightGoldenrodYellow:"RGB(250,250,210)",Ivory:"RGB(255,255,240)",LightYellow:"RGB(255,255,224)",Yellow:"RGB(255,255,0)",Olive:"RGB(128,128,0)",DarkKhaki:"RGB(189,183,107)",LemonChiffon:"RGB(255,250,205)",
PaleGodenrod:"RGB(238,232,170)",Khaki:"RGB(240,230,140)",Gold:"RGB(255,215,0)",Cornislk:"RGB(255,248,220)",GoldEnrod:"RGB(218,165,32)",FloralWhite:"RGB(255,250,240)",OldLace:"RGB(253,245,230)",Wheat:"RGB(245,222,179)",Moccasin:"RGB(255,228,181)",Orange:"RGB(255,165,0)",PapayaWhip:"RGB(255,239,213)",BlanchedAlmond:"RGB(255,235,205)",NavajoWhite:"RGB(255,222,173)",AntiqueWhite:"RGB(250,235,215)",Tan:"RGB(210,180,140)",BrulyWood:"RGB(222,184,135)",Bisque:"RGB(255,228,196)",DarkOrange:"RGB(255,140,0)",
Linen:"RGB(250,240,230)",Peru:"RGB(205,133,63)",PeachPuff:"RGB(255,218,185)",SandyBrown:"RGB(244,164,96)",Chocolate:"RGB(210,105,30)",SaddleBrown:"RGB(139,69,19)",SeaShell:"RGB(255,245,238)",Sienna:"RGB(160,82,45)",LightSalmon:"RGB(255,160,122)",Coral:"RGB(255,127,80)",OrangeRed:"RGB(255,69,0)",DarkSalmon:"RGB(233,150,122)",Tomato:"RGB(255,99,71)",MistyRose:"RGB(255,228,225)",Salmon:"RGB(250,128,114)",Snow:"RGB(255,250,250)",LightCoral:"RGB(240,128,128)",RosyBrown:"RGB(188,143,143)",IndianRed:"RGB(205,92,92)",
Red:"RGB(255,0,0)",Brown:"RGB(165,42,42)",FireBrick:"RGB(178,34,34)",DarkRed:"RGB(139,0,0)",Maroon:"RGB(128,0,0)",White:"RGB(255,255,255)",WhiteSmoke:"RGB(245,245,245)",Gainsboro:"RGB(220,220,220)",LightGrey:"RGB(211,211,211)",Silver:"RGB(192,192,192)",DarkGray:"RGB(169,169,169)",Gray:"RGB(128,128,128)",DimGray:"RGB(105,105,105)",Black:"RGB(0,0,0)"};C.CommandType=r;C.CustomObjectData=Ja;C.CustomObjectData2=Ka;C.CustomTagData=wa;C.DecalData=Ha;C.DynamicWaterData=Ma;C.HeatMapPointData=ta;C.HighlightAreaData=
xa;C.ImageButtonData=ya;C.LayerVisibleData=sa;C.MapMode={Campass:0,SmallMap:1,BigMap:2};C.MeasurementMode={Coordinate:1,Linear:2,Horizontal:3,Vertical:4,MultiPoint:5,TerrainArea:6};C.MousePickMask=ca;C.ODLineData=Ea;C.PanoramaData=Ga;C.Polygon3DData=Ca;C.Polygon3DStyle={Wave:0,LoopLine:1,Gradual:2,DynamicGradual:3,WaveTransparent:4,WideWave:5,RotateArrow:6,RotateLine:7,RotateGradual:8,SingleColor:9,SingleColorWithLight:10};C.PolygonData=Fa;C.PolygonStyle={SingleColor:0,CirclePoint:1,Volumn:2,Gradual:3,
DynamicGradual:4,WaveTransparent:5,WideWave:6,RotateArrow:7,RotateLine:8,RotateGradual:9,OnTerrain:10};C.PolylineData=Da;C.PolylineStyle={Arrow:0,Arrow1:1,Flow:2,Beam:3,Normal:4,OnTerrain:5,DottedNormal:6,DottedCircle:7};C.RadiationPointData=Ba;C.TagData=ua;C.TileLayerData=Ia;C.VERSION="5.1";C.VideoProjectionData=La;C.Viewport=T;C.WaterFlowFieldStyle={HeatMap:0,Water:1};C.WebUIData=va;Object.defineProperty(C,"__esModule",{value:!0})});
(function(){if(globalThis&&(globalThis.acapi||"undefined"!=typeof acapi)){let C=globalThis,F=globalThis.acapi||acapi;C.AirCityAPI=F.AirCityAPI;C.AcApiVersion=F.VERSION;F.AirCityAPI.__onApiConstructed=fa=>C.__g=fa;C.CommandType=F.CommandType;C.APIErrorCode=F.APIErrorCode;C.MousePickMask=F.MousePickMask;C.Color=F.Color;C.MeasurementMode=F.MeasurementMode;C.MapMode=F.MapMode;C.WaterFlowFieldStyle=F.WaterFlowFieldStyle;C.PolylineStyle=F.PolylineStyle;C.PolygonStyle=F.PolygonStyle;C.Polygon3DStyle=F.Polygon3DStyle;
C.Viewport=F.Viewport;C.BPFuncParamType=F.BPFuncParamType;C.LayerVisibleData=F.LayerVisibleData;C.HeatMapPointData=F.HeatMapPointData;C.TagData=F.TagData;C.WebUIData=F.WebUIData;C.CustomTagData=F.CustomTagData;C.HighlightAreaData=F.HighlightAreaData;C.ImageButtonData=F.ImageButtonData;C.AnimatedImageButtonData=F.AnimatedImageButtonData;C.BeamData=F.BeamData;C.RadiationPointData=F.RadiationPointData;C.Polygon3DData=F.Polygon3DData;C.PolylineData=F.PolylineData;C.ODLineData=F.ODLineData;C.PolygonData=
F.PolygonData;C.PanoramaData=F.PanoramaData;C.DecalData=F.DecalData;C.TileLayerData=F.TileLayerData;C.CustomObjectData=F.CustomObjectData;C.CustomObjectData2=F.CustomObjectData2;C.VideoProjectionData=F.VideoProjectionData;C.DynamicWaterData=F.DynamicWaterData;C.BPFunctionData=F.BPFunctionData;C.CameraTourKeyFrame=F.CameraTourKeyFrame;C.CameraTourData=F.CameraTourData;C.AirCityPlayer=F.AirCityPlayer}})();
